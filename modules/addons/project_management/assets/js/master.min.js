function decodeHtml(e){return $("<div>").html(e).text()}function appendFile(e,t){var i=jQuery("#projectId").val();jQuery("#fileList").append('<div class="file" id="file-'+e+'">    <div class="pull-right">        <a id="fileView'+e+'" type="button" class="btn btn-default file-view" href="addonmodules.php?module=project_management&amp;action=dl&amp;projectid='+i+"&amp;i="+e+"&amp;msg="+t.messageId+(t.browserViewable?'&amp;view=inline" target="_blank"':'"')+(t.isImage?' data-lightbox="project-image-'+i+'"':"")+'>            <i class="fas fa-search"></i>            '+lang.view+'        </a>        <a id="fileDownload'+e+'" href="addonmodules.php?module=project_management&amp;action=dl&amp;projectid='+i+"&amp;i="+e+"&amp;msg="+t.messageId+'" class="btn btn-default">            '+lang.download+'        </a>        <button type="button" class="btn btn-danger" onclick="ProjectManager.confirm(\'deletefile\', \'num='+e+"')\">            "+lang.delete+'        </button>    </div>    <span class="title">'+t.filename+'</span><span class="extension">'+t.extension+'</span>    <span class="info">'+lang.by+" <strong>"+t.admin+"</strong> x "+lang.justNow+" X "+t.filesize+"</span></div>")}function appendTicket(e){jQuery("#noTickets").hide(),jQuery("#tickets").find(".tickets").append('<div class="ticket" id="ticket-'+e.id+'"><div class="pull-right"><button type="button" class="btn btn-default view-ticket" data-ticket-id="'+e.id+'"><i class="fas fa-search"></i> '+lang.view+'</button> <button type="button" class="btn btn-danger unlink-ticket" data-ticket-tid="'+e.tid+'">'+lang.unlink+'</button></div><span class="ticketnum">#'+e.tid+'</span><span class="subject"> '+e.title+' <span class="label" style="background-color: '+e.statusColour+"; color: "+e.statusTextColour+';">'+e.status+'</span></span><span class="info">'+lang.ticketUser+":"+e.userDetails+"<br>"+lang.department+": "+e.departmentName+"<br>"+lang.lastReplyBy+" <strong>"+e.lastReplyUser+"</strong>"+(e.isAdminReply?" ("+lang.staffMember+") - ":" - ")+e.lastreply+"</span></div>")}function appendInvoice(e){jQuery("#noInvoices").hide(),jQuery("#invoices").append('<tr id="invoice-'+e.id+'" class="invoice"><td class="invoice-num">'+lang.invoiceNum+(e.invoiceNumber?e.invoiceNumber:e.id)+'</td><td class="invoice-data">'+e.dateCreated+' </td><td class="invoice-data">'+e.dateDue+' </td><td class="invoice-data">'+e.total+'</td><td class="invoice-data">'+e.balance+'</td><td><span class="label '+e.status.toLowerCase()+'">'+e.status+'</span></td><td class="text-right"><button type="button" class="btn btn-default view-invoice" data-invoice-id="'+e.id+'"><i class="fas fa-search"></i> '+lang.view+'</button> <button type="button" class="btn btn-danger unlink-invoice" data-invoice-id="'+e.id+'"> '+lang.unlink+" </button></td></tr>")}!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){"use strict";e.fn.fileinputLocales={},e.fn.fileinputThemes={};var t,i;t={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",STYLE_SETTING:'style="width:{width};height:{height};"',OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(e,t,i){return void 0!==e&&(i?e===t:e.match(t))},isIE:function(e){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===e)return new RegExp("msie\\s"+e,"i").test(navigator.userAgent);var t,i=document.createElement("div");return i.innerHTML="<!--[if IE "+e+"]> <i></i> <![endif]-->",t=i.getElementsByTagName("i").length,document.body.appendChild(i),i.parentNode.removeChild(i),t},initModal:function(t){var i=e("body");i.length&&t.appendTo(i)},isEmpty:function(t,i){return void 0===t||null===t||0===t.length||i&&""===e.trim(t)},isArray:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},ifSet:function(e,t,i){return i=i||"",t&&"object"==typeof t&&e in t?t[e]:i},cleanArray:function(e){return e instanceof Array||(e=[]),e.filter(function(e){return void 0!==e&&null!==e})},spliceArray:function(e,t){var i,n=0,a=[];if(!(e instanceof Array))return[];for(i=0;i<e.length;i++)i!==t&&(a[n]=e[i],n++);return a},getNum:function(e,t){return t=t||0,"number"==typeof e?e:("string"==typeof e&&(e=parseFloat(e)),isNaN(e)?t:e)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!t.isIE(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},hasFileUploadSupport:function(){return t.hasFileAPISupport()&&window.FormData},addCss:function(e,t){e.removeClass(t).addClass(t)},getElement:function(i,n,a){return t.isEmpty(i)||t.isEmpty(i[n])?a:e(i[n])},uniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(t,i){var n=t;return i?(e.each(i,function(e,t){"function"==typeof t&&(t=t()),n=n.split(e).join(t)}),n):n},cleanMemory:function(e){var i=e.is("img")?e.attr("src"):e.find("source").attr("src");t.objUrl.revokeObjectURL(i)},findFileName:function(e){var t=e.lastIndexOf("/");return t===-1&&(t=e.lastIndexOf("\\")),e.split(e.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var i=document,n=i.documentElement;n&&e&&!t.checkFullScreen()?n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()},moveArray:function(e,t,i){if(i>=e.length)for(var n=i-e.length;n--+1;)e.push(void 0);return e.splice(i,0,e.splice(t,1)[0]),e},cleanZoomCache:function(e){var t=e.closest(".kv-zoom-cache-theme");t.length||(t=e.closest(".kv-zoom-cache")),t.remove()}},i=function(i,n){var a=this;a.$element=e(i),a._validate()&&(a.isPreviewable=t.hasFileAPISupport(),a.isIE9=t.isIE(9),a.isIE10=t.isIE(10),a.isPreviewable||a.isIE9?(a._init(n),a._listen()):a.$element.removeClass("file-loading"))},i.prototype={constructor:i,_init:function(i){var n,a,r=this,s=r.$element;r.options=i,e.each(i,function(e,i){switch(e){case"minFileCount":case"maxFileCount":case"maxFileSize":r[e]=t.getNum(i);break;default:r[e]=i}}),r.$form=s.closest("form"),r._initTemplateDefaults(),r.fileInputCleared=!1,r.fileBatchCompleted=!0,r.isPreviewable||(r.showPreview=!1),r.uploadFileAttr=t.isEmpty(s.attr("name"))?"file_data":s.attr("name"),r.reader=null,r.formdata={},r.clearStack(),r.uploadCount=0,r.uploadStatus={},r.uploadLog=[],r.uploadAsyncCount=0,r.loadedImages=[],r.totalImagesCount=0,r.ajaxRequests=[],r.isError=!1,r.ajaxAborted=!1,r.cancelling=!1,a=r._getLayoutTemplate("progress"),r.progressTemplate=a.replace("{class}",r.progressClass),r.progressCompleteTemplate=a.replace("{class}",r.progressCompleteClass),r.progressErrorTemplate=a.replace("{class}",r.progressErrorClass),r.dropZoneEnabled=t.hasDragDropSupport()&&r.dropZoneEnabled,r.isDisabled=s.attr("disabled")||s.attr("readonly"),r.isDisabled&&s.attr("disabled",!0),r.isUploadable=t.hasFileUploadSupport()&&!t.isEmpty(r.uploadUrl),r.isClickable=r.browseOnZoneClick&&r.showPreview&&(r.isUploadable&&r.dropZoneEnabled||!t.isEmpty(r.defaultPreviewContent)),r.slug="function"==typeof i.slugCallback?i.slugCallback:r._slugDefault,r.mainTemplate=r.showCaption?r._getLayoutTemplate("main1"):r._getLayoutTemplate("main2"),r.captionTemplate=r._getLayoutTemplate("caption"),r.previewGenericTemplate=r._getPreviewTemplate("generic"),r.resizeImage&&(r.maxImageWidth||r.maxImageHeight)&&(r.imageCanvas=document.createElement("canvas"),r.imageCanvasContext=r.imageCanvas.getContext("2d")),t.isEmpty(s.attr("id"))&&s.attr("id",t.uniqId()),r.namespace=".fileinput_"+s.attr("id").replace(/-/g,"_"),void 0===r.$container?r.$container=r._createContainer():r._refreshContainer(),n=r.$container,r.$dropZone=n.find(".file-drop-zone"),r.$progress=n.find(".kv-upload-progress"),r.$btnUpload=n.find(".fileinput-upload"),r.$captionContainer=t.getElement(i,"elCaptionContainer",n.find(".file-caption")),r.$caption=t.getElement(i,"elCaptionText",n.find(".file-caption-name")),r.$previewContainer=t.getElement(i,"elPreviewContainer",n.find(".file-preview")),r.$preview=t.getElement(i,"elPreviewImage",n.find(".file-preview-thumbnails")),r.$previewStatus=t.getElement(i,"elPreviewStatus",n.find(".file-preview-status")),r.$errorContainer=t.getElement(i,"elErrorContainer",r.$previewContainer.find(".kv-fileinput-error")),t.isEmpty(r.msgErrorClass)||t.addCss(r.$errorContainer,r.msgErrorClass),r.$errorContainer.hide(),r.previewInitId="preview-"+t.uniqId(),r._initPreviewCache(),r._initPreview(!0),r._initPreviewActions(),r._setFileDropZoneTitle(),s.removeClass("file-loading"),s.attr("disabled")&&r.disable(),r._initZoom()},_initTemplateDefaults:function(){var i,n,a,r,s,o,l,d,c,u,p,h,m,f,g,v,w,y,b,C,k,_,T,I,F,x,E,S,D,j,$,P,A,z,O=this;i='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',n='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',a='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',s='<div class="close fileinput-remove">&times;</div>\n',r='<i class="glyphicon glyphicon-file kv-caption-icon"></i>',o='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',l='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',d='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',c='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',u='<div id="'+t.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+t.MODAL_ID+'Label"></div>',p='<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}</div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h3>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',h='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',m=" <samp>({sizeText})</samp>",f='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}<br>{size}</div>\n    {progress} {actions}\n</div>',g='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    </div>\n    <div class="clearfix"></div>\n</div>',v='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',w='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',y='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',b='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',C='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"',k=C+'><div class="kv-file-content">\n',_=C+' title="{caption}"><div class="kv-file-content">\n',T="</div>{footer}\n</div>\n",I="{content}\n",F='<div class="kv-preview-data file-preview-html" title="{caption}" '+t.STYLE_SETTING+">{data}</div>\n",x='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" '+t.STYLE_SETTING+">\n",E='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+t.STYLE_SETTING+">{data}</textarea>\n",S='<video class="kv-preview-data file-preview-video" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n</video>\n",D='<div class="file-preview-audio"><audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n</audio></div>\n",j='<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n</object>\n",$='<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n</object>\n",P='<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n',A='<div class="kv-preview-data file-preview-other-frame">\n'+t.DEFAULT_PREVIEW+"\n</div>\n",z='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>',O.defaults={layoutTemplates:{main1:i,main2:n,preview:a,close:s,fileIcon:r,caption:o,modalMain:u,modal:p,progress:h,size:m,footer:f,actions:g,actionDelete:v,actionUpload:w,actionZoom:y,actionDrag:b,btnDefault:l,btnLink:d,btnBrowse:c,zoomCache:z},previewMarkupTags:{tagBefore1:k,tagBefore2:_,tagAfter:T},previewContentTemplates:{generic:I,html:F,image:x,text:E,video:S,audio:D,flash:j,object:$,pdf:P,other:A},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"auto"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","min-height":"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(e,i){return t.compare(e,"image.*")||t.compare(i,/\.(gif|png|jpe?g)$/i)},html:function(e,i){return t.compare(e,"text/html")||t.compare(i,/\.(htm|html)$/i)},text:function(e,i){return t.compare(e,"text.*")||t.compare(i,/\.(xml|javascript)$/i)||t.compare(i,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(e,i){return t.compare(e,"video.*")&&(t.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||t.compare(i,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,i){return t.compare(e,"audio.*")&&(t.compare(i,/(ogg|mp3|mp?g|wav)$/i)||t.compare(i,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,i){return t.compare(e,"application/x-shockwave-flash",!0)||t.compare(i,/\.(swf)$/i)},pdf:function(e,i){return t.compare(e,"application/pdf",!0)||t.compare(i,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},e.each(O.defaults,function(t,i){return"allowedPreviewTypes"===t?void(void 0===O.allowedPreviewTypes&&(O.allowedPreviewTypes=i)):void(O[t]=e.extend(!0,{},i,O[t]))}),O._initPreviewTemplates()},_initPreviewTemplates:function(){var i,n=this,a=n.defaults,r=n.previewMarkupTags,s=r.tagAfter;e.each(a.previewContentTemplates,function(e,a){t.isEmpty(n.previewTemplates[e])&&(i=r.tagBefore2,"generic"!==e&&"image"!==e&&"html"!==e&&"text"!==e||(i=r.tagBefore1),n.previewTemplates[e]=i+a+s)})},_initPreviewCache:function(){var i=this;i.previewCache={data:{},init:function(){var e=i.initialPreview;e.length>0&&!t.isArray(e)&&(e=e.split(i.initialPreviewDelimiter)),i.previewCache.data={content:e,config:i.initialPreviewConfig,tags:i.initialPreviewThumbTags}},fetch:function(){return i.previewCache.data.content.filter(function(e){return null!==e})},count:function(e){return i.previewCache.data&&i.previewCache.data.content?e?i.previewCache.data.content.length:i.previewCache.fetch().length:0},get:function(n,a){var r,s,o,l,d,c,u,p="init_"+n,h=i.previewCache.data,m=h.config[n],f=h.content[n],g=i.previewInitId+"-"+p,v=t.ifSet("previewAsData",m,i.initialPreviewAsData),w=function(e,n,a,r,s,o,l,d,c){return d=" file-preview-initial "+t.SORT_CSS+(d?" "+d:""),i._generatePreviewTemplate(e,n,a,r,s,!1,null,d,o,l,c)};return f?(a=void 0===a||a,o=t.ifSet("type",m,i.initialPreviewFileType||"generic"),d=t.ifSet("filename",m,t.ifSet("caption",m)),c=t.ifSet("filetype",m,o),l=i.previewCache.footer(n,a,m&&m.size||null),u=t.ifSet("frameClass",m),r=v?w(o,f,d,c,g,l,p,u):w("generic",f,d,c,g,l,p,u,o).replace(/\{content}/g,h.content[n]),h.tags.length&&h.tags[n]&&(r=t.replaceTags(r,h.tags[n])),t.isEmpty(m)||t.isEmpty(m.frameAttr)||(s=e(document.createElement("div")).html(r),s.find(".file-preview-initial").attr(m.frameAttr),r=s.html(),s.remove()),r):""},add:function(e,n,a,r){var s,o=i.previewCache.data;return t.isArray(e)||(e=e.split(i.initialPreviewDelimiter)),r?(s=o.content.push(e)-1,o.config[s]=n,o.tags[s]=a):(s=e.length-1,o.content=e,o.config=n,o.tags=a),i.previewCache.data=o,s},set:function(e,n,a,r){var s,o,l=i.previewCache.data;if(e&&e.length&&(t.isArray(e)||(e=e.split(i.initialPreviewDelimiter)),o=e.filter(function(e){return null!==e}),o.length)){if(void 0===l.content&&(l.content=[]),void 0===l.config&&(l.config=[]),void 0===l.tags&&(l.tags=[]),r){for(s=0;s<e.length;s++)e[s]&&l.content.push(e[s]);for(s=0;s<n.length;s++)n[s]&&l.config.push(n[s]);for(s=0;s<a.length;s++)a[s]&&l.tags.push(a[s])}else l.content=e,l.config=n,l.tags=a;i.previewCache.data=l}},unset:function(e){var t=i.previewCache.count();if(t){if(1===t)return i.previewCache.data.content=[],i.previewCache.data.config=[],i.previewCache.data.tags=[],i.initialPreview=[],i.initialPreviewConfig=[],void(i.initialPreviewThumbTags=[]);i.previewCache.data.content[e]=null,i.previewCache.data.config[e]=null,i.previewCache.data.tags[e]=null}},out:function(){var e,t,n="",a=i.previewCache.count(!0);if(0===a)return{content:"",caption:""};for(t=0;t<a;t++)n+=i.previewCache.get(t);return e=i._getMsgSelected(i.previewCache.count()),{content:n,caption:e}},footer:function(e,n,a){var r=i.previewCache.data;if(!r||!r.config||0===r.config.length||t.isEmpty(r.config[e]))return"";n=void 0===n||n;var s=r.config[e],o=t.ifSet("caption",s),l="",d=t.ifSet("width",s,"auto"),c=t.ifSet("url",s,!1),u=t.ifSet("key",s,null),p=i.fileActionSettings,h=t.ifSet("showDelete",s,!0),m=t.ifSet("showZoom",s,p.showZoom),f=t.ifSet("showDrag",s,p.showDrag),g=c===!1&&n;return i.initialPreviewShowDelete&&(l=i._renderFileActions(!1,h,m,f,g,c,u,!0)),i._getLayoutTemplate("footer").replace(/\{progress}/g,i._renderThumbProgress()).replace(/\{actions}/g,l).replace(/\{caption}/g,o).replace(/\{size}/g,i._getSize(a)).replace(/\{width}/g,d).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}},i.previewCache.init()},_handler:function(e,t,i){var n=this,a=n.namespace,r=t.split(" ").join(a+" ")+a;e&&e.length&&e.off(r).on(r,i)},_log:function(e){var t=this,i=t.$element.attr("id");i&&(e='"'+i+'": '+e),"undefined"!=typeof window.console.log?window.console.log(e):window.alert(e)},_validate:function(){var e=this,t="file"===e.$element.attr("type");return t||e._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),t},_errorsExist:function(){var t,i=this;return!!i.$errorContainer.find("li").length||(t=e(document.createElement("div")).html(i.$errorContainer.html()),t.find("span.kv-error-close").remove(),t.find("ul").remove(),!!e.trim(t.text()).length)},_errorHandler:function(e,t){var i=this,n=e.target.error;n.code===n.NOT_FOUND_ERR?i._showError(i.msgFileNotFound.replace("{name}",t)):n.code===n.SECURITY_ERR?i._showError(i.msgFileSecured.replace("{name}",t)):n.code===n.NOT_READABLE_ERR?i._showError(i.msgFileNotReadable.replace("{name}",t)):n.code===n.ABORT_ERR?i._showError(i.msgFilePreviewAborted.replace("{name}",t)):i._showError(i.msgFilePreviewError.replace("{name}",t))},_addError:function(e){var t=this,i=t.$errorContainer;e&&i.length&&(i.html(t.errorCloseButton+e),t._handler(i.find(".kv-error-close"),"click",function(){i.fadeOut("slow")}))},_resetErrors:function(e){var t=this,i=t.$errorContainer;t.isError=!1,t.$container.removeClass("has-error"),i.html(""),e?i.fadeOut("slow"):i.hide()},_showFolderError:function(e){var i,n=this,a=n.$errorContainer;e&&(i=n.msgFoldersNotAllowed.replace(/\{n}/g,e),n._addError(i),t.addCss(n.$container,"has-error"),a.fadeIn(800),n._raise("filefoldererror",[e,i]))},_showUploadError:function(e,i,n){var a=this,r=a.$errorContainer,s=n||"fileuploaderror",o=i&&i.id?'<li data-file-id="'+i.id+'">'+e+"</li>":"<li>"+e+"</li>";return 0===r.find("ul").length?a._addError("<ul>"+o+"</ul>"):r.find("ul").append(o),r.fadeIn(800),a._raise(s,[i,e]),a.$container.removeClass("file-input-new"),t.addCss(a.$container,"has-error"),!0},_showError:function(e,i,n){var a=this,r=a.$errorContainer,s=n||"fileerror";return i=i||{},i.reader=a.reader,a._addError(e),r.fadeIn(800),a._raise(s,[i,e]),a.isUploadable||a._clearFileInput(),a.$container.removeClass("file-input-new"),t.addCss(a.$container,"has-error"),a.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(e){var i=this,n=i.minFileCount>1?i.filePlural:i.fileSingle,a=i.msgFilesTooLess.replace("{n}",i.minFileCount).replace("{files}",n),r=i.$errorContainer;i._addError(a),i.isError=!0,i._updateFileDetails(0),r.fadeIn(800),i._raise("fileerror",[e,a]),i._clearFileInput(),t.addCss(i.$container,"has-error")},_parseError:function(t,i,n,a){var r=this,s=e.trim(n+""),o="."===s.slice(-1)?"":".",l=void 0!==i.responseJSON&&void 0!==i.responseJSON.error?i.responseJSON.error:i.responseText;return r.cancelling&&r.msgUploadAborted&&(s=r.msgUploadAborted),r.showAjaxErrorDetails&&l?(l=e.trim(l.replace(/\n\s*\n/g,"\n")),l=l.length>0?"<pre>"+l+"</pre>":"",s+=o+l):s+=o,s===o&&(s=r.msgAjaxError.replace("{operation}",t)),r.cancelling=!1,a?"<b>"+a+": </b>"+s:s},_parseFileType:function(e){var i,n,a,r,s=this,o=s.allowedPreviewTypes||[];for(r=0;r<o.length;r++)if(a=o[r],i=s.fileTypeSettings[a],n=i(e.type,e.name)?a:"",!t.isEmpty(n))return n;return"other"},_getPreviewIcon:function(t){var i,n=this,a=null;return t&&t.indexOf(".")>-1&&(i=t.split(".").pop(),n.previewFileIconSettings&&n.previewFileIconSettings[i]&&(a=n.previewFileIconSettings[i]),n.previewFileExtSettings&&e.each(n.previewFileExtSettings,function(e,t){if(n.previewFileIconSettings[e]&&t(i))return void(a=n.previewFileIconSettings[e])})),a},_parseFilePreviewIcon:function(e,t){var i=this,n=i._getPreviewIcon(t)||i.previewFileIcon;return e.indexOf("{previewFileIcon}")>-1&&(e=e.replace(/\{previewFileIconClass}/g,i.previewFileIconClass).replace(/\{previewFileIcon}/g,n)),e},_raise:function(t,i){var n=this,a=e.Event(t);if(void 0!==i?n.$element.trigger(a,i):n.$element.trigger(a),a.isDefaultPrevented()||a.result===!1)return!1;switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:n.ajaxAborted=a.result}return!0},_listenFullScreen:function(e){var t,i,n=this,a=n.$modal;a&&a.length&&(t=a&&a.find(".btn-fullscreen"),i=a&&a.find(".btn-borderless"),t.length&&i.length&&(t.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),e?t.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),a.hasClass("file-zoom-fullscreen")?n._maximizeZoomDialog():e?n._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var i,n=this,a=n.$element,r=n.$form,s=n.$container;n._handler(a,"change",e.proxy(n._change,n)),n.showBrowse&&n._handler(n.$btnFile,"click",e.proxy(n._browse,n)),n._handler(s.find(".fileinput-remove:not([disabled])"),"click",e.proxy(n.clear,n)),n._handler(s.find(".fileinput-cancel"),"click",e.proxy(n.cancel,n)),n._initDragDrop(),n._handler(r,"reset",e.proxy(n.reset,n)),n.isUploadable||n._handler(r,"submit",e.proxy(n._submitForm,n)),n._handler(n.$container.find(".fileinput-upload"),"click",e.proxy(n._uploadClick,n)),n._handler(e(window),"resize",function(){n._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),i="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",n._handler(e(document),i,function(){n._listenFullScreen(t.checkFullScreen())}),n._initClickable()},_initClickable:function(){var i,n=this;n.isClickable&&(i=n.isUploadable?n.$dropZone:n.$preview.find(".file-default-preview"),t.addCss(i,"clickable"),i.attr("tabindex",-1),n._handler(i,"click",function(t){var a=e(t.target);a.parents(".file-preview-thumbnails").length&&!a.parents(".file-default-preview").length||(n.$element.trigger("click"),i.blur())}))},_initDragDrop:function(){var t=this,i=t.$dropZone;t.isUploadable&&t.dropZoneEnabled&&t.showPreview&&(t._handler(i,"dragenter dragover",e.proxy(t._zoneDragEnter,t)),t._handler(i,"dragleave",e.proxy(t._zoneDragLeave,t)),t._handler(i,"drop",e.proxy(t._zoneDrop,t)),t._handler(e(document),"dragenter dragover drop",t._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(i){var n=this,a=e.inArray("Files",i.originalEvent.dataTransfer.types)>-1;return n._zoneDragDropInit(i),n.isDisabled||!a?(i.originalEvent.dataTransfer.effectAllowed="none",void(i.originalEvent.dataTransfer.dropEffect="none")):void t.addCss(n.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var t=this;t._zoneDragDropInit(e),t.isDisabled||t.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var i=this;e.preventDefault(),i.isDisabled||t.isEmpty(e.originalEvent.dataTransfer.files)||(i._change(e,"dragdrop"),i.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(e){var i,n=this,a=n.$container.find(".fileinput-upload"),r=!a.hasClass("disabled")&&t.isEmpty(a.attr("disabled"));if(!e||!e.isDefaultPrevented()){if(!n.isUploadable)return void(r&&"submit"!==a.attr("type")&&(i=a.closest("form"),i.length&&i.trigger("submit"),e.preventDefault()));e.preventDefault(),r&&n.upload()}},_submitForm:function(){var e=this,t=e.$element,i=t.get(0).files;return i&&e.minFileCount>0&&e._getFileCount(i.length)<e.minFileCount?(e._noFilesError({}),!1):!e._abort({})},_clearPreview:function(){var i=this,n=i.$preview,a=i.showUploadedThumbs?n.find(t.FRAMES+":not(.file-preview-success)"):n.find(t.FRAMES);a.each(function(){var i=e(this);i.remove(),t.cleanZoomCache(n.find("#zoom-"+i.attr("id")))}),i.$preview.find(t.FRAMES).length&&i.showPreview||i._resetUpload(),i._validateDefaultPreview()},_initSortable:function(){var i,n=this,a=n.$preview,r="."+t.SORT_CSS;window.KvSortable&&0!==a.find(r).length&&(i={handle:".drag-handle-init",dataIdAttr:"data-preview-id",draggable:r,onSort:function(i){var a,r,s=i.oldIndex,o=i.newIndex;n.initialPreview=t.moveArray(n.initialPreview,s,o),n.initialPreviewConfig=t.moveArray(n.initialPreviewConfig,s,o),n.previewCache.init();for(var l=0;l<n.initialPreviewConfig.length;l++)null!==n.initialPreviewConfig[l]&&(a=n.initialPreviewConfig[l].key,r=e(".kv-file-remove[data-key='"+a+"']").closest(t.FRAMES),r.attr("data-fileindex","init_"+l).data("fileindex","init_"+l));n._raise("filesorted",{previewId:e(i.item).attr("id"),oldIndex:s,newIndex:o,stack:n.initialPreviewConfig})}},a.data("kvsortable")&&a.kvsortable("destroy"),e.extend(!0,i,n.fileActionSettings.dragSettings),a.kvsortable(i))},_initPreview:function(e){var i,n=this,a=n.initialCaption||"";return n.previewCache.count()?(i=n.previewCache.out(),a=e&&n.initialCaption?n.initialCaption:i.caption,n.$preview.html(i.content),n._setInitThumbAttr(),n._setCaption(a),n._initSortable(),void(t.isEmpty(i.content)||n.$container.removeClass("file-input-new"))):(n._clearPreview(),void(e?n._setCaption(a):n._initCaption()))},_getZoomButton:function(e){var t=this,i=t.previewZoomButtonIcons[e],n=t.previewZoomButtonClasses[e],a=' title="'+(t.previewZoomButtonTitles[e]||"")+'" ',r=a+("close"===e?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==e&&"borderless"!==e&&"toggleheader"!==e||(r+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+n+" btn-"+e+'"'+r+">"+i+"</button>"},_getModalContent:function(){var e=this;return e._getLayoutTemplate("modal").replace(/\{zoomFrameClass}/g,e.frameClass).replace(/\{heading}/g,e.msgZoomModalHeading).replace(/\{prev}/g,e._getZoomButton("prev")).replace(/\{next}/g,e._getZoomButton("next")).replace(/\{toggleheader}/g,e._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,e._getZoomButton("fullscreen")).replace(/\{borderless}/g,e._getZoomButton("borderless")).replace(/\{close}/g,e._getZoomButton("close"))},_listenModalEvent:function(e){var i=this,n=i.$modal,a=function(e){return{sourceEvent:e,previewId:n.data("previewId"),modal:n}};n.on(e+".bs.modal",function(r){var s=n.find(".btn-fullscreen"),o=n.find(".btn-borderless");i._raise("filezoom"+e,a(r)),"shown"===e&&(o.removeClass("active").attr("aria-pressed","false"),s.removeClass("active").attr("aria-pressed","false"),n.hasClass("file-zoom-fullscreen")&&(i._maximizeZoomDialog(),t.checkFullScreen()?s.addClass("active").attr("aria-pressed","true"):o.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var i,n=this,a=n._getLayoutTemplate("modalMain"),r="#"+t.MODAL_ID;n.showPreview&&(n.$modal=e(r),n.$modal&&n.$modal.length||(i=e(document.createElement("div")).html(a).insertAfter(n.$container),
n.$modal=e(r).insertBefore(i),i.remove()),t.initModal(n.$modal),n.$modal.html(n._getModalContent()),e.each(t.MODAL_EVENTS,function(e,t){n._listenModalEvent(t)}))},_initZoomButtons:function(){var i,n,a=this,r=a.$modal.data("previewId")||"",s=a.$preview,o=s.find(t.FRAMES).toArray(),l=o.length,d=a.$modal.find(".btn-prev"),c=a.$modal.find(".btn-next");return o.length<2?(d.hide(),void c.hide()):(d.show(),c.show(),void(l&&(i=e(o[0]),n=e(o[l-1]),d.removeAttr("disabled"),c.removeAttr("disabled"),i.length&&i.attr("id")===r&&d.attr("disabled",!0),n.length&&n.attr("id")===r&&c.attr("disabled",!0))))},_maximizeZoomDialog:function(){var t=this,i=t.$modal,n=i.find(".modal-header:visible"),a=i.find(".modal-footer:visible"),r=i.find(".modal-body"),s=e(window).height(),o=0;i.addClass("file-zoom-fullscreen"),n&&n.length&&(s-=n.outerHeight(!0)),a&&a.length&&(s-=a.outerHeight(!0)),r&&r.length&&(o=r.outerHeight(!0)-r.height(),s-=o),i.find(".kv-zoom-body").height(s)},_resizeZoomDialog:function(e){var i=this,n=i.$modal,a=n.find(".btn-fullscreen"),r=n.find(".btn-borderless");if(n.hasClass("file-zoom-fullscreen"))t.toggleFullScreen(!1),e?a.hasClass("active")||(n.removeClass("file-zoom-fullscreen"),i._resizeZoomDialog(!0),r.hasClass("active")&&r.removeClass("active").attr("aria-pressed","false")):a.hasClass("active")?a.removeClass("active").attr("aria-pressed","false"):(n.removeClass("file-zoom-fullscreen"),i.$modal.find(".kv-zoom-body").css("height",i.zoomModalHeight));else{if(!e)return void i._maximizeZoomDialog();t.toggleFullScreen(!0)}n.focus()},_setZoomContent:function(i,n){var a,r,s,o,l,d,c,u,p,h,m=this,f=i.attr("id"),g=m.$modal,v=g.find(".btn-prev"),w=g.find(".btn-next"),y=g.find(".btn-fullscreen"),b=g.find(".btn-borderless"),C=g.find(".btn-toggleheader"),k=m.$preview.find("#zoom-"+f);r=k.attr("data-template")||"generic",a=k.find(".kv-file-content"),s=a.length?a.html():"",p=i.data("caption")||"",h=i.data("size")||"",o=p+" "+h,g.find(".kv-zoom-title").html(o),l=g.find(".kv-zoom-body"),g.removeClass("kv-single-content"),n?(u=l.clone().insertAfter(l),l.html(s).hide(),u.fadeOut("fast",function(){l.fadeIn("fast"),u.remove()})):l.html(s),c=m.previewZoomSettings[r],c&&(d=l.find(".kv-preview-data"),t.addCss(d,"file-zoom-detail"),e.each(c,function(e,t){d.css(e,t),(d.attr("width")&&"width"===e||d.attr("height")&&"height"===e)&&d.removeAttr(e)})),g.data("previewId",f),m._handler(v,"click",function(){m._zoomSlideShow("prev",f)}),m._handler(w,"click",function(){m._zoomSlideShow("next",f)}),m._handler(y,"click",function(){m._resizeZoomDialog(!0)}),m._handler(b,"click",function(){m._resizeZoomDialog(!1)}),m._handler(C,"click",function(){var e,t=g.find(".modal-header"),i=g.find(".modal-body .floating-buttons"),n=t.find(".kv-zoom-actions"),a=function(e){var i=m.$modal.find(".kv-zoom-body"),n=m.zoomModalHeight;g.hasClass("file-zoom-fullscreen")&&(n=i.outerHeight(!0),e||(n-=t.outerHeight(!0))),i.css("height",e?n+e:n)};t.is(":visible")?(e=t.outerHeight(!0),t.slideUp("slow",function(){n.find(".btn").appendTo(i),a(e)})):(i.find(".btn").appendTo(n),t.slideDown("slow",function(){a()})),g.focus()}),m._handler(g,"keydown",function(e){var t=e.which||e.keyCode;37!==t||v.attr("disabled")||m._zoomSlideShow("prev",f),39!==t||w.attr("disabled")||m._zoomSlideShow("next",f)})},_zoomPreview:function(e){var i,n=this,a=n.$modal;if(!e.length)throw"Cannot zoom to detailed preview!";t.initModal(a),a.html(n._getModalContent()),i=e.closest(t.FRAMES),n._setZoomContent(i),a.modal("show"),n._initZoomButtons()},_zoomSlideShow:function(i,n){var a,r,s,o=this,l=o.$modal.find(".kv-zoom-actions .btn-"+i),d=o.$preview.find(t.FRAMES).toArray(),c=d.length;if(!l.attr("disabled")){for(r=0;r<c;r++)if(e(d[r]).attr("id")===n){s="prev"===i?r-1:r+1;break}s<0||s>=c||!d[s]||(a=e(d[s]),a.length&&o._setZoomContent(a,!0),o._initZoomButtons(),o._raise("filezoom"+i,{previewId:n,modal:o.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var i=e(this);t._handler(i,"click",function(){t._zoomPreview(i)})})},_clearObjects:function(t){t.find("video audio").each(function(){this.pause(),e(this).remove()}),t.find("img object div").each(function(){e(this).remove()})},_clearFileInput:function(){var i,n,a,r=this,s=r.$element;r.fileInputCleared=!0,t.isEmpty(s.val())||(r.isIE9||r.isIE10?(i=s.closest("form"),n=e(document.createElement("form")),a=e(document.createElement("div")),s.before(a),i.length?i.after(n):a.after(n),n.append(s).trigger("reset"),a.before(s).remove(),n.remove()):s.val(""))},_resetUpload:function(){var e=this;e.uploadCache={content:[],config:[],tags:[],append:!0},e.uploadCount=0,e.uploadStatus={},e.uploadLog=[],e.uploadAsyncCount=0,e.loadedImages=[],e.totalImagesCount=0,e.$btnUpload.removeAttr("disabled"),e._setProgress(0),t.addCss(e.$progress,"hide"),e._resetErrors(!1),e.ajaxAborted=!1,e.ajaxRequests=[],e._resetCanvas(),e.cacheInitialPreview={},e.overwriteInitial&&(e.initialPreview=[],e.initialPreviewConfig=[],e.initialPreviewThumbTags=[],e.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var e=this;e.canvas&&e.imageCanvasContext&&e.imageCanvasContext.clearRect(0,0,e.canvas.width,e.canvas.height)},_hasInitialPreview:function(){var e=this;return!e.overwriteInitial&&e.previewCache.count()},_resetPreview:function(){var e,t,i=this;i.previewCache.count()?(e=i.previewCache.out(),i.$preview.html(e.content),i._setInitThumbAttr(),t=i.initialCaption?i.initialCaption:e.caption,i._setCaption(t)):(i._clearPreview(),i._initCaption()),i.showPreview&&(i._initZoom(),i._initSortable())},_clearDefaultPreview:function(){var e=this;e.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var e=this;e.showPreview&&!t.isEmpty(e.defaultPreviewContent)&&(e.$preview.html('<div class="file-default-preview">'+e.defaultPreviewContent+"</div>"),e.$container.removeClass("file-input-new"),e._initClickable())},_resetPreviewThumbs:function(e){var t,i=this;return e?(i._clearPreview(),void i.clearStack()):void(i._hasInitialPreview()?(t=i.previewCache.out(),i.$preview.html(t.content),i._setInitThumbAttr(),i._setCaption(t.caption),i._initPreviewActions()):i._clearPreview())},_getLayoutTemplate:function(e){var i=this,n=i.layoutTemplates[e];return t.isEmpty(i.customLayoutTags)?n:t.replaceTags(n,i.customLayoutTags)},_getPreviewTemplate:function(e){var i=this,n=i.previewTemplates[e];return t.isEmpty(i.customPreviewTags)?n:t.replaceTags(n,i.customPreviewTags)},_getOutData:function(e,t,i){var n=this;return e=e||{},t=t||{},i=i||n.filestack.slice(0)||{},{form:n.formdata,files:i,filenames:n.filenames,filescount:n.getFilesCount(),extra:n._getExtraData(),response:t,reader:n.reader,jqXHR:e}},_getMsgSelected:function(e){var t=this,i=1===e?t.fileSingle:t.filePlural;return e>0?t.msgSelected.replace("{n}",e).replace("{files}",i):t.msgNoFilesSelected},_getThumbs:function(e){return e=e||"",this.$preview.find(t.FRAMES+":not(.file-preview-initial)"+e)},_getExtraData:function(e,t){var i=this,n=i.uploadExtraData;return"function"==typeof i.uploadExtraData&&(n=i.uploadExtraData(e,t)),n},_initXhr:function(e,t,i){var n=this;return e.upload&&e.upload.addEventListener("progress",function(e){var a=0,r=e.total,s=e.loaded||e.position;e.lengthComputable&&(a=Math.floor(s/r*100)),t?n._setAsyncUploadStatus(t,a,i):n._setProgress(a)},!1),e},_ajaxSubmit:function(t,i,n,a,r,s){var o,l=this;l._raise("filepreajax",[r,s])&&(l._uploadExtra(r,s),o=e.extend(!0,{},{xhr:function(){var t=e.ajaxSettings.xhr();return l._initXhr(t,r,l.getFileStack().length)},url:l.uploadUrl,type:"POST",dataType:"json",data:l.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:t,success:i,complete:n,error:a},l.ajaxSettings),l.ajaxRequests.push(e.ajax(o)))},_mergeArray:function(e,i){var n=this,a=t.cleanArray(n[e]),r=t.cleanArray(i);n[e]=a.concat(r)},_initUploadSuccess:function(i,n,a){var r,s,o,l,d,c,u,p,h,m=this;m.showPreview&&"object"==typeof i&&!e.isEmptyObject(i)&&void 0!==i.initialPreview&&i.initialPreview.length>0&&(m.hasInitData=!0,c=i.initialPreview||[],u=i.initialPreviewConfig||[],p=i.initialPreviewThumbTags||[],r=!(void 0!==i.append&&!i.append),c.length>0&&!t.isArray(c)&&(c=c.split(m.initialPreviewDelimiter)),m._mergeArray("initialPreview",c),m._mergeArray("initialPreviewConfig",u),m._mergeArray("initialPreviewThumbTags",p),void 0!==n?a?(h=n.attr("data-fileindex"),m.uploadCache.content[h]=c[0],m.uploadCache.config[h]=u[0]||[],m.uploadCache.tags[h]=p[0]||[],m.uploadCache.append=r):(o=m.previewCache.add(c,u[0],p[0],r),s=m.previewCache.get(o,!1),l=e(document.createElement("div")).html(s).hide().insertAfter(n),d=l.find(".kv-zoom-cache"),d&&d.length&&d.insertAfter(n),n.fadeOut("slow",function(){var e=l.find(".file-preview-frame");e&&e.length&&e.insertBefore(n).fadeIn("slow").css("display:inline-block"),m._initPreviewActions(),m._clearFileInput(),t.cleanZoomCache(m.$preview.find("#zoom-"+n.attr("id"))),n.remove(),l.remove(),m._initSortable()})):(m.previewCache.set(c,u,p,r),m._initPreview(),m._initPreviewActions()))},_initSuccessThumbs:function(){var i=this;i.showPreview&&i._getThumbs(t.FRAMES+".file-preview-success").each(function(){var n=e(this),a=i.$preview,r=n.find(".kv-file-remove");r.removeAttr("disabled"),i._handler(r,"click",function(){var e=n.attr("id"),r=i._raise("filesuccessremove",[e,n.data("fileindex")]);t.cleanMemory(n),r!==!1&&n.fadeOut("slow",function(){t.cleanZoomCache(a.find("#zoom-"+e)),n.remove(),a.find(t.FRAMES).length||i.reset()})})})},_checkAsyncComplete:function(){var t,i,n=this;for(i=0;i<n.filestack.length;i++)if(n.filestack[i]&&(t=n.previewInitId+"-"+i,e.inArray(t,n.uploadLog)===-1))return!1;return n.uploadAsyncCount===n.uploadLog.length},_uploadExtra:function(t,i){var n=this,a=n._getExtraData(t,i);0!==a.length&&e.each(a,function(e,t){n.formdata.append(e,t)})},_uploadSingle:function(i,n,a){var r,s,o,l,d,c,u,p,h,m,f=this,g=f.getFileStack().length,v=new FormData,w=f.previewInitId+"-"+i,y=f.filestack.length>0||!e.isEmptyObject(f.uploadExtraData),b=e("#"+w).find(".file-thumb-progress"),C={id:w,index:i};f.formdata=v,f.showPreview&&(s=e("#"+w+":not(.file-preview-initial)"),l=s.find(".kv-file-upload"),d=s.find(".kv-file-remove"),b.removeClass("hide")),0===g||!y||l&&l.hasClass("disabled")||f._abort(C)||(m=function(e,t){f.updateStack(e,void 0),f.uploadLog.push(t),f._checkAsyncComplete()&&(f.fileBatchCompleted=!0)},o=function(){var e,i,n,a=f.uploadCache,r=0,s=f.cacheInitialPreview;f.fileBatchCompleted&&(s&&s.content&&(r=s.content.length),setTimeout(function(){if(f.showPreview){if(f.previewCache.set(a.content,a.config,a.tags,a.append),r){for(i=0;i<a.content.length;i++)n=i+r,s.content[n]=a.content[i],s.config.length&&(s.config[n]=a.config[i]),s.tags.length&&(s.tags[n]=a.tags[i]);f.initialPreview=t.cleanArray(s.content),f.initialPreviewConfig=t.cleanArray(s.config),f.initialPreviewThumbTags=t.cleanArray(s.tags)}else f.initialPreview=a.content,f.initialPreviewConfig=a.config,f.initialPreviewThumbTags=a.tags;f.cacheInitialPreview={},f.hasInitData&&(f._initPreview(),f._initPreviewActions())}f.unlock(),f._clearFileInput(),e=f.$preview.find(".file-preview-initial"),f.uploadAsync&&e.length&&(t.addCss(e,t.SORT_CSS),f._initSortable()),f._raise("filebatchuploadcomplete",[f.filestack,f._getExtraData()]),f.uploadCount=0,f.uploadStatus={},f.uploadLog=[],f._setProgress(101)},100))},c=function(n){r=f._getOutData(n),f.fileBatchCompleted=!1,f.showPreview&&(s.hasClass("file-preview-success")||(f._setThumbStatus(s,"Loading"),t.addCss(s,"file-uploading")),l.attr("disabled",!0),d.attr("disabled",!0)),a||f.lock(),f._raise("filepreupload",[r,w,i]),e.extend(!0,C,r),f._abort(C)&&(n.abort(),f._setProgressCancelled())},u=function(n,o,d){var c=f.showPreview&&s.attr("id")?s.attr("id"):w;r=f._getOutData(d,n),e.extend(!0,C,r),setTimeout(function(){t.isEmpty(n)||t.isEmpty(n.error)?(f.showPreview&&(f._setThumbStatus(s,"Success"),l.hide(),f._initUploadSuccess(n,s,a),f._setProgress(101,b)),f._raise("fileuploaded",[r,c,i]),a?m(i,c):f.updateStack(i,void 0)):(f._showUploadError(n.error,C),f._setPreviewError(s,i),a&&m(i,c))},100)},p=function(){setTimeout(function(){f.showPreview&&(l.removeAttr("disabled"),d.removeAttr("disabled"),s.removeClass("file-uploading")),a?o():(f.unlock(!1),f._clearFileInput()),f._initSuccessThumbs()},100)},h=function(t,r,o){var l=f.ajaxOperations.uploadThumb,d=f._parseError(l,t,o,a?n[i].name:null);setTimeout(function(){a&&m(i,w),f.uploadStatus[w]=100,f._setPreviewError(s,i),e.extend(!0,C,f._getOutData(t)),f._setProgress(101,b,f.msgAjaxProgressError.replace("{operation}",l)),f._showUploadError(d,C)},100)},v.append(f.uploadFileAttr,n[i],f.filenames[i]),v.append("file_id",i),f._ajaxSubmit(c,u,p,h,w,i))},_uploadBatch:function(){var i,n,a,r,s,o=this,l=o.filestack,d=l.length,c={},u=o.filestack.length>0||!e.isEmptyObject(o.uploadExtraData);o.formdata=new FormData,0!==d&&u&&!o._abort(c)&&(s=function(){e.each(l,function(e){o.updateStack(e,void 0)}),o._clearFileInput()},i=function(i){o.lock();var n=o._getOutData(i);o.showPreview&&o._getThumbs().each(function(){var i=e(this),n=i.find(".kv-file-upload"),a=i.find(".kv-file-remove");i.hasClass("file-preview-success")||(o._setThumbStatus(i,"Loading"),t.addCss(i,"file-uploading")),n.attr("disabled",!0),a.attr("disabled",!0)}),o._raise("filebatchpreupload",[n]),o._abort(n)&&(i.abort(),o._setProgressCancelled())},n=function(i,n,a){var r=o._getOutData(a,i),l=o._getThumbs(":not(.file-preview-error)"),d=0,c=t.isEmpty(i)||t.isEmpty(i.errorkeys)?[]:i.errorkeys;t.isEmpty(i)||t.isEmpty(i.error)?(o._raise("filebatchuploadsuccess",[r]),s(),o.showPreview?(l.each(function(){var t=e(this),i=t.find(".kv-file-upload");t.find(".kv-file-upload").hide(),o._setThumbStatus(t,"Success"),t.removeClass("file-uploading"),i.removeAttr("disabled")}),o._initUploadSuccess(i)):o.reset(),o._setProgress(101)):(o.showPreview&&(l.each(function(){var t=e(this),i=t.find(".kv-file-remove"),n=t.find(".kv-file-upload");return t.removeClass("file-uploading"),n.removeAttr("disabled"),i.removeAttr("disabled"),0===c.length?void o._setPreviewError(t):(e.inArray(d,c)!==-1?o._setPreviewError(t):(t.find(".kv-file-upload").hide(),o._setThumbStatus(t,"Success"),o.updateStack(d,void 0)),void d++)}),o._initUploadSuccess(i)),o._showUploadError(i.error,r,"filebatchuploaderror"))},r=function(){o.unlock(),o._initSuccessThumbs(),o._clearFileInput(),o._raise("filebatchuploadcomplete",[o.filestack,o._getExtraData()])},a=function(t,i,n){var a=o._getOutData(t),r=o.ajaxOperations.uploadBatch,s=o._parseError(r,t,n);o._showUploadError(s,a,"filebatchuploaderror"),o.uploadFileCount=d-1,o.showPreview&&(o._getThumbs().each(function(){var t=e(this),i=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==o.filestack[i]&&o._setPreviewError(t)}),o._getThumbs().removeClass("file-uploading"),o._getThumbs(" .kv-file-upload").removeAttr("disabled"),o._getThumbs(" .kv-file-delete").removeAttr("disabled"),o._setProgress(101,o.$progress,o.msgAjaxProgressError.replace("{operation}",r)))},e.each(l,function(e,i){t.isEmpty(l[e])||o.formdata.append(o.uploadFileAttr,i,o.filenames[e])}),o._ajaxSubmit(i,n,r,a))},_uploadExtraOnly:function(){var e,i,n,a,r=this,s={};r.formdata=new FormData,r._abort(s)||(e=function(e){r.lock();var t=r._getOutData(e);r._raise("filebatchpreupload",[t]),r._setProgress(50),s.data=t,s.xhr=e,r._abort(s)&&(e.abort(),r._setProgressCancelled())},i=function(e,i,n){var a=r._getOutData(n,e);t.isEmpty(e)||t.isEmpty(e.error)?(r._raise("filebatchuploadsuccess",[a]),r._clearFileInput(),r._initUploadSuccess(e),r._setProgress(101)):r._showUploadError(e.error,a,"filebatchuploaderror")},n=function(){r.unlock(),r._clearFileInput(),r._raise("filebatchuploadcomplete",[r.filestack,r._getExtraData()])},a=function(e,t,i){var n=r._getOutData(e),a=r.ajaxOperations.uploadExtra,o=r._parseError(a,e,i);s.data=n,r._showUploadError(o,n,"filebatchuploaderror"),r._setProgress(101,r.$progress,r.msgAjaxProgressError.replace("{operation}",a))},r._ajaxSubmit(e,i,n,a))},_deleteFileIndex:function(i){var n=this,a=i.attr("data-fileindex");"init_"===a.substring(0,5)&&(a=parseInt(a.replace("init_","")),n.initialPreview=t.spliceArray(n.initialPreview,a),n.initialPreviewConfig=t.spliceArray(n.initialPreviewConfig,a),n.initialPreviewThumbTags=t.spliceArray(n.initialPreviewThumbTags,a),n.$preview.find(t.FRAMES).each(function(){var t=e(this),i=t.attr("data-fileindex");"init_"===i.substring(0,5)&&(i=parseInt(i.replace("init_","")),i>a&&(i--,t.attr("data-fileindex","init_"+i)))}),n.uploadAsync&&(n.cacheInitialPreview=n.getPreview()))},_initFileActions:function(){var i=this,n=i.$preview;i.showPreview&&(i._initZoomButton(),n.find(t.FRAMES+" .kv-file-remove").each(function(){var a,r,s,o,l=e(this),d=l.closest(t.FRAMES),c=d.attr("id"),u=d.attr("data-fileindex");i._handler(l,"click",function(){return o=i._raise("filepreremove",[c,u]),!(o===!1||!i._validateMinCount())&&(a=d.hasClass("file-preview-error"),t.cleanMemory(d),void d.fadeOut("slow",function(){t.cleanZoomCache(n.find("#zoom-"+c)),i.updateStack(u,void 0),i._clearObjects(d),d.remove(),c&&a&&i.$errorContainer.find('li[data-file-id="'+c+'"]').fadeOut("fast",function(){e(this).remove(),i._errorsExist()||i._resetErrors()}),i._clearFileInput();var o=i.getFileStack(!0),l=i.previewCache.count(),p=o.length,h=i.showPreview&&n.find(t.FRAMES).length;0!==p||0!==l||h?(r=l+p,s=r>1?i._getMsgSelected(r):o[0]?i._getFileNames()[0]:"",i._setCaption(s)):i.reset(),i._raise("fileremoved",[c,u])}))})}),i.$preview.find(t.FRAMES+" .kv-file-upload").each(function(){var n=e(this);i._handler(n,"click",function(){var e=n.closest(t.FRAMES),a=e.attr("data-fileindex");e.hasClass("file-preview-error")||i._uploadSingle(a,i.filestack,!1)})}))},_initPreviewActions:function(){var i=this,n=i.$preview,a=i.deleteExtraData||{},r=t.FRAMES+" .kv-file-remove",s=function(){var e=i.isUploadable?i.previewCache.count():i.$element.get(0).files.length;0!==n.find(r).length||e||(i.reset(),i.initialCaption="")};i._initZoomButton(),n.find(r).each(function(){var r=e(this),o=r.data("url")||i.deleteUrl,l=r.data("key");if(!t.isEmpty(o)&&void 0!==l){var d,c,u,p,h=r.closest(t.FRAMES),m=i.previewCache.data,f=h.data("fileindex");f=parseInt(f.replace("init_","")),u=t.isEmpty(m.config)&&t.isEmpty(m.config[f])?null:m.config[f],p=t.isEmpty(u)||t.isEmpty(u.extra)?a:u.extra,"function"==typeof p&&(p=p()),c={id:r.attr("id"),key:l,extra:p},d=e.extend(!0,{},{url:o,type:"POST",dataType:"json",data:e.extend(!0,{},{key:l},p),beforeSend:function(e){i.ajaxAborted=!1,i._raise("filepredelete",[l,e,p]),i.ajaxAborted?e.abort():(t.addCss(h,"file-uploading"),t.addCss(r,"disabled"))},success:function(e,a,o){var d,u;return t.isEmpty(e)||t.isEmpty(e.error)?(i.previewCache.init(),f=parseInt(h.data("fileindex").replace("init_","")),i.previewCache.unset(f),d=i.previewCache.count(),u=d>0?i._getMsgSelected(d):"",i._deleteFileIndex(h),i._setCaption(u),i._raise("filedeleted",[l,o,p]),h.removeClass("file-uploading").addClass("file-deleted"),void h.fadeOut("slow",function(){t.cleanZoomCache(n.find("#zoom-"+h.attr("id"))),i._clearObjects(h),h.remove(),s(),d||0!==i.getFileStack().length||(i._setCaption(""),i.reset())})):(c.jqXHR=o,c.response=e,i._showError(e.error,c,"filedeleteerror"),h.removeClass("file-uploading"),r.removeClass("disabled"),void s())},error:function(e,t,n){var a=i.ajaxOperations.deleteThumb,r=i._parseError(a,e,n);c.jqXHR=e,c.response={},i._showError(r,c,"filedeleteerror"),h.removeClass("file-uploading"),s()}},i.ajaxDeleteSettings),i._handler(r,"click",function(){return!!i._validateMinCount()&&void e.ajax(d)})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(t){var i,n,a,r=this,s=parseFloat(t),o=r.fileSizeGetter;return e.isNumeric(t)&&e.isNumeric(s)?("function"==typeof o?a=o(s):0===s?a="0.00 B":(i=Math.floor(Math.log(s)/Math.log(1024)),n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=1*(s/Math.pow(1024,i)).toFixed(2)+" "+n[i]),r._getLayoutTemplate("size").replace("{sizeText}",a)):""},_generatePreviewTemplate:function(e,i,n,a,r,s,o,l,d,c,u){var p,h=this,m=h.slug(n),f="",g=h.previewSettings[e]||h.defaults.previewSettings[e],v=g&&g.width?g.width:"",w=g&&g.height?g.height:"",y=d||h._renderFileFooter(m,o,t.isEmpty(v)?"auto":v,s),b=h._getPreviewIcon(n),C=b&&h.preferIconicPreview,k=b&&h.preferIconicZoomPreview,_=function(i,s,o,d){var p=o?"zoom-"+r:r,f=h._getPreviewTemplate(i),g=(l||"")+" "+d;return h.frameClass&&(g=h.frameClass+" "+g),o&&(g=g.replace(" "+t.SORT_CSS,"")),f=h._parseFilePreviewIcon(f,n),"text"===i&&(s=t.htmlEncode(s)),f.replace(/\{previewId}/g,p).replace(/\{caption}/g,m).replace(/\{frameClass}/g,g).replace(/\{type}/g,a).replace(/\{fileindex}/g,c).replace(/\{width}/g,v).replace(/\{height}/g,w).replace(/\{footer}/g,y).replace(/\{data}/g,s).replace(/\{template}/g,u||e)};return c=c||r.slice(r.lastIndexOf("-")+1),h.fileActionSettings.showZoom&&(f=_(k?"other":e,i,!0,"kv-zoom-thumb")),f="\n"+h._getLayoutTemplate("zoomCache").replace("{zoomContent}",f),p=_(C?"other":e,i,!1,"kv-preview-thumb"),p+f},_previewDefault:function(i,n,a){var r=this,s=r.$preview;if(r.showPreview){var o,l=i?i.name:"",d=i?i.type:"",c=i.size||0,u=r.slug(l),p=a===!0&&!r.isUploadable,h=t.objUrl.createObjectURL(i);r._clearDefaultPreview(),o=r._generatePreviewTemplate("other",h,l,d,n,p,c),s.append("\n"+o),r._setThumbAttr(n,u,c),a===!0&&r.isUploadable&&r._setThumbStatus(e("#"+n),"Error")}},_previewFile:function(e,t,i,n,a){if(this.showPreview){var r,s=this,o=s._parseFileType(t),l=t?t.name:"",d=s.slug(l),c=s.allowedPreviewTypes,u=s.allowedPreviewMimeTypes,p=s.$preview,h=c&&c.indexOf(o)>=0,m=t.size||0,f="text"===o||"html"===o||"image"===o?i.target.result:a,g=u&&u.indexOf(t.type)!==-1;"html"===o&&s.purifyHtml&&window.DOMPurify&&(f=window.DOMPurify.sanitize(f)),h||g?(r=s._generatePreviewTemplate(o,f,l,t.type,n,!1,m),s._clearDefaultPreview(),p.append("\n"+r),s._validateImage(n,d,t.type)):s._previewDefault(t,n),s._setThumbAttr(n,d,m),s._initSortable()}},_setThumbAttr:function(t,i,n){var a=this,r=e("#"+t);r.length&&(n=n&&n>0?a._getSize(n):"",r.data({caption:i,size:n}))},_setInitThumbAttr:function(){var e,i,n,a,r=this,s=r.previewCache.data,o=r.previewCache.count(!0);if(0!==o)for(var l=0;l<o;l++)e=s.config[l],a=r.previewInitId+"-init_"+l,i=t.ifSet("caption",e,t.ifSet("filename",e)),n=t.ifSet("size",e),r._setThumbAttr(a,i,n)},_slugDefault:function(e){return t.isEmpty(e)?"":String(e).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(i){this.reader=new FileReader;var n,a=this,r=a.$element,s=a.$preview,o=a.reader,l=a.$previewContainer,d=a.$previewStatus,c=a.msgLoading,u=a.msgProgress,p=a.previewInitId,h=i.length,m=a.fileTypeSettings,f=a.filestack.length,g=a.allowedFileTypes,v=g?g.length:0,w=a.allowedFileExtensions,y=t.isEmpty(w)?"":w.join(", "),b=a.maxFilePreviewSize&&parseFloat(a.maxFilePreviewSize),C=s.length&&(!b||isNaN(b)),k=function(t,r,s,o){var l=e.extend(!0,{},a._getOutData({},{},i),{id:s,index:o}),d={id:s,index:o,file:r,files:i};return a._previewDefault(r,s,!0),a.isUploadable&&(a.addToStack(void 0),setTimeout(function(){n(o+1)},100)),a._initFileActions(),a.removeFromPreviewOnError&&e("#"+s).remove(),a.isUploadable?a._showUploadError(t,l):a._showError(t,d)};a.loadedImages=[],a.totalImagesCount=0,e.each(i,function(e,t){var i=a.fileTypeSettings.image;i&&i(t.type)&&a.totalImagesCount++}),n=function(e){if(t.isEmpty(r.attr("multiple"))&&(h=1),e>=h)return a.isUploadable&&a.filestack.length>0?a._raise("filebatchselected",[a.getFileStack()]):a._raise("filebatchselected",[i]),l.removeClass("file-thumb-loading"),void d.html("");var _,T,I,F,x,E,S,D,j,$,P=f+e,A=p+"-"+P,z=i[e],O=z.name?a.slug(z.name):"",Q=(z.size||0)/1e3,M="",L=t.objUrl.createObjectURL(z),R=0,U="";if(v>0)for(F=0;F<v;F++)D=g[F],j=a.msgFileTypes[D]||D,U+=0===F?j:", "+j;if(O===!1)return void n(e+1);if(0===O.length)return x=a.msgInvalidFileName.replace("{name}",t.htmlEncode(z.name)),void(a.isError=k(x,z,A,e));if(t.isEmpty(w)||(M=new RegExp("\\.("+w.join("|")+")$","i")),I=Q.toFixed(2),a.maxFileSize>0&&Q>a.maxFileSize)return x=a.msgSizeTooLarge.replace("{name}",O).replace("{size}",I).replace("{maxSize}",a.maxFileSize),void(a.isError=k(x,z,A,e));if(null!==a.minFileSize&&Q<=t.getNum(a.minFileSize))return x=a.msgSizeTooSmall.replace("{name}",O).replace("{size}",I).replace("{minSize}",a.minFileSize),void(a.isError=k(x,z,A,e));if(!t.isEmpty(g)&&t.isArray(g)){for(F=0;F<g.length;F+=1)E=g[F],$=m[E],R+=$&&"function"==typeof $&&$(z.type,z.name)?1:0;if(0===R)return x=a.msgInvalidFileType.replace("{name}",O).replace("{types}",U),void(a.isError=k(x,z,A,e))}return 0!==R||t.isEmpty(w)||!t.isArray(w)||t.isEmpty(M)||(S=t.compare(O,M),R+=t.isEmpty(S)?0:S.length,0!==R)?a.showPreview?!C&&Q>b?(a.addToStack(z),l.addClass("file-thumb-loading"),a._previewDefault(z,A),a._initFileActions(),a._updateFileDetails(h),void n(e+1)):(s.length&&void 0!==FileReader?(d.html(c.replace("{index}",e+1).replace("{files}",h)),l.addClass("file-thumb-loading"),o.onerror=function(e){a._errorHandler(e,O)},o.onload=function(t){a._previewFile(e,z,t,A,L),a._initFileActions()},o.onloadend=function(){x=u.replace("{index}",e+1).replace("{files}",h).replace("{percent}",50).replace("{name}",O),setTimeout(function(){d.html(x),a._updateFileDetails(h),n(e+1)},100),a._raise("fileloaded",[z,A,e,o])},o.onprogress=function(t){if(t.lengthComputable){var i=t.loaded/t.total*100,n=Math.ceil(i);x=u.replace("{index}",e+1).replace("{files}",h).replace("{percent}",n).replace("{name}",O),setTimeout(function(){d.html(x)},100)}},_=m.text,T=m.image,_(z.type,O)?o.readAsText(z,a.textEncoding):T(z.type,O)?o.readAsDataURL(z):o.readAsArrayBuffer(z)):(a._previewDefault(z,A),setTimeout(function(){n(e+1),a._updateFileDetails(h)},100),a._raise("fileloaded",[z,A,e,o])),void a.addToStack(z)):(a.addToStack(z),setTimeout(function(){n(e+1)},100),void a._raise("fileloaded",[z,A,e,o])):(x=a.msgInvalidFileExtension.replace("{name}",O).replace("{extensions}",y),void(a.isError=k(x,z,A,e)))},n(0),a._updateFileDetails(h,!1)},_updateFileDetails:function(e){var i=this,n=i.$element,a=i.getFileStack(),r=t.isIE(9)&&t.findFileName(n.val())||n[0].files[0]&&n[0].files[0].name||a.length&&a[0].name||"",s=i.slug(r),o=i.isUploadable?a.length:e,l=i.previewCache.count()+o,d=o>1?i._getMsgSelected(l):s;i.isError?(i.$previewContainer.removeClass("file-thumb-loading"),i.$previewStatus.html(""),i.$captionContainer.find(".kv-caption-icon").hide()):i._showFileIcon(),i._setCaption(d,i.isError),i.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&i._raise("fileselect",[e,s]),i.previewCache.count()&&i._initPreviewActions()},_setThumbStatus:function(e,t){var i=this;if(i.showPreview){var n="indicator"+t,a=n+"Title",r="file-preview-"+t.toLowerCase(),s=e.find(".file-upload-indicator"),o=i.fileActionSettings;e.removeClass("file-preview-success file-preview-error file-preview-loading"),"Error"===t&&e.find(".kv-file-upload").attr("disabled",!0),"Success"===t&&(e.find(".file-drag-handle").remove(),s.css("margin-left",0)),s.html(o[n]),s.attr("title",o[a]),e.addClass(r)}},_setProgressCancelled:function(){var e=this;e._setProgress(101,e.$progress,e.msgCancelled)},_setProgress:function(e,i,n){var a,r,s=this,o=Math.min(e,100),l=s.progressUploadThreshold,d=e<=100?s.progressTemplate:s.progressCompleteTemplate,c=o<100?s.progressTemplate:n?s.progressErrorTemplate:d;i=i||s.$progress,t.isEmpty(c)||(l&&o>l&&e<=100?a=c.replace(/\{percent}/g,l).replace(/\{status}/g,s.msgUploadThreshold):(r=e>100?s.msgUploadEnd:o+"%",a=c.replace(/\{percent}/g,o).replace(/\{status}/g,r)),i.html(a),n&&i.find('[role="progressbar"]').html(n))},_setFileDropZoneTitle:function(){var e,i=this,n=i.$container.find(".file-drop-zone"),a=i.dropZoneTitle;i.isClickable&&(e=t.isEmpty(i.$element.attr("multiple"))?i.fileSingle:i.filePlural,a+=i.dropZoneClickTitle.replace("{files}",e)),n.find("."+i.dropZoneTitleClass).remove(),i.isUploadable&&i.showPreview&&0!==n.length&&!(i.getFileStack().length>0)&&i.dropZoneEnabled&&(0===n.find(t.FRAMES).length&&t.isEmpty(i.defaultPreviewContent)&&n.prepend('<div class="'+i.dropZoneTitleClass+'">'+a+"</div>"),i.$container.removeClass("file-input-new"),t.addCss(i.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(t,i,n){var a=this,r=0;a._setProgress(i,e("#"+t).find(".file-thumb-progress")),a.uploadStatus[t]=i,e.each(a.uploadStatus,function(e,t){r+=t}),a._setProgress(Math.floor(r/n))},_validateMinCount:function(){var e=this,t=e.isUploadable?e.getFileStack().length:e.$element.get(0).files.length;return!(e.validateInitialCount&&e.minFileCount>0&&e._getFileCount(t-1)<e.minFileCount)||(e._noFilesError({}),!1)},_getFileCount:function(e){var t=this,i=0;return t.validateInitialCount&&!t.overwriteInitial&&(i=t.previewCache.count(),e+=i),e},_getFileId:function(e){var t,i=this,n=i.generateFileId;return"function"==typeof n?n(e,event):e?(t=e.webkitRelativePath||e.fileName||e.name||null,t?e.size+"-"+t.replace(/[^0-9a-zA-Z_-]/gim,""):null):null},_getFileName:function(e){return e&&e.name?this.slug(e.name):void 0},_getFileIds:function(e){var t=this;return t.fileids.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},_getFileNames:function(e){var t=this;return t.filenames.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},_setPreviewError:function(e,t,i){var n=this;void 0!==t&&n.updateStack(t,i),n.removeFromPreviewOnError?e.remove():n._setThumbStatus(e,"Error")},_checkDimensions:function(e,i,n,a,r,s,o){var l,d,c,u,p=this,h="Small"===i?"min":"max",m=p[h+"Image"+s];!t.isEmpty(m)&&n.length&&(c=n[0],d="Width"===s?c.naturalWidth||c.width:c.naturalHeight||c.height,u="Small"===i?d>=m:d<=m,u||(l=p["msgImage"+s+i].replace("{name}",r).replace("{size}",m),p._showUploadError(l,o),p._setPreviewError(a,e,null)))},_validateImage:function(e,t,i){var n,a,r,s=this,o=s.$preview,l=o.find("#"+e),d=l.attr("data-fileindex"),c=l.find("img");t=t||"Untitled",c.length&&s._handler(c,"load",function(){a=l.width(),r=o.width(),a>r&&(c.css("width","100%"),l.css("width","97%")),n={ind:d,id:e},s._checkDimensions(d,"Small",c,l,t,"Width",n),s._checkDimensions(d,"Small",c,l,t,"Height",n),s.resizeImage||(s._checkDimensions(d,"Large",c,l,t,"Width",n),s._checkDimensions(d,"Large",c,l,t,"Height",n)),s._raise("fileimageloaded",[e]),s.loadedImages.push({ind:d,img:c,thumb:l,pid:e,typ:i}),s._validateAllImages()})},_validateAllImages:function(){var e,t=this,i={val:0},n=t.loadedImages.length;if(n===t.totalImagesCount&&(t._raise("fileimagesloaded"),t.resizeImage))for(e=0;e<t.loadedImages.length;e++)t._getResizedImage(t.loadedImages[e],i,n)},_getResizedImage:function(t,i,n){var a,r,s,o,l=this,d=e(t.img)[0],c=d.naturalWidth,u=d.naturalHeight,p=1,h=l.maxImageWidth||c,m=l.maxImageHeight||u,f=!(!c||!u),g=l.imageCanvas,v=l.imageCanvasContext,w=t.typ,y=t.pid,b=t.ind,C=t.thumb;if(s=function(e,t,i){l.isUploadable?l._showUploadError(e,t,i):l._showError(e,t,i),l._setPreviewError(C,b)},(!l.filestack[b]||!f||c<=h&&u<=m)&&(f&&l.filestack[b]&&l._raise("fileimageresized",[y,b]),i.val++,i.val===n&&l._raise("fileimagesresized"),!f))return void s(l.msgImageResizeError,{id:y,index:b},"fileimageresizeerror");w=w||l.resizeDefaultImageType,a=c>h,r=u>m,p="width"===l.resizePreference?a?h/c:r?m/u:1:r?m/u:a?h/c:1,l._resetCanvas(),c*=p,u*=p,g.width=c,g.height=u;try{v.drawImage(d,0,0,c,u),g.toBlob(function(e){l.filestack[b]=e,l._raise("fileimageresized",[y,b]),i.val++,i.val===n&&l._raise("fileimagesresized",[void 0,void 0]),e instanceof Blob||s(l.msgImageResizeError,{id:y,index:b},"fileimageresizeerror")},w,l.resizeQuality)}catch(e){i.val++,i.val===n&&l._raise("fileimagesresized",[void 0,void 0]),o=l.msgImageResizeException.replace("{errors}",e.message),s(o,{id:y,index:b},"fileimageresizeexception")}},_initBrowse:function(e){var t=this;t.showBrowse?(t.$btnFile=e.find(".btn-file"),t.$btnFile.append(t.$element)):t.$element.hide()},_initCaption:function(){var e=this,i=e.initialCaption||"";return e.overwriteInitial||t.isEmpty(i)?(e.$caption.html(""),
!1):(e._setCaption(i),!0)},_setCaption:function(i,n){var a,r,s,o,l=this,d=l.getFileStack();if(l.$caption.length){if(n)a=e("<div>"+l.msgValidationError+"</div>").text(),s=d.length,o=s?1===s&&d[0]?l._getFileNames()[0]:l._getMsgSelected(s):l._getMsgSelected(l.msgNo),r='<span class="'+l.msgValidationErrorClass+'">'+l.msgValidationErrorIcon+(t.isEmpty(i)?o:i)+"</span>";else{if(t.isEmpty(i))return;a=e("<div>"+i+"</div>").text(),r=l._getLayoutTemplate("fileIcon")+a}l.$caption.html(r),l.$caption.attr("title",a),l.$captionContainer.find(".file-caption-ellipsis").attr("title",a)}},_createContainer:function(){var t=this,i=e(document.createElement("div")).attr({class:"file-input file-input-new"}).html(t._renderMain());return t.$element.before(i),t._initBrowse(i),t.theme&&i.addClass("theme-"+t.theme),i},_refreshContainer:function(){var e=this,t=e.$container;t.before(e.$element),t.html(e._renderMain()),e._initBrowse(t)},_renderMain:function(){var e=this,t=e.isUploadable&&e.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=e.showClose?e._getLayoutTemplate("close"):"",n=e.showPreview?e._getLayoutTemplate("preview").replace(/\{class}/g,e.previewClass).replace(/\{dropClass}/g,t):"",a=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,r=e.captionTemplate.replace(/\{class}/g,a+" kv-fileinput-caption");return e.mainTemplate.replace(/\{class}/g,e.mainClass+(!e.showBrowse&&e.showCaption?" no-browse":"")).replace(/\{preview}/g,n).replace(/\{close}/g,i).replace(/\{caption}/g,r).replace(/\{upload}/g,e._renderButton("upload")).replace(/\{remove}/g,e._renderButton("remove")).replace(/\{cancel}/g,e._renderButton("cancel")).replace(/\{browse}/g,e._renderButton("browse"))},_renderButton:function(e){var i=this,n=i._getLayoutTemplate("btnDefault"),a=i[e+"Class"],r=i[e+"Title"],s=i[e+"Icon"],o=i[e+"Label"],l=i.isDisabled?" disabled":"",d="button";switch(e){case"remove":if(!i.showRemove)return"";break;case"cancel":if(!i.showCancel)return"";a+=" hide";break;case"upload":if(!i.showUpload)return"";i.isUploadable&&!i.isDisabled?n=i._getLayoutTemplate("btnLink").replace("{href}",i.uploadUrl):d="submit";break;case"browse":if(!i.showBrowse)return"";n=i._getLayoutTemplate("btnBrowse");break;default:return""}return a+="browse"===e?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button",t.isEmpty(o)||(o=' <span class="'+i.buttonLabelClass+'">'+o+"</span>"),n.replace("{type}",d).replace("{css}",a).replace("{title}",r).replace("{status}",l).replace("{icon}",s).replace("{label}",o)},_renderThumbProgress:function(){var e=this;return'<div class="file-thumb-progress hide">'+e.progressTemplate.replace(/\{percent}/g,"0").replace(/\{status}/g,e.msgUploadBegin)+"</div>"},_renderFileFooter:function(e,i,n,a){var r,s=this,o=s.fileActionSettings,l=o.showRemove,d=o.showDrag,c=o.showUpload,u=o.showZoom,p=s._getLayoutTemplate("footer"),h=a?o.indicatorError:o.indicatorNew,m=a?o.indicatorErrorTitle:o.indicatorNewTitle;return i=s._getSize(i),r=s.isUploadable?p.replace(/\{actions}/g,s._renderFileActions(c,l,u,d,!1,!1,!1)).replace(/\{caption}/g,e).replace(/\{size}/g,i).replace(/\{width}/g,n).replace(/\{progress}/g,s._renderThumbProgress()).replace(/\{indicator}/g,h).replace(/\{indicatorTitle}/g,m):p.replace(/\{actions}/g,s._renderFileActions(!1,!1,u,d,!1,!1,!1)).replace(/\{caption}/g,e).replace(/\{size}/g,i).replace(/\{width}/g,n).replace(/\{progress}/g,"").replace(/\{indicator}/g,h).replace(/\{indicatorTitle}/g,m),r=t.replaceTags(r,s.previewThumbTags)},_renderFileActions:function(e,t,i,n,a,r,s,o){if(!(e||t||i||n))return"";var l,d=this,c=r===!1?"":' data-url="'+r+'"',u=s===!1?"":' data-key="'+s+'"',p="",h="",m="",f="",g=d._getLayoutTemplate("actions"),v=d.fileActionSettings,w=d.otherActionButtons.replace(/\{dataKey}/g,u),y=a?v.removeClass+" disabled":v.removeClass;return t&&(p=d._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,y).replace(/\{removeIcon}/g,v.removeIcon).replace(/\{removeTitle}/g,v.removeTitle).replace(/\{dataUrl}/g,c).replace(/\{dataKey}/g,u)),e&&(h=d._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,v.uploadClass).replace(/\{uploadIcon}/g,v.uploadIcon).replace(/\{uploadTitle}/g,v.uploadTitle)),i&&(m=d._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,v.zoomClass).replace(/\{zoomIcon}/g,v.zoomIcon).replace(/\{zoomTitle}/g,v.zoomTitle)),n&&o&&(l="drag-handle-init "+v.dragClass,f=d._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,l).replace(/\{dragTitle}/g,v.dragTitle).replace(/\{dragIcon}/g,v.dragIcon)),g.replace(/\{delete}/g,p).replace(/\{upload}/g,h).replace(/\{zoom}/g,m).replace(/\{drag}/g,f).replace(/\{other}/g,w)},_browse:function(e){var t=this;t._raise("filebrowse"),e&&e.isDefaultPrevented()||(t.isError&&!t.isUploadable&&t.clear(),t.$captionContainer.focus())},_filterDuplicate:function(e,t,i){var n=this,a=n._getFileId(e);a&&i&&i.indexOf(a)>-1||(i||(i=[]),t.push(e),i.push(a))},_change:function(i){var n=this,a=n.$element;if(!n.isUploadable&&t.isEmpty(a.val())&&n.fileInputCleared)return void(n.fileInputCleared=!1);n.fileInputCleared=!1;var r,s,o,l,d=[],c=arguments.length>1,u=n.isUploadable,p=c?i.originalEvent.dataTransfer.files:a.get(0).files,h=n.filestack.length,m=t.isEmpty(a.attr("multiple")),f=m&&h>0,g=0,v=n._getFileIds(),w=function(t,i,a,r){var s=e.extend(!0,{},n._getOutData({},{},p),{id:a,index:r}),o={id:a,index:r,file:i,files:p};return n.isUploadable?n._showUploadError(t,s):n._showError(t,o)};if(n.reader=null,n._resetUpload(),n._hideFileIcon(),n.isUploadable&&n.$container.find(".file-drop-zone ."+n.dropZoneTitleClass).remove(),c?e.each(p,function(e,t){t&&!t.type&&void 0!==t.size&&t.size%4096===0?g++:n._filterDuplicate(t,d,v)}):(p=i.target&&void 0===i.target.files?i.target.value?[{name:i.target.value.replace(/^.+\\/,"")}]:[]:i.target.files||{},e.each(p,function(e,t){n._filterDuplicate(t,d,v)})),t.isEmpty(d)||0===d.length)return u||n.clear(),n._showFolderError(g),void n._raise("fileselectnone");if(n._resetErrors(),l=d.length,s=n._getFileCount(n.isUploadable?n.getFileStack().length+l:l),n.maxFileCount>0&&s>n.maxFileCount){if(!n.autoReplace||l>n.maxFileCount)return o=n.autoReplace&&l>n.maxFileCount?l:s,r=n.msgFilesTooMany.replace("{m}",n.maxFileCount).replace("{n}",o),n.isError=w(r,null,null,null),n.$captionContainer.find(".kv-caption-icon").hide(),n._setCaption("",!0),void n.$container.removeClass("file-input-new file-input-ajax-new");s>n.maxFileCount&&n._resetPreviewThumbs(u)}else!u||f?(n._resetPreviewThumbs(!1),f&&n.clearStack()):!u||0!==h||n.previewCache.count()&&!n.overwriteInitial||n._resetPreviewThumbs(!0);n.isPreviewable?n._readFiles(d):n._updateFileDetails(1),n._showFolderError(g)},_abort:function(t){var i,n=this;return!(!n.ajaxAborted||"object"!=typeof n.ajaxAborted||void 0===n.ajaxAborted.message)&&(i=e.extend(!0,{},n._getOutData(),t),i.abortData=n.ajaxAborted.data||{},i.abortMessage=n.ajaxAborted.message,n.cancel(),n._setProgress(101,n.$progress,n.msgCancelled),n._showUploadError(n.ajaxAborted.message,i,"filecustomerror"),!0)},_resetFileStack:function(){var i=this,n=0,a=[],r=[],s=[];i._getThumbs().each(function(){var o,l=e(this),d=l.attr("data-fileindex"),c=i.filestack[d],u=l.attr("id");"-1"!==d&&d!==-1&&(void 0!==c?(a[n]=c,r[n]=i._getFileName(c),s[n]=i._getFileId(c),l.attr({id:i.previewInitId+"-"+n,"data-fileindex":n}),n++):(o="uploaded-"+t.uniqId(),l.attr({id:o,"data-fileindex":"-1"}),i.$preview.find("#zoom-"+u).attr("id","zoom-"+o)))}),i.filestack=a,i.filenames=r,i.fileids=s},clearStack:function(){var e=this;return e.filestack=[],e.filenames=[],e.fileids=[],e.$element},updateStack:function(e,t){var i=this;return i.filestack[e]=t,i.filenames[e]=i._getFileName(t),i.fileids[e]=t&&i._getFileId(t)||null,i.$element},addToStack:function(e){var t=this;return t.filestack.push(e),t.filenames.push(t._getFileName(e)),t.fileids.push(t._getFileId(e)),t.$element},getFileStack:function(e){var t=this;return t.filestack.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},getFilesCount:function(){var e=this,t=e.isUploadable?e.getFileStack().length:e.$element.get(0).files.length;return e._getFileCount(t)},lock:function(){var e=this;return e._resetErrors(),e.disable(),e.showRemove&&t.addCss(e.$container.find(".fileinput-remove"),"hide"),e.showCancel&&e.$container.find(".fileinput-cancel").removeClass("hide"),e._raise("filelock",[e.filestack,e._getExtraData()]),e.$element},unlock:function(e){var i=this;return void 0===e&&(e=!0),i.enable(),i.showCancel&&t.addCss(i.$container.find(".fileinput-cancel"),"hide"),i.showRemove&&i.$container.find(".fileinput-remove").removeClass("hide"),e&&i._resetFileStack(),i._raise("fileunlock",[i.filestack,i._getExtraData()]),i.$element},cancel:function(){var t,i=this,n=i.ajaxRequests,a=n.length;if(a>0)for(t=0;t<a;t+=1)i.cancelling=!0,n[t].abort();return i._setProgressCancelled(),i._getThumbs().each(function(){var t=e(this),n=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==i.filestack[n]&&(t.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),t.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),i.unlock()}),i.$element},clear:function(){var i,n=this;if(n._raise("fileclear"))return n.$btnUpload.removeAttr("disabled"),n._getThumbs().find("video,audio,img").each(function(){t.cleanMemory(e(this))}),n._resetUpload(),n.clearStack(),n._clearFileInput(),n._resetErrors(!0),n._hasInitialPreview()?(n._showFileIcon(),n._resetPreview(),n._initPreviewActions(),n.$container.removeClass("file-input-new")):(n._getThumbs().each(function(){n._clearObjects(e(this))}),n.isUploadable&&(n.previewCache.data={}),n.$preview.html(""),i=!n.overwriteInitial&&n.initialCaption.length>0?n.initialCaption:"",n.$caption.html(i),n.$caption.attr("title",""),t.addCss(n.$container,"file-input-new"),n._validateDefaultPreview()),0===n.$container.find(t.FRAMES).length&&(n._initCaption()||n.$captionContainer.find(".kv-caption-icon").hide()),n._hideFileIcon(),n._raise("filecleared"),n.$captionContainer.focus(),n._setFileDropZoneTitle(),n.$element},reset:function(){var e=this;if(e._raise("filereset"))return e._resetPreview(),e.$container.find(".fileinput-filename").text(""),t.addCss(e.$container,"file-input-new"),(e.$preview.find(t.FRAMES).length||e.isUploadable&&e.dropZoneEnabled)&&e.$container.removeClass("file-input-new"),e._setFileDropZoneTitle(),e.clearStack(),e.formdata={},e.$element},disable:function(){var e=this;return e.isDisabled=!0,e._raise("filedisabled"),e.$element.attr("disabled","disabled"),e.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),e.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),e._initDragDrop(),e.$element},enable:function(){var e=this;return e.isDisabled=!1,e._raise("fileenabled"),e.$element.removeAttr("disabled"),e.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),e.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),e._initDragDrop(),e.$element},upload:function(){var i,n,a,r=this,s=r.getFileStack().length,o={},l=!e.isEmptyObject(r._getExtraData());if(r.isUploadable&&!r.isDisabled){if(r.minFileCount>0&&r._getFileCount(s)<r.minFileCount)return void r._noFilesError(o);if(r._resetUpload(),0===s&&!l)return void r._showUploadError(r.msgUploadEmpty);if(r.$progress.removeClass("hide"),r.uploadCount=0,r.uploadStatus={},r.uploadLog=[],r.lock(),r._setProgress(2),0===s&&l)return void r._uploadExtraOnly();if(a=r.filestack.length,r.hasInitData=!1,!r.uploadAsync)return r._uploadBatch(),r.$element;for(n=r._getOutData(),r._raise("filebatchpreupload",[n]),r.fileBatchCompleted=!1,r.uploadCache={content:[],config:[],tags:[],append:!0},r.uploadAsyncCount=r.getFileStack().length,i=0;i<a;i++)r.uploadCache.content[i]=null,r.uploadCache.config[i]=null,r.uploadCache.tags[i]=null;for(r.$preview.find(".file-preview-initial").removeClass(t.SORT_CSS),r._initSortable(),r.cacheInitialPreview=r.getPreview(),i=0;i<a;i++)void 0!==r.filestack[i]&&r._uploadSingle(i,r.filestack,!0)}},destroy:function(){var t=this,i=t.$form,n=t.$container,a=t.$element,r=t.namespace;return e(document).off(r),e(window).off(r),i&&i.length&&i.off(r),a.insertBefore(n).off(r).removeData(),n.off().remove(),a},refresh:function(t){var i=this,n=i.$element;return t=t?e.extend(!0,{},i.options,t):i.options,i.destroy(),n.fileinput(t),n.val()&&n.trigger("change.fileinput"),n},zoom:function(i){var n=this,a=e("#"+i),r=n.$modal;return a.length?(t.initModal(r),r.html(n._getModalContent()),n._setZoomContent(a),r.modal("show"),void n._initZoomButtons()):void n._log('Cannot zoom to detailed preview! Invalid frame with id: "'+i+'".')},getPreview:function(){var e=this;return{content:e.initialPreview,config:e.initialPreviewConfig,tags:e.initialPreviewThumbTags}}},e.fn.fileinput=function(n){if(t.hasFileAPISupport()||t.isIE(9)){var a=Array.apply(null,arguments),r=[];switch(a.shift(),this.each(function(){var s,o=e(this),l=o.data("fileinput"),d="object"==typeof n&&n,c=d.theme||o.data("theme"),u={},p={},h=d.language||o.data("language")||e.fn.fileinput.defaults.language||"en";l||(c&&(p=e.fn.fileinputThemes[c]||{}),"en"===h||t.isEmpty(e.fn.fileinputLocales[h])||(u=e.fn.fileinputLocales[h]||{}),s=e.extend(!0,{},e.fn.fileinput.defaults,p,e.fn.fileinputLocales.en,u,d,o.data()),l=new i(this,s),o.data("fileinput",l)),"string"==typeof n&&r.push(l[n].apply(l,a))}),r.length){case 0:return this;case 1:return r[0];default:return r}}},e.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},e.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},e.fn.fileinput.Constructor=i,e(document).ready(function(){var t=e("input.file[type=file]");t.length&&t.fileinput()})}),function(e,t){"use strict";function i(e,t){var i=t||{};for(var n in e)n in i||(i[n]=e[n]);return i}function n(e,i){if(o)o(e).trigger(i);else{var n=t.createEvent("CustomEvent");n.initCustomEvent(i,!0,!0,{}),e.dispatchEvent(n)}}function a(e,t){return o?o(e).hasClass(t):e.classList.contains(t)}function r(e,t){this.dateDelta=null,this.timeDelta=null,this._defaults={startClass:"start",endClass:"end",timeClass:"time",dateClass:"date",defaultDateDelta:0,defaultTimeDelta:36e5,anchor:"start",parseTime:function(e){return o(e).timepicker("getTime")},updateTime:function(e,t){o(e).timepicker("setTime",t)},setMinTime:function(e,t){o(e).timepicker("option","minTime",t)},parseDate:function(e){return e.value&&o(e).datepicker("getDate")},updateDate:function(e,t){o(e).datepicker("update",t)}},this.container=e,this.settings=i(this._defaults,t),this.startDateInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.dateClass),this.endDateInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.dateClass),this.startTimeInput=this.container.querySelector("."+this.settings.startClass+"."+this.settings.timeClass),this.endTimeInput=this.container.querySelector("."+this.settings.endClass+"."+this.settings.timeClass),this.refresh(),this._bindChangeHandler()}var s=864e5,o=e.Zepto||e.jQuery;r.prototype={constructor:r,option:function(e,t){if("object"==typeof e)this.settings=i(this.settings,e);else if("string"==typeof e&&"undefined"!=typeof t)this.settings[e]=t;else if("string"==typeof e)return this.settings[e];this._updateEndMintime()},getTimeDiff:function(){var e=this.dateDelta+this.timeDelta;return!(e<0)||this.startDateInput&&this.endDateInput||(e+=s),e},refresh:function(){if(this.startDateInput&&this.startDateInput.value&&this.endDateInput&&this.endDateInput.value){var e=this.settings.parseDate(this.startDateInput),t=this.settings.parseDate(this.endDateInput);e&&t&&(this.dateDelta=t.getTime()-e.getTime())}if(this.startTimeInput&&this.startTimeInput.value&&this.endTimeInput&&this.endTimeInput.value){var i=this.settings.parseTime(this.startTimeInput),n=this.settings.parseTime(this.endTimeInput);i&&n&&(this.timeDelta=n.getTime()-i.getTime(),this._updateEndMintime())}},remove:function(){this._unbindChangeHandler()},_bindChangeHandler:function(){o?o(this.container).on("change.datepair",o.proxy(this.handleEvent,this)):this.container.addEventListener("change",this,!1)},_unbindChangeHandler:function(){o?o(this.container).off("change.datepair"):this.container.removeEventListener("change",this,!1)},handleEvent:function(e){this._unbindChangeHandler(),a(e.target,this.settings.dateClass)?""!=e.target.value?(this._dateChanged(e.target),this._timeChanged(e.target)):this.dateDelta=null:a(e.target,this.settings.timeClass)&&(""!=e.target.value?this._timeChanged(e.target):this.timeDelta=null),this._validateRanges(),this._updateEndMintime(),this._bindChangeHandler()},_dateChanged:function(e){if(this.startDateInput&&this.endDateInput){var t=this.settings.parseDate(this.startDateInput),i=this.settings.parseDate(this.endDateInput);if(t&&i)if("start"==this.settings.anchor&&a(e,this.settings.startClass)){var n=new Date(t.getTime()+this.dateDelta);this.settings.updateDate(this.endDateInput,n)}else if("end"==this.settings.anchor&&a(e,this.settings.endClass)){var n=new Date(i.getTime()-this.dateDelta);this.settings.updateDate(this.startDateInput,n)}else if(i<t){var r=a(e,this.settings.startClass)?this.endDateInput:this.startDateInput,o=this.settings.parseDate(e);this.dateDelta=0,this.settings.updateDate(r,o)}else this.dateDelta=i.getTime()-t.getTime();else if(null!==this.settings.defaultDateDelta){if(t){var l=new Date(t.getTime()+this.settings.defaultDateDelta*s);this.settings.updateDate(this.endDateInput,l)}else if(i){var d=new Date(i.getTime()-this.settings.defaultDateDelta*s);this.settings.updateDate(this.startDateInput,d)}this.dateDelta=this.settings.defaultDateDelta*s}else this.dateDelta=null}},_timeChanged:function(e){if(this.startTimeInput&&this.endTimeInput){var t=this.settings.parseTime(this.startTimeInput),i=this.settings.parseTime(this.endTimeInput);if(t&&i)if("start"==this.settings.anchor&&a(e,this.settings.startClass)){var n=new Date(t.getTime()+this.timeDelta);this.settings.updateTime(this.endTimeInput,n),i=this.settings.parseTime(this.endTimeInput),this._doMidnightRollover(t,i)}else if("end"==this.settings.anchor&&a(e,this.settings.endClass)){var n=new Date(i.getTime()-this.timeDelta);this.settings.updateTime(this.startTimeInput,n),t=this.settings.parseTime(this.startTimeInput),this._doMidnightRollover(t,i)}else{this._doMidnightRollover(t,i);var r,s;if(this.startDateInput&&this.endDateInput&&(r=this.settings.parseDate(this.startDateInput),s=this.settings.parseDate(this.endDateInput)),+r==+s&&i<t){var o=a(e,this.settings.endClass)?this.endTimeInput:this.startTimeInput,l=a(e,this.settings.startClass)?this.endTimeInput:this.startTimeInput,d=this.settings.parseTime(o);this.timeDelta=0,this.settings.updateTime(l,d)}else this.timeDelta=i.getTime()-t.getTime()}else if(null!==this.settings.defaultTimeDelta){if(t){var c=new Date(t.getTime()+this.settings.defaultTimeDelta);this.settings.updateTime(this.endTimeInput,c)}else if(i){var u=new Date(i.getTime()-this.settings.defaultTimeDelta);this.settings.updateTime(this.startTimeInput,u)}this.timeDelta=this.settings.defaultTimeDelta}else this.timeDelta=null}},_doMidnightRollover:function(e,t){if(this.startDateInput&&this.endDateInput){var i=this.settings.parseDate(this.endDateInput),n=this.settings.parseDate(this.startDateInput),a=t.getTime()-e.getTime(),r=t<e?s:-1*s;null!==this.dateDelta&&this.dateDelta+this.timeDelta<=s&&this.dateDelta+a!=0&&(r>0||0!=this.dateDelta)&&(a>=0&&this.timeDelta<0||a<0&&this.timeDelta>=0)&&("start"==this.settings.anchor?(this.settings.updateDate(this.endDateInput,new Date(i.getTime()+r)),this._dateChanged(this.endDateInput)):"end"==this.settings.anchor&&(this.settings.updateDate(this.startDateInput,new Date(n.getTime()-r)),this._dateChanged(this.startDateInput))),this.timeDelta=a}},_updateEndMintime:function(){if("function"==typeof this.settings.setMinTime){var e=null;"start"==this.settings.anchor&&(!this.dateDelta||this.dateDelta<s||this.timeDelta&&this.dateDelta+this.timeDelta<s)&&(e=this.settings.parseTime(this.startTimeInput)),this.settings.setMinTime(this.endTimeInput,e)}},_validateRanges:function(){return this.startTimeInput&&this.endTimeInput&&null===this.timeDelta?void n(this.container,"rangeIncomplete"):this.startDateInput&&this.endDateInput&&null===this.dateDelta?void n(this.container,"rangeIncomplete"):void(!this.startDateInput||!this.endDateInput||this.dateDelta+this.timeDelta>=0?n(this.container,"rangeSelected"):n(this.container,"rangeError"))}},e.Datepair=r}(window,document),function(e){e&&(e.fn.datepair=function(t){var i;return this.each(function(){var n=e(this),a=n.data("datepair"),r="object"==typeof t&&t;a||(a=new Datepair(this,r),n.data("datepair",a)),"remove"===t&&(i=a.remove(),n.removeData("datepair",a)),"string"==typeof t&&(i=a[t]())}),i||this},e("[data-datepair]").each(function(){var t=e(this);t.datepair(t.data())}))}(window.Zepto||window.jQuery),function(){var e,t,i,n,a,r,s,o,l=[].slice,d={}.hasOwnProperty,c=function(e,t){function i(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};s=function(){},t=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,i,n,a,r;if(n=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],this._callbacks=this._callbacks||{},i=this._callbacks[n])for(a=0,r=i.length;a<r;a++)t=i[a],t.apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var i,n,a,r,s;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(n=this._callbacks[e],!n)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(a=r=0,s=n.length;r<s;a=++r)if(i=n[a],i===t){n.splice(a,1);break}return this},e}(),e=function(e){function i(e,t){var a,r,s;if(this.element=e,this.version=i.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(i.instances.push(this),this.element.dropzone=this,a=null!=(s=i.optionsForElement(this.element))?s:{},this.options=n({},this.defaultOptions,a,null!=t?t:{}),this.options.forceFallback||!i.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(r=this.getExistingFallback())&&r.parentNode&&r.parentNode.removeChild(r),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=i.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=i.getElements(this.options.clickable,"clickable")),this.init()}var n,a;return c(i,e),i.prototype.Emitter=t,i.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],i.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return s},forceFallback:!1,fallback:function(){var e,t,n,a,r,s;for(this.element.className=""+this.element.className+" dz-browser-not-supported",s=this.element.getElementsByTagName("div"),a=0,r=s.length;a<r;a++)e=s[a],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=i.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),n=t.getElementsByTagName("span")[0],n&&(null!=n.textContent?n.textContent=this.options.dictFallbackMessage:null!=n.innerText&&(n.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm());
},resize:function(e){var t,i,n;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},i=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=i*t.optHeight:null==t.optHeight&&(t.optHeight=1/i*t.optWidth),n=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):i>n?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*n):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/n),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:s,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:s,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,n,a,r,s,o,l,d,c,u,p,h,m;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=i.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),u=e.previewElement.querySelectorAll("[data-dz-name]"),r=0,l=u.length;r<l;r++)t=u[r],t.textContent=this._renameFilename(e.name);for(p=e.previewElement.querySelectorAll("[data-dz-size]"),s=0,d=p.length;s<d;s++)t=p[s],t.innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=i.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),n=function(t){return function(n){return n.preventDefault(),n.stopPropagation(),e.status===i.UPLOADING?i.confirm(t.options.dictCancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dictRemoveFileConfirmation?i.confirm(t.options.dictRemoveFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),h=e.previewElement.querySelectorAll("[data-dz-remove]"),m=[],o=0,c=h.length;o<c;o++)a=h[o],m.push(a.addEventListener("click",n));return m}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,n,a,r;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),r=e.previewElement.querySelectorAll("[data-dz-thumbnail]"),n=0,a=r.length;n<a;n++)i=r[n],i.alt=e.name,i.src=t;return setTimeout(function(t){return function(){return e.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(e,t){var i,n,a,r,s;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),r=e.previewElement.querySelectorAll("[data-dz-errormessage]"),s=[],n=0,a=r.length;n<a;n++)i=r[n],s.push(i.textContent=t);return s}},errormultiple:s,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:s,uploadprogress:function(e,t,i){var n,a,r,s,o;if(e.previewElement){for(s=e.previewElement.querySelectorAll("[data-dz-uploadprogress]"),o=[],a=0,r=s.length;a<r;a++)n=s[a],"PROGRESS"===n.nodeName?o.push(n.value=t):o.push(n.style.width=""+t+"%");return o}},totaluploadprogress:s,sending:s,sendingmultiple:s,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:s,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:s,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:s,maxfilesexceeded:s,maxfilesreached:s,queuecomplete:s,addedfiles:s,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},n=function(){var e,t,i,n,a,r,s;for(n=arguments[0],i=2<=arguments.length?l.call(arguments,1):[],r=0,s=i.length;r<s;r++){t=i[r];for(e in t)a=t[e],n[e]=a}return n},i.prototype.getAcceptedFiles=function(){var e,t,i,n,a;for(n=this.files,a=[],t=0,i=n.length;t<i;t++)e=n[t],e.accepted&&a.push(e);return a},i.prototype.getRejectedFiles=function(){var e,t,i,n,a;for(n=this.files,a=[],t=0,i=n.length;t<i;t++)e=n[t],e.accepted||a.push(e);return a},i.prototype.getFilesWithStatus=function(e){var t,i,n,a,r;for(a=this.files,r=[],i=0,n=a.length;i<n;i++)t=a[i],t.status===e&&r.push(t);return r},i.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(i.QUEUED)},i.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(i.UPLOADING)},i.prototype.getAddedFiles=function(){return this.getFilesWithStatus(i.ADDED)},i.prototype.getActiveFiles=function(){var e,t,n,a,r;for(a=this.files,r=[],t=0,n=a.length;t<n;t++)e=a[t],e.status!==i.UPLOADING&&e.status!==i.QUEUED||r.push(e);return r},i.prototype.init=function(){var e,t,n,a,r,s,o;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(i.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(n=function(e){return function(){return e.hiddenFileInput&&e.hiddenFileInput.parentNode.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="dz-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0",document.querySelector(e.options.hiddenInputContainer).appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,i,a,r;if(i=e.hiddenFileInput.files,i.length)for(a=0,r=i.length;a<r;a++)t=i[a],e.addFile(t);return e.emit("addedfiles",i),n()})}}(this))(),this.URL=null!=(s=window.URL)?s:window.webkitURL,o=this.events,a=0,r=o.length;a<r;a++)e=o[a],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){if(0===e.getAddedFiles().length&&0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length)return setTimeout(function(){return e.emit("queuecomplete")},0)}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(i){return t(i),e.emit("dragenter",i)}}(this),dragover:function(e){return function(i){var n;try{n=i.dataTransfer.effectAllowed}catch(e){}return i.dataTransfer.dropEffect="move"===n||"linkMove"===n?"move":"copy",t(i),e.emit("dragover",i)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(i){return t(i),e.drop(i)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(n){return(t!==e.element||n.target===e.element||i.elementInside(n.target,e.element.querySelector(".dz-message")))&&e.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},i.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,i.instances.splice(i.instances.indexOf(this),1)},i.prototype.updateTotalUploadProgress=function(){var e,t,i,n,a,r,s,o;if(n=0,i=0,e=this.getActiveFiles(),e.length){for(o=this.getActiveFiles(),r=0,s=o.length;r<s;r++)t=o[r],n+=t.upload.bytesSent,i+=t.upload.total;a=100*n/i}else a=100;return this.emit("totaluploadprogress",a,i,n)},i.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},i.prototype._renameFilename=function(e){return"function"!=typeof this.options.renameFilename?e:this.options.renameFilename(e)},i.prototype.getFallbackForm=function(){var e,t,n,a;return(e=this.getExistingFallback())?e:(n='<div class="dz-fallback">',this.options.dictFallbackText&&(n+="<p>"+this.options.dictFallbackText+"</p>"),n+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=i.createElement(n),"FORM"!==this.element.tagName?(a=i.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),a.appendChild(t)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=a?a:t)},i.prototype.getExistingFallback=function(){var e,t,i,n,a,r;for(t=function(e){var t,i,n;for(i=0,n=e.length;i<n;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},r=["div","form"],n=0,a=r.length;n<a;n++)if(i=r[n],e=t(this.element.getElementsByTagName(i)))return e},i.prototype.setupEventListeners=function(){var e,t,i,n,a,r,s;for(r=this.listeners,s=[],n=0,a=r.length;n<a;n++)e=r[n],s.push(function(){var n,a;n=e.events,a=[];for(t in n)i=n[t],a.push(e.element.addEventListener(t,i,!1));return a}());return s},i.prototype.removeEventListeners=function(){var e,t,i,n,a,r,s;for(r=this.listeners,s=[],n=0,a=r.length;n<a;n++)e=r[n],s.push(function(){var n,a;n=e.events,a=[];for(t in n)i=n[t],a.push(e.element.removeEventListener(t,i,!1));return a}());return s},i.prototype.disable=function(){var e,t,i,n,a;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),n=this.files,a=[],t=0,i=n.length;t<i;t++)e=n[t],a.push(this.cancelUpload(e));return a},i.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},i.prototype.filesize=function(e){var t,i,n,a,r,s,o,l;if(n=0,a="b",e>0){for(s=["TB","GB","MB","KB","b"],i=o=0,l=s.length;o<l;i=++o)if(r=s[i],t=Math.pow(this.options.filesizeBase,4-i)/10,e>=t){n=e/Math.pow(this.options.filesizeBase,4-i),a=r;break}n=Math.round(10*n)/10}return"<strong>"+n+"</strong> "+a},i.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},i.prototype.drop=function(e){var t,i;e.dataTransfer&&(this.emit("drop",e),t=e.dataTransfer.files,this.emit("addedfiles",t),t.length&&(i=e.dataTransfer.items,i&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t)))},i.prototype.paste=function(e){var t,i;if(null!=(null!=e&&null!=(i=e.clipboardData)?i.items:void 0))return this.emit("paste",e),t=e.clipboardData.items,t.length?this._addFilesFromItems(t):void 0},i.prototype.handleFiles=function(e){var t,i,n,a;for(a=[],i=0,n=e.length;i<n;i++)t=e[i],a.push(this.addFile(t));return a},i.prototype._addFilesFromItems=function(e){var t,i,n,a,r;for(r=[],n=0,a=e.length;n<a;n++)i=e[n],null!=i.webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?r.push(this.addFile(i.getAsFile())):t.isDirectory?r.push(this._addFilesFromDirectory(t,t.name)):r.push(void 0):null!=i.getAsFile&&(null==i.kind||"file"===i.kind)?r.push(this.addFile(i.getAsFile())):r.push(void 0);return r},i.prototype._addFilesFromDirectory=function(e,t){var i,n,a;return i=e.createReader(),n=function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0},(a=function(e){return function(){return i.readEntries(function(i){var n,r,s;if(i.length>0){for(r=0,s=i.length;r<s;r++)n=i[r],n.isFile?n.file(function(i){if(!e.options.ignoreHiddenFiles||"."!==i.name.substring(0,1))return i.fullPath=""+t+"/"+i.name,e.addFile(i)}):n.isDirectory&&e._addFilesFromDirectory(n,""+t+"/"+n.name);a()}return null},n)}}(this))()},i.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):i.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},i.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=i.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(i){return i?(e.accepted=!1,t._errorProcessing([e],i)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},i.prototype.enqueueFiles=function(e){var t,i,n;for(i=0,n=e.length;i<n;i++)t=e[i],this.enqueueFile(t);return null},i.prototype.enqueueFile=function(e){if(e.status!==i.ADDED||e.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=i.QUEUED,this.options.autoProcessQueue)return setTimeout(function(e){return function(){return e.processQueue()}}(this),0)},i.prototype._thumbnailQueue=[],i.prototype._processingThumbnail=!1,i.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)},i.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this))},i.prototype.removeFile=function(e){if(e.status===i.UPLOADING&&this.cancelUpload(e),this.files=o(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},i.prototype.removeAllFiles=function(e){var t,n,a,r;for(null==e&&(e=!1),r=this.files.slice(),n=0,a=r.length;n<a;n++)t=r[n],(t.status!==i.UPLOADING||e)&&this.removeFile(t);return null},i.prototype.createThumbnail=function(e,t){var i;return i=new FileReader,i.onload=function(n){return function(){return"image/svg+xml"===e.type?(n.emit("thumbnail",e,i.result),void(null!=t&&t())):n.createThumbnailFromUrl(e,i.result,t)}}(this),i.readAsDataURL(e)},i.prototype.createThumbnailFromUrl=function(e,t,i,n){var a;return a=document.createElement("img"),n&&(a.crossOrigin=n),a.onload=function(t){return function(){var n,s,o,l,d,c,u,p;if(e.width=a.width,e.height=a.height,o=t.options.resize.call(t,e),null==o.trgWidth&&(o.trgWidth=o.optWidth),null==o.trgHeight&&(o.trgHeight=o.optHeight),n=document.createElement("canvas"),s=n.getContext("2d"),n.width=o.trgWidth,n.height=o.trgHeight,r(s,a,null!=(d=o.srcX)?d:0,null!=(c=o.srcY)?c:0,o.srcWidth,o.srcHeight,null!=(u=o.trgX)?u:0,null!=(p=o.trgY)?p:0,o.trgWidth,o.trgHeight),l=n.toDataURL("image/png"),t.emit("thumbnail",e,l),null!=i)return i()}}(this),null!=i&&(a.onerror=i),a.src=t},i.prototype.processQueue=function(){var e,t,i,n;if(t=this.options.parallelUploads,i=this.getUploadingFiles().length,e=i,!(i>=t)&&(n=this.getQueuedFiles(),n.length>0)){if(this.options.uploadMultiple)return this.processFiles(n.slice(0,t-i));for(;e<t;){if(!n.length)return;this.processFile(n.shift()),e++}}},i.prototype.processFile=function(e){return this.processFiles([e])},i.prototype.processFiles=function(e){var t,n,a;for(n=0,a=e.length;n<a;n++)t=e[n],t.processing=!0,t.status=i.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},i.prototype._getFilesWithXhr=function(e){var t,i;return i=function(){var i,n,a,r;for(a=this.files,r=[],i=0,n=a.length;i<n;i++)t=a[i],t.xhr===e&&r.push(t);return r}.call(this)},i.prototype.cancelUpload=function(e){var t,n,a,r,s,o,l;if(e.status===i.UPLOADING){for(n=this._getFilesWithXhr(e.xhr),a=0,s=n.length;a<s;a++)t=n[a],t.status=i.CANCELED;for(e.xhr.abort(),r=0,o=n.length;r<o;r++)t=n[r],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",n)}else(l=e.status)!==i.ADDED&&l!==i.QUEUED||(e.status=i.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},a=function(){var e,t;return t=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},i.prototype.uploadFile=function(e){return this.uploadFiles([e])},i.prototype.uploadFiles=function(e){var t,r,s,o,l,d,c,u,p,h,m,f,g,v,w,y,b,C,k,_,T,I,F,x,E,S,D,j,$,P,A,z,O,Q;for(k=new XMLHttpRequest,_=0,x=e.length;_<x;_++)t=e[_],t.xhr=k;f=a(this.options.method,e),b=a(this.options.url,e),k.open(f,b,!0),k.withCredentials=!!this.options.withCredentials,w=null,s=function(i){return function(){var n,a,r;for(r=[],n=0,a=e.length;n<a;n++)t=e[n],r.push(i._errorProcessing(e,w||i.options.dictResponseError.replace("{{statusCode}}",k.status),k));return r}}(this),y=function(i){return function(n){var a,r,s,o,l,d,c,u,p;if(null!=n)for(r=100*n.loaded/n.total,s=0,d=e.length;s<d;s++)t=e[s],t.upload={progress:r,total:n.total,bytesSent:n.loaded};else{for(a=!0,r=100,o=0,c=e.length;o<c;o++)t=e[o],100===t.upload.progress&&t.upload.bytesSent===t.upload.total||(a=!1),t.upload.progress=r,t.upload.bytesSent=t.upload.total;if(a)return}for(p=[],l=0,u=e.length;l<u;l++)t=e[l],p.push(i.emit("uploadprogress",t,r,t.upload.bytesSent));return p}}(this),k.onload=function(t){return function(n){var a;if(e[0].status!==i.CANCELED&&4===k.readyState){if(w=k.responseText,k.getResponseHeader("content-type")&&~k.getResponseHeader("content-type").indexOf("application/json"))try{w=JSON.parse(w)}catch(e){n=e,w="Invalid JSON response from server."}return y(),200<=(a=k.status)&&a<300?t._finished(e,w,n):s()}}}(this),k.onerror=function(t){return function(){if(e[0].status!==i.CANCELED)return s()}}(this),v=null!=($=k.upload)?$:k,v.onprogress=y,d={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&n(d,this.options.headers);for(o in d)l=d[o],l&&k.setRequestHeader(o,l);if(r=new FormData,this.options.params){P=this.options.params;for(m in P)C=P[m],r.append(m,C)}for(T=0,E=e.length;T<E;T++)t=e[T],this.emit("sending",t,k,r);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,k,r),"FORM"===this.element.tagName)for(A=this.element.querySelectorAll("input, textarea, select, button"),I=0,S=A.length;I<S;I++)if(u=A[I],p=u.getAttribute("name"),h=u.getAttribute("type"),"SELECT"===u.tagName&&u.hasAttribute("multiple"))for(z=u.options,F=0,D=z.length;F<D;F++)g=z[F],g.selected&&r.append(p,g.value);else(!h||"checkbox"!==(O=h.toLowerCase())&&"radio"!==O||u.checked)&&r.append(p,u.value);for(c=j=0,Q=e.length-1;0<=Q?j<=Q:j>=Q;c=0<=Q?++j:--j)r.append(this._getParamName(c),e[c],this._renameFilename(e[c].name));return this.submitRequest(k,r,e)},i.prototype.submitRequest=function(e,t,i){return e.send(t)},i.prototype._finished=function(e,t,n){var a,r,s;for(r=0,s=e.length;r<s;r++)a=e[r],a.status=i.SUCCESS,this.emit("success",a,t,n),this.emit("complete",a);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},i.prototype._errorProcessing=function(e,t,n){var a,r,s;for(r=0,s=e.length;r<s;r++)a=e[r],a.status=i.ERROR,this.emit("error",a,t,n),this.emit("complete",a);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},i}(t),e.version="4.3.0",e.options={},e.optionsForElement=function(t){return t.getAttribute("id")?e.options[i(t.getAttribute("id"))]:void 0},e.instances=[],e.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},e.autoDiscover=!0,e.discover=function(){var t,i,n,a,r,s;for(document.querySelectorAll?n=document.querySelectorAll(".dropzone"):(n=[],t=function(e){var t,i,a,r;for(r=[],i=0,a=e.length;i<a;i++)t=e[i],/(^| )dropzone($| )/.test(t.className)?r.push(n.push(t)):r.push(void 0);return r},t(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))),s=[],a=0,r=n.length;a<r;a++)i=n[a],e.optionsForElement(i)!==!1?s.push(new e(i)):s.push(void 0);return s},e.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],e.isBrowserSupported=function(){var t,i,n,a,r;if(t=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(r=e.blacklistedBrowsers,n=0,a=r.length;n<a;n++)i=r[n],i.test(navigator.userAgent)&&(t=!1);else t=!1;else t=!1;return t},o=function(e,t){var i,n,a,r;for(r=[],n=0,a=e.length;n<a;n++)i=e[n],i!==t&&r.push(i);return r},i=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},e.createElement=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},e.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},e.getElement=function(e,t){var i;if("string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return i},e.getElements=function(e,t){var i,n,a,r,s,o,l,d;if(e instanceof Array){a=[];try{for(r=0,o=e.length;r<o;r++)n=e[r],a.push(this.getElement(n,t))}catch(e){i=e,a=null}}else if("string"==typeof e)for(a=[],d=document.querySelectorAll(e),s=0,l=d.length;s<l;s++)n=d[s],a.push(n);else null!=e.nodeType&&(a=[e]);if(null==a||!a.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return a},e.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},e.isValidFile=function(e,t){var i,n,a,r,s;if(!t)return!0;for(t=t.split(","),n=e.type,i=n.replace(/\/.*$/,""),r=0,s=t.length;r<s;r++)if(a=t[r],a=a.trim(),"."===a.charAt(0)){if(e.name.toLowerCase().indexOf(a.toLowerCase(),e.name.length-a.length)!==-1)return!0}else if(/\/\*$/.test(a)){if(i===a.replace(/\/.*$/,""))return!0}else if(n===a)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new e(this,t)})}),"undefined"!=typeof module&&null!==module?module.exports=e:window.Dropzone=e,e.ADDED="added",e.QUEUED="queued",e.ACCEPTED=e.QUEUED,e.UPLOADING="uploading",e.PROCESSING=e.UPLOADING,e.CANCELED="canceled",e.ERROR="error",e.SUCCESS="success",a=function(e){var t,i,n,a,r,s,o,l,d,c;for(o=e.naturalWidth,s=e.naturalHeight,i=document.createElement("canvas"),i.width=1,i.height=s,n=i.getContext("2d"),n.drawImage(e,0,0),a=n.getImageData(0,0,1,s).data,c=0,r=s,l=s;l>c;)t=a[4*(l-1)+3],0===t?r=l:c=l,l=r+c>>1;return d=l/s,0===d?1:d},r=function(e,t,i,n,r,s,o,l,d,c){var u;return u=a(t),e.drawImage(t,i,n,r,s,o,l,d,c/u)},n=function(e,t){var i,n,a,r,s,o,l,d,c;if(a=!1,c=!0,n=e.document,d=n.documentElement,i=n.addEventListener?"addEventListener":"attachEvent",l=n.addEventListener?"removeEventListener":"detachEvent",o=n.addEventListener?"":"on",r=function(i){if("readystatechange"!==i.type||"complete"===n.readyState)return("load"===i.type?e:n)[l](o+i.type,r,!1),!a&&(a=!0)?t.call(e,i.type||i):void 0},s=function(){var e;try{d.doScroll("left")}catch(t){return e=t,void setTimeout(s,50)}return r("poll")},"complete"!==n.readyState){if(n.createEventObject&&d.doScroll){try{c=!e.frameElement}catch(e){}c&&s()}return n[i](o+"DOMContentLoaded",r,!1),n[i](o+"readystatechange",r,!1),e[i](o+"load",r,!1)}},e._autoDiscoverFunction=function(){if(e.autoDiscover)return e.discover()},n(window,e._autoDiscoverFunction)}.call(this),function(e){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(e){var t=e[0];return t.offsetWidth>0&&t.offsetHeight>0}function i(t){if(t.minTime&&(t.minTime=y(t.minTime)),t.maxTime&&(t.maxTime=y(t.maxTime)),t.durationTime&&"function"!=typeof t.durationTime&&(t.durationTime=y(t.durationTime)),"now"==t.scrollDefault)t.scrollDefault=function(){return t.roundingFunction(y(new Date),t)};else if(t.scrollDefault&&"function"!=typeof t.scrollDefault){var i=t.scrollDefault;t.scrollDefault=function(){return t.roundingFunction(y(i),t)}}else t.minTime&&(t.scrollDefault=function(){return t.roundingFunction(t.minTime,t)});if("string"===e.type(t.timeFormat)&&t.timeFormat.match(/[gh]/)&&(t._twelveHourTime=!0),t.showOnFocus===!1&&t.showOn.indexOf("focus")!=-1&&t.showOn.splice(t.showOn.indexOf("focus"),1),t.disableTimeRanges.length>0){for(var n in t.disableTimeRanges)t.disableTimeRanges[n]=[y(t.disableTimeRanges[n][0]),y(t.disableTimeRanges[n][1])];t.disableTimeRanges=t.disableTimeRanges.sort(function(e,t){return e[0]-t[0]});for(var n=t.disableTimeRanges.length-1;n>0;n--)t.disableTimeRanges[n][0]<=t.disableTimeRanges[n-1][1]&&(t.disableTimeRanges[n-1]=[Math.min(t.disableTimeRanges[n][0],t.disableTimeRanges[n-1][0]),Math.max(t.disableTimeRanges[n][1],t.disableTimeRanges[n-1][1])],t.disableTimeRanges.splice(n,1))}return t}function n(t){var i=t.data("timepicker-settings"),n=t.data("timepicker-list");if(n&&n.length&&(n.remove(),t.data("timepicker-list",!1)),i.useSelect){n=e("<select />",{class:"ui-timepicker-select"});var s=n}else{n=e("<ul />",{class:"ui-timepicker-list"});var s=e("<div />",{class:"ui-timepicker-wrapper",tabindex:-1});s.css({display:"none",position:"absolute"}).append(n)}if(i.noneOption)if(i.noneOption===!0&&(i.noneOption=i.useSelect?"Time...":"None"),e.isArray(i.noneOption)){for(var l in i.noneOption)if(parseInt(l,10)==l){var c=a(i.noneOption[l],i.useSelect);n.append(c)}}else{var c=a(i.noneOption,i.useSelect);n.append(c)}if(i.className&&s.addClass(i.className),(null!==i.minTime||null!==i.durationTime)&&i.showDuration){"function"==typeof i.step?"function":i.step;s.addClass("ui-timepicker-with-duration"),s.addClass("ui-timepicker-step-"+i.step)}var u=i.minTime;"function"==typeof i.durationTime?u=y(i.durationTime()):null!==i.durationTime&&(u=i.durationTime);var h=null!==i.minTime?i.minTime:0,m=null!==i.maxTime?i.maxTime:h+b-1;m<h&&(m+=b),m===b-1&&"string"===e.type(i.timeFormat)&&i.show2400&&(m=b);var f=i.disableTimeRanges,C=0,_=f.length,T=i.step;"function"!=typeof T&&(T=function(){return i.step});for(var l=h,I=0;l<=m;I++,l+=60*T(I)){var F=l,x=w(F,i);if(i.useSelect){var E=e("<option />",{value:x});E.text(x)}else{var E=e("<li />");E.addClass(F%86400<43200?"ui-timepicker-am":"ui-timepicker-pm"),E.data("time",F<=86400?F:F%86400),E.text(x)}if((null!==i.minTime||null!==i.durationTime)&&i.showDuration){var S=v(l-u,i.step);if(i.useSelect)E.text(E.text()+" ("+S+")");else{var D=e("<span />",{class:"ui-timepicker-duration"});D.text(" ("+S+")"),E.append(D)}}C<_&&(F>=f[C][1]&&(C+=1),f[C]&&F>=f[C][0]&&F<f[C][1]&&(i.useSelect?E.prop("disabled",!0):E.addClass("ui-timepicker-disabled"))),n.append(E)}if(s.data("timepicker-input",t),t.data("timepicker-list",s),i.useSelect)t.val()&&n.val(r(y(t.val()),i)),n.on("focus",function(){e(this).data("timepicker-input").trigger("showTimepicker");
}),n.on("blur",function(){e(this).data("timepicker-input").trigger("hideTimepicker")}),n.on("change",function(){p(t,e(this).val(),"select")}),p(t,n.val(),"initial"),t.hide().after(n);else{var j=i.appendTo;"string"==typeof j?j=e(j):"function"==typeof j&&(j=j(t)),j.append(s),d(t,n),n.on("mousedown touchstart","li",function(i){t.off("focus.timepicker"),t.on("focus.timepicker-ie-hack",function(){t.off("focus.timepicker-ie-hack"),t.on("focus.timepicker",k.show)}),o(t)||t[0].focus(),n.find("li").removeClass("ui-timepicker-selected"),e(this).addClass("ui-timepicker-selected"),g(t)&&(t.trigger("hideTimepicker"),n.on("mouseup.timepicker touchend.timepicker","li",function(e){n.off("mouseup.timepicker touchend.timepicker"),s.hide()}))})}}function a(t,i){var n,a,r;return"object"==typeof t?(n=t.label,a=t.className,r=t.value):"string"==typeof t?n=t:e.error("Invalid noneOption value"),i?e("<option />",{value:r,class:a,text:n}):e("<li />",{class:a,text:n}).data("time",String(r))}function r(e,t){if(e=t.roundingFunction(e,t),null!==e)return w(e,t)}function s(t){var i=e(t.target),n=i.closest(".ui-timepicker-input");0===n.length&&0===i.closest(".ui-timepicker-wrapper").length&&(k.hide(),e(document).unbind(".ui-timepicker"),e(window).unbind(".ui-timepicker"))}function o(e){var t=e.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&t.disableTouchKeyboard}function l(t,i,n){if(!n&&0!==n)return!1;var a=t.data("timepicker-settings"),r=!1,n=a.roundingFunction(n,a);return i.find("li").each(function(t,i){var a=e(i);if("number"==typeof a.data("time"))return a.data("time")==n?(r=a,!1):void 0}),r}function d(e,t){t.find("li").removeClass("ui-timepicker-selected");var i=y(u(e),e.data("timepicker-settings"));if(null!==i){var n=l(e,t,i);if(n){var a=n.offset().top-t.offset().top;(a+n.outerHeight()>t.outerHeight()||a<0)&&t.scrollTop(t.scrollTop()+n.position().top-n.outerHeight()),n.addClass("ui-timepicker-selected")}}}function c(t,i){if(""!==this.value&&"timepicker"!=i){var n=e(this);if(!n.is(":focus")||t&&"change"==t.type){var a=n.data("timepicker-settings"),r=y(this.value,a);if(null===r)return void n.trigger("timeFormatError");var s=!1;null!==a.minTime&&r<a.minTime&&null!==a.maxTime&&r>a.maxTime&&(s=!0),e.each(a.disableTimeRanges,function(){if(r>=this[0]&&r<this[1])return s=!0,!1}),a.forceRoundTime&&(r=a.roundingFunction(r,a));var o=w(r,a);s?p(n,o,"error")&&n.trigger("timeRangeError"):p(n,o)}}}function u(e){return e.is("input")?e.val():e.data("ui-timepicker-value")}function p(e,t,i){if(e.is("input")){e.val(t);var n=e.data("timepicker-settings");n.useSelect&&"select"!=i&&"initial"!=i&&e.data("timepicker-list").val(r(y(t),n))}return e.data("ui-timepicker-value")!=t?(e.data("ui-timepicker-value",t),"select"==i?e.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):"error"!=i&&e.trigger("changeTime"),!0):(e.trigger("selectTime"),!1)}function h(e){switch(e.keyCode){case 13:case 9:return;default:e.preventDefault()}}function m(i){var n=e(this),a=n.data("timepicker-list");if(!a||!t(a)){if(40!=i.keyCode)return!0;k.show.call(n.get(0)),a=n.data("timepicker-list"),o(n)||n.focus()}switch(i.keyCode){case 13:return g(n)&&k.hide.apply(this),i.preventDefault(),!1;case 38:var r=a.find(".ui-timepicker-selected");return r.length?r.is(":first-child")||(r.removeClass("ui-timepicker-selected"),r.prev().addClass("ui-timepicker-selected"),r.prev().position().top<r.outerHeight()&&a.scrollTop(a.scrollTop()-r.outerHeight())):(a.find("li").each(function(t,i){if(e(i).position().top>0)return r=e(i),!1}),r.addClass("ui-timepicker-selected")),!1;case 40:return r=a.find(".ui-timepicker-selected"),0===r.length?(a.find("li").each(function(t,i){if(e(i).position().top>0)return r=e(i),!1}),r.addClass("ui-timepicker-selected")):r.is(":last-child")||(r.removeClass("ui-timepicker-selected"),r.next().addClass("ui-timepicker-selected"),r.next().position().top+2*r.outerHeight()>a.outerHeight()&&a.scrollTop(a.scrollTop()+r.outerHeight())),!1;case 27:a.find("li").removeClass("ui-timepicker-selected"),k.hide();break;case 9:k.hide();break;default:return!0}}function f(i){var n=e(this),a=n.data("timepicker-list"),r=n.data("timepicker-settings");if(!a||!t(a)||r.disableTextInput)return!0;switch(i.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:r.typeaheadHighlight?d(n,a):a.hide()}}function g(e){var t=e.data("timepicker-settings"),i=e.data("timepicker-list"),n=null,a=i.find(".ui-timepicker-selected");return!a.hasClass("ui-timepicker-disabled")&&(a.length&&(n=a.data("time")),null!==n&&("string"!=typeof n&&(n=w(n,t)),p(e,n,"select")),!0)}function v(e,t){e=Math.abs(e);var i,n,a=Math.round(e/60),r=[];return a<60?r=[a,C.mins]:(i=Math.floor(a/60),n=a%60,30==t&&30==n&&(i+=C.decimal+5),r.push(i),r.push(1==i?C.hr:C.hrs),30!=t&&n&&(r.push(n),r.push(C.mins))),r.join(" ")}function w(t,i){if("number"!=typeof t)return null;var n=parseInt(t%60),a=parseInt(t/60%60),r=parseInt(t/3600%24),s=new Date(1970,0,2,r,a,n,0);if(isNaN(s.getTime()))return null;if("function"===e.type(i.timeFormat))return i.timeFormat(s);for(var o,l,d="",c=0;c<i.timeFormat.length;c++)switch(l=i.timeFormat.charAt(c)){case"a":d+=s.getHours()>11?C.pm:C.am;break;case"A":d+=s.getHours()>11?C.PM:C.AM;break;case"g":o=s.getHours()%12,d+=0===o?"12":o;break;case"G":o=s.getHours(),t===b&&(o=i.show2400?24:0),d+=o;break;case"h":o=s.getHours()%12,0!==o&&o<10&&(o="0"+o),d+=0===o?"12":o;break;case"H":o=s.getHours(),t===b&&(o=i.show2400?24:0),d+=o>9?o:"0"+o;break;case"i":var a=s.getMinutes();d+=a>9?a:"0"+a;break;case"s":n=s.getSeconds(),d+=n>9?n:"0"+n;break;case"\\":c++,d+=i.timeFormat.charAt(c);break;default:d+=l}return d}function y(e,t){if(""===e||null===e)return null;if("object"==typeof e)return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds();if("string"!=typeof e)return e;e=e.toLowerCase().replace(/[\s\.]/g,""),"a"!=e.slice(-1)&&"p"!=e.slice(-1)||(e+="m");var i="("+C.am.replace(".","")+"|"+C.pm.replace(".","")+"|"+C.AM.replace(".","")+"|"+C.PM.replace(".","")+")?",n=new RegExp("^"+i+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+i+"$"),a=e.match(n);if(!a)return null;var r=parseInt(1*a[2],10),s=r>24?r%24:r,o=a[1]||a[5],l=s;if(s<=12&&o){var d=o==C.pm||o==C.PM;l=12==s?d?12:0:s+(d?12:0)}var c=1*a[3]||0,u=1*a[4]||0,p=3600*l+60*c+u;if(s<12&&!o&&t&&t._twelveHourTime&&t.scrollDefault){var h=p-t.scrollDefault();h<0&&h>=b/-2&&(p=(p+b/2)%b)}return p}var b=86400,C={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},k={init:function(t){return this.each(function(){var a=e(this),r=[];for(var s in e.fn.timepicker.defaults)a.data(s)&&(r[s]=a.data(s));var o=e.extend({},e.fn.timepicker.defaults,r,t);if(o.lang&&(C=e.extend(C,o.lang)),o=i(o),a.data("timepicker-settings",o),a.addClass("ui-timepicker-input"),o.useSelect)n(a);else{if(a.prop("autocomplete","off"),o.showOn)for(var l in o.showOn)a.on(o.showOn[l]+".timepicker",k.show);a.on("change.timepicker",c),a.on("keydown.timepicker",m),a.on("keyup.timepicker",f),o.disableTextInput&&a.on("keydown.timepicker",h),c.call(a.get(0))}})},show:function(i){var a=e(this),r=a.data("timepicker-settings");if(i&&i.preventDefault(),r.useSelect)return void a.data("timepicker-list").focus();o(a)&&a.blur();var c=a.data("timepicker-list");if(!a.prop("readonly")&&(c&&0!==c.length&&"function"!=typeof r.durationTime||(n(a),c=a.data("timepicker-list")),!t(c))){a.data("ui-timepicker-value",a.val()),d(a,c),k.hide(),c.show();var p={};r.orientation.match(/r/)?p.left=a.offset().left+a.outerWidth()-c.outerWidth()+parseInt(c.css("marginLeft").replace("px",""),10):p.left=a.offset().left+parseInt(c.css("marginLeft").replace("px",""),10);var h;h=r.orientation.match(/t/)?"t":r.orientation.match(/b/)?"b":a.offset().top+a.outerHeight(!0)+c.outerHeight()>e(window).height()+e(window).scrollTop()?"t":"b","t"==h?(c.addClass("ui-timepicker-positioned-top"),p.top=a.offset().top-c.outerHeight()+parseInt(c.css("marginTop").replace("px",""),10)):(c.removeClass("ui-timepicker-positioned-top"),p.top=a.offset().top+a.outerHeight()+parseInt(c.css("marginTop").replace("px",""),10)),c.offset(p);var m=c.find(".ui-timepicker-selected");if(!m.length){var f=y(u(a));null!==f?m=l(a,c,f):r.scrollDefault&&(m=l(a,c,r.scrollDefault()))}if(m&&m.length){var g=c.scrollTop()+m.position().top-m.outerHeight();c.scrollTop(g)}else c.scrollTop(0);return r.stopScrollPropagation&&e(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(t){t.preventDefault();var i=e(this).scrollTop();e(this).scrollTop(i+t.originalEvent.deltaY)}),e(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",s),e(window).on("resize.ui-timepicker",s),r.closeOnWindowScroll&&e(document).on("scroll.ui-timepicker",s),a.trigger("showTimepicker"),this}},hide:function(i){var n=e(this),a=n.data("timepicker-settings");return a&&a.useSelect&&n.blur(),e(".ui-timepicker-wrapper").each(function(){var i=e(this);if(t(i)){var n=i.data("timepicker-input"),a=n.data("timepicker-settings");a&&a.selectOnBlur&&g(n),i.hide(),n.trigger("hideTimepicker")}}),this},option:function(t,a){return"string"==typeof t&&"undefined"==typeof a?e(this).data("timepicker-settings")[t]:this.each(function(){var r=e(this),s=r.data("timepicker-settings"),o=r.data("timepicker-list");"object"==typeof t?s=e.extend(s,t):"string"==typeof t&&(s[t]=a),s=i(s),r.data("timepicker-settings",s),o&&(o.remove(),r.data("timepicker-list",!1)),s.useSelect&&n(r)})},getSecondsFromMidnight:function(){return y(u(this))},getTime:function(e){var t=this,i=u(t);if(!i)return null;var n=y(i);if(null===n)return null;e||(e=new Date);var a=new Date(e);return a.setHours(n/3600),a.setMinutes(n%3600/60),a.setSeconds(n%60),a.setMilliseconds(0),a},isVisible:function(){var e=this,i=e.data("timepicker-list");return!(!i||!t(i))},setTime:function(e){var t=this,i=t.data("timepicker-settings");if(i.forceRoundTime)var n=r(y(e),i);else var n=w(y(e),i);return e&&null===n&&i.noneOption&&(n=e),p(t,n),t.data("timepicker-list")&&d(t,t.data("timepicker-list")),this},remove:function(){var e=this;if(e.hasClass("ui-timepicker-input")){var t=e.data("timepicker-settings");return e.removeAttr("autocomplete","off"),e.removeClass("ui-timepicker-input"),e.removeData("timepicker-settings"),e.off(".timepicker"),e.data("timepicker-list")&&e.data("timepicker-list").remove(),t.useSelect&&e.show(),e.removeData("timepicker-list"),this}}};e.fn.timepicker=function(t){return this.length?k[t]?this.hasClass("ui-timepicker-input")?k[t].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.timepicker"):k.init.apply(this,arguments):this},e.fn.timepicker.defaults={appendTo:"body",className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(e,t){if(null===e)return null;if("number"!=typeof t.step)return e;var i=e%(60*t.step);return i>=30*t.step?e+=60*t.step-i:e-=i,e==b&&t.show2400?e:e%b},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1}}),$(document).ready(function(){var e=document.location.toString();e.match("#")&&($('.nav-tabs a[href="#'+e.split("#")[1]+'"]').tab("show"),window.scrollTo(0,0)),$(".nav-tabs a").on("shown.bs.tab",function(e){history.pushState?history.pushState(null,null,e.target.hash):window.location.hash=e.target.hash}),$(".ajaxfrm, .modalajaxfrm").submit(function(e){e.preventDefault();var t=$(this),i=t.serialize(),n=t.data("action"),a=t.data("requestvars");t.find(".btn").attr("disabled","disabled"),WHMCS.http.jqClient.post("addonmodules.php?module=project_management",i+"&"+a+"&ajax=1&action="+n,function(e){0==e.status?t.find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():(window.ProjectManagerHandlers[n](e),t.hasClass("modalajaxfrm")&&t.find(".modal").modal("hide")),t.find(".btn").removeAttr("disabled")},"json")}),$(".ajaxclick").click(function(e){e.preventDefault();var t=this,i=($(t).serialize(),$(t).data("action")),n=$(t).data("requestvars");WHMCS.http.jqClient.post("addonmodules.php?module=project_management",n+"&ajax=1&action="+i,function(e){0==e.status?jQuery.growl.error({title:lang.error,message:e.error}):window.ProjectManagerHandlers[i](e)},"json")});var t=jQuery(".selectize-select-pm"),i=0;t.length>0&&jQuery(t).selectize({valueField:jQuery(t).attr("data-value-field"),labelField:"name",searchField:jQuery(t).attr("data-search-field").split("|"),allowEmptyOption:!0,create:!1,maxItems:1,render:{item:function(e,t){return'<div><span class="name">'+("number"==typeof e.id||"p"!=e.id.substring(0,1)?lang.taskTemplate+": ":"")+t(e.name)+"</span></div>"},option:function(e,t){return'<div><span class="name">'+t(e.name)+"</span>"+("number"!=typeof e.id&&"p"==e.id.substring(0,1)?'<span class="project">'+t(lang.projectNum)+t(e.id.substring(1))+"</span>":"")+"</div>"}},load:function(e,t){return e.length?void jQuery.ajax({url:window.location.pathname+window.location.search,type:"POST",dataType:"json",data:{ajax:1,token:jQuery("#csrfToken").val(),project:jQuery("#projectId").val(),action:"taskSearch",search:e},error:function(){t()},success:function(e){t(e.options)}}):t()},onFocus:function(){i=this.getValue(),this.clear()},onBlur:function(){""==this.getValue()&&this.setValue(i)},onChange:function(e){e.length&&ProjectManager.call(jQuery(t).attr("data-pm-action"),"selected="+e)}})});var ProjectManager={call:function(e,t){var i="";WHMCS.http.jqClient.post("addonmodules.php?module=project_management",t+"&projectid="+$("#projectId").val()+"&ajax=1&action="+e+"&token="+$("#csrfToken").val(),function(t){0==t.status?i=t.error:window.ProjectManagerHandlers[e](t)},"json")},confirm:function(e,t){jQuery("#modalConfirmMsg").html(lang[e]),$("#frmModalConfirm").data("action",e).data("requestvars",t),$("#modalConfirm").modal("show").find(".btn-success").focus()}};$(document).ready(function(){$("#predefinedFilters a").click(function(e){e.preventDefault(),$("#predefinedFilters a").removeClass("active"),$(this).addClass("active"),$("#inputPredefinedFilter").val($(this).data("filter"))})}),$(document).ready(function(){function e(e,t,i){i=i||lang.saving;var n=/[^\s]+/g,a=[],r=0,s=0;if(e&&(a=e.match(n),s=e.split(/\\r\\n|\\r|\\n/).length),a)for(var o=0;o<a.length;o++)r+=a[o].charCodeAt(0)>=19968?a[o].length:1;return'<div class="small-font">'+lang.lines+": "+s+"&nbsp;&nbsp;&nbsp;"+lang.words+": "+r+(t?'&nbsp;&nbsp;&nbsp;<span class="markdown-save">'+i+"</span>":"")+"</div>"}function t(){a>=0&&(0==a&&jQuery("span.markdown-save").html("saved"),a--,setTimeout(t,1e3))}function i(e,t){var i=jQuery("#addMessage"),n=i.serialize(),a=i.data("action");"undefined"!=typeof t&&t.response.newFiles.length&&jQuery.each(t.response.newFiles,function(e,t){n+="&fileId[]="+t}),WHMCS.http.jqClient.post("addonmodules.php?module=project_management",n+"&&ajax=1&action="+a,function(e){0===e.status?i.find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():window.ProjectManagerHandlers[a](e),i.find(".btn").removeAttr("disabled")},"json")}$("#inputWatch").bootstrapSwitch({size:"small",onColor:"success",labelText:lang.watching}).on("switchChange.bootstrapSwitch",function(e,t){t?ProjectManager.call("watch",""):ProjectManager.call("unwatch","")}),$(document).on("click",".task-status-indicator",function(){var e=$(this).parent("td").parent("tr").attr("id");ProjectManager.call("taskstatustoggle","taskid="+e.substr(5))}),$(document).on("click",".task-edit",function(){var e=$(this).parent("div").parent("td").parent("tr").attr("id");ProjectManager.call("gettaskinfo","taskid="+e.substr(5)),$("#modalTaskEdit").modal("show")}),$(document).on("click",".task-delete",function(){var e=$(this).parent("div").parent("td").parent("tr").attr("id");ProjectManager.confirm("deletetask","taskid="+e.substr(5))}),$(document).on("click",".task-delete-button",function(){var e=$("#inputTaskId").val();$("#modalTaskEdit").modal("hide"),ProjectManager.confirm("deletetask","taskid="+e)}),$(document).on("click",".timer-edit",function(){var e=$(this).parent("td").parent("tr").attr("id");ProjectManager.call("gettimerinfo","timerid="+e.substr(6)),$("#modalEditTimer").modal("show")}),$(document).on("click",".timer-delete",function(){var e=$(this).data("timer-id");ProjectManager.confirm("deleteTimer","timerId="+e)}),$(document).on("click",".ticket-result",function(e){e.preventDefault();var t=$(this).attr("data-ticket-tid");ProjectManager.call("addticket","ticketmask="+t)}),$(document).on("click",".invoice-result",function(e){e.preventDefault();var t=$(this).attr("data-invoice-id");ProjectManager.call("addInvoice","invoice="+t)}),$(document).on("click",".unlink-ticket",function(){ProjectManager.call("unlinkTicket","ticketmask="+$(this).data("ticket-tid"))}),$(document).on("click",".view-ticket",function(){var e=window.open();e.opener=null,e.location="supporttickets.php?action=view&id="+$(this).data("ticket-id")}),$(document).on("click",".unlink-invoice",function(){ProjectManager.call("unlinkInvoice","invoice="+$(this).data("invoice-id"))}),$(document).on("click",".view-invoice",function(){var e=window.open();e.opener=null,e.location="invoices.php?action=edit&id="+$(this).data("invoice-id")}),$("#btnStartTimer").click(function(){$(this).prop("disabled",!0),$(this).find("i").toggleClass("fa-clock fa-spinner fa-spin"),ProjectManager.call("starttimer","")}),$("#btnEndTimer").click(function(){$(this).prop("disabled",!0),$(this).find("i").toggleClass("fa-clock fa-spinner fa-spin"),ProjectManager.call("endtimer","timerid="+$(this).data("timerid"))}),"undefined"!=typeof Sortable&&$("#adminList").length&&Sortable.create(adminList,{group:{name:"adminSort",pull:"clone",put:!1},sort:!1,ghostClass:"ghost"}),jQuery('span[id^="assigned-admin-task-"]').each(function(e,t){Sortable.create(t,{group:{name:"admin"+e,pull:!1,put:["adminSort"]},sort:!1,ghostClass:"ghost",onAdd:function(e){jQuery(e.target).html(e.item),ProjectManager.call("assigntask","taskid="+jQuery(e.target).data("id")+"&admin="+jQuery(e.item).data("id"))}})}),jQuery("#formSaveProject, #inputDueDateDiv, #dueDatePicker").find(".date").datepicker({dateFormat:datepickerformat,showOn:"both",buttonImage:"images/showcalendar.gif",buttonImageOnly:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0}),"undefined"!=typeof Sortable&&$("#dueDatePicker").length&&Sortable.create(dueDatePicker,{group:{name:"dueDateSelect",pull:"clone",put:!1,revertClone:!0},sort:!1,ghostClass:"ghost",handle:".handle"}),jQuery('span[id^="task-due-date-"]').each(function(e,t){Sortable.create(t,{group:{name:"due-date-"+e,pull:!1,put:["dueDateSelect"]},sort:!1,ghostClass:"ghost",onAdd:function(e){jQuery(e.target).html('<span class="label label-assigned-user">'+lang.updating+"...</span>"),ProjectManager.call("taskduedate","taskid="+jQuery(e.target).data("id")+"&duedate="+jQuery(e.item).find("input").val()),jQuery("#dueDatePicker").find(".ui-datepicker-trigger").remove().end().find(".date").removeClass("hasDatepicker").datepicker({dateFormat:datepickerformat,showOn:"both",buttonImage:"images/showcalendar.gif",buttonImageOnly:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0})}})}),jQuery(".icheck-button").each(function(){var e=jQuery(this);e.iCheck({checkboxClass:"icheckbox_flat-blue",radioClass:"iradio_flat-blue"})});var n=jQuery("#toggleCompleteHide");n.on("ifChecked",function(e){jQuery(".task-line-item-completed").each(function(){jQuery(this).children().toggle("highlight")})}),n.on("ifUnchecked",function(e){jQuery(".task-line-item-completed").each(function(){jQuery(this).children().toggle("highlight")})}),Dropzone.options.myProjectUploads={maxFilesize:maximumFileSize,addRemoveLinks:!0,init:function(){this.on("sending",function(e,t,i){i.append("filesize",e.size)}),this.on("success",function(e,t){if(t=jQuery.parseJSON(t),"1"!=t.status)jQuery.growl.error({title:lang.error,message:t.error});else{jQuery("#fileCount").html(t.fileCount);var i;t.isImage&&(i="lightbox"),t.browserViewable&&(i=""),appendFile(t.key,t),this.removeFile(e),jQuery.growl.notice({title:lang.success,message:lang.fileUploadSuccess})}}),this.on("error",function(e,t,i){jQuery.growl.error({title:lang.error,message:t})})}};var a=0;jQuery("#newTicketMessage").length>0&&(newProjectTicket=jQuery("#newTicketMessage").markdown({footer:'<div id="newTicketMessage-footer" class="markdown-editor-status"></div>',autofocus:!1,savable:!1,resize:"vertical",iconlibrary:"glyph",onShow:function(t){var i="",n=!1;"undefined"!=typeof Storage&&(i=localStorage.getItem("project-"+jQuery("#projectId").val()+"-new-ticket"),n=!0,i&&"undefined"!=typeof i&&t.setContent(i)),jQuery("#newTicketMessage-footer").html(e(i,n,lang.saved))},onChange:function(i){var n=i.getContent(),r=!1;"undefined"!=typeof Storage&&(a=3,r=!0,localStorage.setItem("project-"+jQuery("#projectId").val()+"-new-ticket",n),t()),jQuery("#newTicketMessage-footer").html(e(n,r))},onPreview:function(e){var t,i=e.getContent();return jQuery.ajax({url:window.location.pathname+window.location.search,async:!1,data:{token:jQuery("#csrfToken").val(),action:"parseMarkdown",content:i,ajax:1,projectId:jQuery("#projectId").val()},dataType:"json",success:function(e){t=e}}),t.body?t.body:""},additionalButtons:[[{name:"groupCustom",data:[{name:"cmdHelp",title:lang.help,hotkey:"Ctrl+F1",btnClass:"btn open-modal",href:"supporttickets.php?action=markdown",icon:{glyph:"fas fa-question-circle",fa:"fa fa-question-circle","fa-3":"icon-question-sign"},callback:function(e){e.$editor.removeClass("md-fullscreen-mode")},additionalAttr:[{name:"data-modal-title",value:lang.markdownGuide},{name:"data-modal-size",value:"modal-lg"}]}]}]]})),jQuery("#associatedTicketSearch").on("keydown",function(e){if(13==e.keyCode){if(e.preventDefault(),jQuery(this).val().length<3)return;jQuery("#associatedTicketResults").find(".ticket").hide().remove(),jQuery("#resultInfo").fadeIn("fast"),ProjectManager.call("searchTickets","search="+jQuery(this).val())}}),jQuery("#modalAssociateInvoice").on("show.bs.modal",function(){jQuery("#associatedInvoiceResults").find(".invoice").hide().remove(),jQuery("#invoiceResultInfo").fadeIn("fast"),ProjectManager.call("searchInvoices","search=0")}),jQuery("#associatedInvoiceSearch").on("keydown",function(e){if(13==e.keyCode){if(e.preventDefault(),jQuery(this).val().length<1)return;jQuery("#associatedInvoiceResults").find(".invoice").hide().remove(),jQuery("#invoiceResultInfo").fadeIn("fast"),ProjectManager.call("searchInvoices","search="+jQuery(this).val())}}),jQuery("#btnMainUploadFile").on("click",function(){jQuery("#myProjectUploads").click()}),jQuery("#addMessage").on("submit",function(e){e.preventDefault();var t=jQuery("#addMessageFiles"),n=jQuery("#inputAddMessage"),a=jQuery(this);return a.find(".btn").attr("disabled","disabled"),n.val()?void(t.val()?(t.off("filebatchuploaderror"),t.off("filebatchuploadsuccess"),t.on("filebatchuploaderror",function(e,t,i){t.form.find(".error-feedback").html(i).hide().removeClass("hidden").fadeIn(),t.form.find(".btn").removeAttr("disabled")}),t.on("filebatchuploadsuccess",i),t.fileinput("upload")):i()):(jQuery(this).find(".error-feedback").html(lang.messageRequired).hide().removeClass("hidden").fadeIn().end(),a.find(".btn").removeAttr("disabled"),!1)}),jQuery("#btnInvoiceSelected").on("click",function(){var e=jQuery("table.timers").find('input:checked[name="timerId[]"]');if(0===e.length)return jQuery.growl.error({title:lang.error,message:lang.selectTimers}),!1;jQuery(this).prop("disabled",!0).find("i").toggleClass("fa fa-spinner fa-spin");var t="";e.each(function(){t+="timerId[]="+jQuery(this).val()+"&"});var i=jQuery("#timersToInvoice"),n=jQuery("#modalInvoiceItems");i.html(""),WHMCS.http.jqClient.post("addonmodules.php?module=project_management",t+"ajax=1&action=prepareInvoiceTimers&projectid="+jQuery("#iIProjectId").val()+"&token="+jQuery("#csrfToken").val()+"&rate="+jQuery("#defaultRate").val(),function(e){0===e.status?n.find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():(n.find(".error-feedback").html("").hide(),jQuery.each(e.times,function(t,n){var a=jQuery("#timersToInvoiceSample").clone();a.find(".description").attr("name","description["+t+"]").val(n.description).end().find(".hours").attr("name","hours["+t+"]").attr("id","invoiceItemsHours"+t).val((n.seconds/3600).toFixed(2)).end().find(".displayHours").attr("name","displayHours["+t+"]").attr("data-key",t).attr("id","invoiceItemsDisplayHours"+t).val(n.hours).end().find(".itemRate").attr("name","rate["+t+"]").attr("data-key",t).attr("id","invoiceItemsRate"+t).val(n.rate).end().find(".invoiceAmount").attr("name","amount["+t+"]").attr("data-key",t).attr("id","invoiceItemsAmount"+t).val(n.amount).end().find("span.currency").html(e.currency.prefix).end().find("span.currency-suffix").html(e.currency.suffix).end(),i.append(a.children("div"))})),jQuery("#formInvoiceItems").data("requestvars",t),n.modal("show").find(".btn-success").focus()},"json")}),jQuery("#modalInvoiceItems").on("hidden.bs.modal",function(){jQuery("#btnInvoiceSelected").prop("disabled",!1).find("i").toggleClass("fa fa-spinner fa-spin")}),jQuery("#modalSaveProject").on("show.bs.modal",function(){jQuery(this).find('input[name="title"]').focus()}),jQuery(document).on("keyup",".displayHours",function(){var e=jQuery(this).val().split(":"),t=Number(e[0])+Number(e[1]/60)+Number(e[2]/3600),i=jQuery(this).data("key"),n=jQuery("#invoiceItemsHours"+i);n.val(t);var a=n.val()*jQuery("#invoiceItemsRate"+i).val();jQuery("#invoiceItemsAmount"+i).val(a.toFixed(2))}).on("keyup",".itemRate",function(){var e=jQuery(this).data("key"),t=jQuery("#invoiceItemsHours"+e).val(),i=jQuery(this).val();jQuery("#invoiceItemsAmount"+e).val(parseFloat(t*i).toFixed(2))}).on("click",".message-file",function(e){e.preventDefault();var t=jQuery(this).data("key");document.getElementById("fileView"+t).click()}),jQuery("#tableLog").length>0&&(jQuery("#tableLog").DataTable({dom:'<"listtable"fit>pl',info:!1,filter:!0,responsive:!0,oLanguage:{sEmptyTable:lang.noRecordsFound,sInfo:lang.tableShowingXOfY,sInfoEmpty:lang.tableShowingEmpty,sInfoFiltered:lang.tableFiltered,sInfoPostFix:"",sInfoThousands:",",sLengthMenu:lang.tableMenuLength,sLoadingRecords:lang.tableLoading,sProcessing:lang.tableProcessing,sSearch:"",sZeroRecords:lang.noRecordsFound,oPaginate:{sFirst:lang.tableFirst,sLast:lang.tableLast,sNext:lang.tableNext,sPrevious:lang.tablePrevious}},pageLength:10,order:[[0,"desc"]],lengthMenu:[[10,25,50,-1],[10,25,50,lang.all]],aoColumnDefs:[{bSortable:!1,aTargets:[1,2]}],columns:[{width:"15%"},{width:"65%"},null],stateSave:!0}),jQuery(".dataTables_filter input").attr("placeholder",lang.enterSearch)),jQuery("#addMessageFiles").fileinput({maxFileSize:1024*maximumFileSize,showUpload:!1,allowedPreviewTypes:["image","html","text","pdf"],showCaption:!0,initialCaption:lang.multipleFiles,overwriteInitial:!1,uploadUrl:"addonmodules.php?module=project_management&action=uploadFileForMessage&ajax=1&projectid="+jQuery("#projectId").val()+"&token="+jQuery("#csrfToken").val(),uploadAsync:!1,dropZoneEnabled:!1}),jQuery("#btnAddComment").on("click",function(){jQuery("#tabMessages").find("a").click(),jQuery("#inputAddMessage").focus()})});var newProjectTicket,ProjectManagerHandlers={addmessage:function(e){var t=e.newMessage[0],i="",n=(jQuery("#projectId").val(),e.deletePermission),a="";t.attachment&&jQuery.each(t.attachment,function(e,t){i=i+'<a href="#" class="message-file" data-key="'+e+'">'+t.displayFilename+"</a>",appendFile(e,t)}),n&&(a='<div class="pull-right"><input type="button" value="Delete" class="btn btn-danger btn-xs" onclick="ProjectManager.confirm(\'deletemsg\', \'msgid='+t.id+"')\"></div>"),jQuery(".messages").prepend('<div class="message hidden" id="message-'+t.id+'"><div class="user-gravatar"><img src="'+t.gravatarUrl+'"></div><div class="number">'+t.number+'.</div><div class="content"><span class="user">'+t.name+'</span><span class="date">'+t.date+"</span>"+a+'<span class="msg">'+t.message+"</span>"+i+"</div></div>"),jQuery("#message-"+t.id).hide().removeClass("hidden").slideDown(),jQuery("#addMessage").find(".fileinput-remove").click(),jQuery("#inputAddMessage").val("").focus(),jQuery("#tabMessages").find("span").html(e.messageCount),jQuery("#fileCount").html(e.fileCount)},addtask:function(e){var t=e.newTask[0],i='<span id="assigned-admin-task-'+t.id+'" class="assigned-admin" data-id="'+t.adminId+'">'+t.assigned+"</span>",n='<span id="task-due-date-'+t.id+'" data-id="'+t.id+'" class="task-due-date"> '+t.duedate+" </span>",a=e.editPermission,r=e.deletePermission,s="";a&&(s='<i class="task-edit far fa-pencil-alt"></i>'),r&&(""!==s&&(s+="&nbsp;"),s+='<i class="task-delete far fa-trash-alt"></i>'),jQuery("#noTasks").hide(),jQuery(".tasks").append('<tr class="task-line-item hidden" id="task-'+t.id+'"><td><i class="task-status-indicator far fa-check-circle"></i><span class="description"> '+decodeHtml(t.task)+"</span> "+i+n+'<div class="actions">'+s+'</div><span id="total-time-task-'+t.id+'" class="pull-right label label-assigned-user total-time" data-task-id="'+t.id+'">00:00:00</span><br /><span class="text-grey">'+decodeHtml(t.notes)+"</span></td></tr>"),Sortable.create(document.getElementById("assigned-admin-task-"+t.id),{group:{name:"admin"+t.id,pull:!1,put:["adminSort"]},sort:!1,ghostClass:"ghost",onAdd:function(e){jQuery(e.target).html(e.item),ProjectManager.call("assigntask","taskid="+jQuery(e.target).data("id")+"&admin="+jQuery(e.item).data("id"))}}),Sortable.create(document.getElementById("task-due-date-"+t.id),{group:{name:"due-date-"+t.id,pull:!1,put:["dueDateSelect"]},sort:!1,ghostClass:"ghost",onAdd:function(e){jQuery(e.target).html('<span class="label label-assigned-user">Updating...</span>'),ProjectManager.call("taskduedate","taskid="+jQuery(e.target).data("id")+"&duedate="+jQuery(e.item).data("id"))}}),jQuery("#task-"+t.id).hide().removeClass("hidden").slideDown(),jQuery("#inputAddTask, #inputAddDueDate").val(""),jQuery("#inputAssignId").val(0),jQuery("#totalTasks").html(e.summary.total),jQuery("#completedTasks").html(e.summary.completed),jQuery("#inputTaskAssignment").append(jQuery("<option></option>",{value:t.id,text:t.task})),jQuery("#editTimerTaskId").append(jQuery("<option></option>",{value:t.id,text:t.task}))},deletetask:function(e){jQuery("#task-"+e.deletedTaskId).fadeOut("fast",function(){"0"===e.summary.total&&jQuery("#noTasks").hide().removeClass("hidden").show()}),jQuery("#totalTasks").html(e.summary.total),jQuery("#completedTasks").html(e.summary.completed),jQuery("#inputTaskAssignment").find("option[value='"+e.deletedTaskId+"']").remove(),jQuery("#editTimerTaskId").find("option[value='"+e.deletedTaskId+"']").remove()},taskstatustoggle:function(e){var t=$("#task-"+e.taskId);1==e.isCompleted?(t.addClass("task-line-item-completed"),$("#toggleCompleteHide").is(":checked")&&t.addClass("hidden")):t.removeClass("task-line-item-completed"),jQuery("#totalTasks").html(e.summary.total),jQuery("#completedTasks").html(e.summary.completed)},taskedit:function(e){var t=e.task[0],i=$("#task-"+t.id).find("td");i.find(".description").html(decodeHtml(t.task)),i.find(".assigned-admin").html(t.assigned),i.find(".task-due-date").html(t.duedate),i.find(".task-notes").html(decodeHtml(t.notes))},gettaskinfo:function(e){var t=e.task[0];$("#inputTaskId").val(t.id),$("#inputTaskTitle").val(decodeHtml(t.task)),$("#inputTaskNotes").val(decodeHtml(t.notes)),$("#inputTaskEditAdminAssignment").val(t.adminId),$("#inputTaskDue").val(t.rawDueDate)},deletemsg:function(e){jQuery("#message-"+e.deletedMessageId).fadeOut(),jQuery("#tabMessages").find("span").html(e.messageCount),jQuery.each(e.deletedFiles,function(e,t){jQuery("#file-"+t).fadeOut()}),jQuery("#fileCount").html(e.fileCount);
},deletefile:function(e){jQuery("#file-"+e.deletedFileNumber).fadeOut(),jQuery('a.message-file[data-key="'+e.deletedFileNumber+'"]').remove(),jQuery("#fileCount").html(e.fileCount)},addticket:function(e){"0"==e.status?jQuery("#frmAddTicket").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():(appendTicket(e.ticket),jQuery("#ticketCount").text(e.ticketCount),jQuery.growl.notice({title:lang.success,message:lang.ticketAssociated.replace(":tid",e.ticket.tid)}),jQuery("#frmAddTicket").find(".modal").modal("hide"),jQuery("#associatedTicketResults").find(".ticket").remove(),jQuery("#resultInfo").fadeIn("fast"))},openticket:function(e){"0"==e.status?jQuery.growl.error({title:lang.error,message:e.error}):(appendTicket(e.ticket),jQuery("#modalOpenTicket").find("input").not("#newTicketClientRO").each(function(){jQuery(this).val("")}),jQuery("#newTicketContact").val("0"),"undefined"!=typeof Storage&&localStorage.removeItem("project-"+jQuery("#projectId").val()+"-new-ticket"),newProjectTicket[0].value="",jQuery("#ticketCount").text(e.ticketCount),jQuery.growl.notice({title:lang.success,message:lang.ticketCreated.replace(":tid",e.ticket.tid)}))},starttimer:function(e){$("#btnStartTimer").hide().find("i").toggleClass("fa-clock fa-spinner fa-spin"),$("#btnEndTimer").removeProp("disabled").removeClass("hidden").show().data("timerid",e.newTimerId);var t=e.newTimer[0];$(".timers").append('<tr id="timer-'+t.id+'"><td><input title="Timer '+t.id+'" type="checkbox" name="timerId[]" value="'+t.id+'" /></td><td>'+t.date+"</td><td>"+t.adminName+"</td><td>"+t.taskName+"</td><td>"+t.startTime+'</td><td class="timer-end-time">'+t.endTime+'</td><td><i class="fas fa-times-circle"></i></td><td class="timer-duration">'+t.duration+'</td><td><a href="#" class="timer-edit"><i class="fas fa-pencil-alt"></i></a></td><td></td></tr>'),$("#timer-"+t.id).find('input[type="checkbox"]').prop("disabled",!0).addClass("disabled"),jQuery("#noTimers").hide()},endtimer:function(e){$("#btnStartTimer").removeProp("disabled").removeClass("hidden").show(),$("#btnEndTimer").hide().find("i").toggleClass("fa-clock fa-spinner fa-spin");var t=e.endedTimerId,i=$("#timer-"+t),n=e.timer[0],a=$("#total-time-task-"+n.taskId);i.find(".timer-end-time").html(n.endTime),i.find(".timer-duration").html(n.duration),i.find('input[type="checkbox"]').prop("disabled",!1).removeClass("disabled"),n.taskId&&a.length&&a.html(n.totalTaskTime),$("#time-logged").html(e.totalTime),$("#time-billed").html(e.totalBilled)},deleteTimer:function(e){var t=e.deletedTimerId,i=$("#timer-"+t);$(i).fadeOut("fast",function(){e.totalCount||$("#noTimers").hide().removeClass("hidden").show(),e.openTimerId||($("#btnStartTimer").removeProp("disabled").removeClass("hidden").show(),$("#btnEndTimer").hide())}),$("#time-logged").html(e.totalTime),$("#time-billed").html(e.totalBilled)},taskduedate:function(e){"0"==e.status?jQuery.growl.error({title:lang.error,message:e.error}):(jQuery.growl.notice({title:lang.success,message:lang.dueDateUpdated}),jQuery("#task-due-date-"+e.taskId).html(e.dueDate))},assigntask:function(e){"0"==e.status?jQuery.growl.error({title:lang.error,message:e.error}):jQuery.growl.notice({title:lang.success,message:lang.assignmentUpdated})},searchTickets:function(e){"0"==e.status?(jQuery("#frmAddTicket").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn(),jQuery("#associatedTicketResults").find(".ticket").hide().remove(),jQuery("#resultInfo").fadeIn("fast")):jQuery("#resultInfo").fadeOut("fast",function(){0==e.tickets.length?jQuery("#associatedTicketResults").append('<a class="list-group-item ticket bottom-margin-5">'+lang.noTicketsFound+"</a>"):e.tickets.forEach(function(e){jQuery("#associatedTicketResults").append('<a class="list-group-item ticket bottom-margin-5 ticket-result" data-ticket-tid="'+e.tid+'" href="#"><span class="ticketnum">'+lang.ticketNum+e.tid+'</span> <span class="subject">'+e.title+'</span> <span class="label" style="background-color: '+e.statusColour+"; color: "+e.statusTextColour+';">'+e.status+"</span></a>")})})},unlinkTicket:function(e){"0"==e.status?jQuery.growl.error({title:lang.error,message:e.error}):(jQuery("#ticket-"+e.ticketId).toggle("highlight").remove(),jQuery("#ticketCount").text(e.ticketCount),"0"===e.ticketCount&&jQuery("#noTickets").show(),jQuery.growl.notice({title:lang.success,message:lang.ticketRemoved}))},unlinkInvoice:function(e){"0"==e.status?jQuery.growl.error({title:lang.error,message:e.error}):(jQuery("#invoice-"+e.invoiceId).toggle("highlight").remove(),jQuery("#associatedInvoiceCount").text(e.invoiceCount),"0"===e.invoiceCount&&jQuery("#noInvoices").show(),jQuery.growl.notice({title:lang.success,message:lang.invoiceRemoved}))},searchInvoices:function(e){"0"==e.status?(jQuery("#frmAddInvoice").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn(),jQuery("#associatedInvoiceResults").find(".invoice").remove(function(){jQuery("#invoiceResultInfo").fadeIn("fast")})):jQuery("#invoiceResultInfo").fadeOut("fast",function(){0==e.invoices.length?jQuery("#associatedInvoiceResults").append('<a class="list-group-item invoice bottom-margin-5">'+lang.noInvoicesFound+"</a>"):e.invoices.forEach(function(e){jQuery("#associatedInvoiceResults").append('<a class="list-group-item invoice bottom-margin-5 invoice-result" data-invoice-id="'+e.id+'" href="#"><span class="invoice-data">'+lang.invoiceNum+(e.invoiceNumber?e.invoiceNumber:e.id)+'</span> <span class="invoice-data"> - '+lang.total+": "+e.total+'</span><span class="invoice-data"> - '+lang.due+": "+e.dateDue+'</span><span class="label '+e.status.toLowerCase()+'">'+e.status+"</span></a>")})})},addInvoice:function(e){if("0"==e.status)jQuery("#frmAddInvoice").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn();else{var t=e.invoice;appendInvoice(t),jQuery("#associatedInvoiceCount").text(e.invoiceCount),jQuery.growl.notice({title:lang.success,message:lang.invoiceAssociated.replace(":num",t.id)}),jQuery("#frmAddInvoice").find(".modal").modal("hide"),jQuery("#associatedInvoiceResults").find(".ticket").remove(),jQuery("#invoiceResultInfo").fadeIn("fast")}},createInvoice:function(e){if("0"==e.status)jQuery("#frmCreateInvoice").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn();else{var t=e.invoice;appendInvoice(t),jQuery("#associatedInvoiceCount").text(e.invoiceCount),jQuery.growl.notice({title:lang.success,message:lang.invoiceCreated.replace(":num",t.id)}),jQuery("#frmCreateInvoice").find(".modal").modal("hide"),jQuery("#createInvoiceApplyTax").removeAttr("checked"),jQuery("#createInvoiceSendEmail").removeAttr("checked"),jQuery("#createInvoiceCreated").val(""),jQuery("#createInvoiceDue").val(""),jQuery("#createInvoiceAmount").val(""),jQuery("#createInvoiceDescription").val("")}},selectTaskList:function(e){if("0"==e.status)jQuery("#formImportTasks").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn();else{var t=e.tasks,i=jQuery("#importTaskResults");jQuery("#tasksResultInfo").fadeOut("fast",function(){jQuery(this).addClass("hidden").show(),i.find(".ticket").fadeOut("fast",function(){jQuery(this).remove()}),"undefined"==typeof t?i.append('<a class="list-group-item ticket bottom-margin-5">'+lang.noTasksFound+"</a>"):(t.forEach(function(e){i.append('<div class="row list-group-item ticket bottom-margin-5"><div class="col-md-1"><input type="checkbox" name="taskId[]" value="'+e.id+'" checked="checked" class="checkbox-inline"></div><div class="col-md-9"><span class="subject">'+e.name+"</span></div></div>")}),i.append('<input type="hidden" name="reference" value="'+e.reference+'" />'))})}},importTasks:function(e){var t=e.editPermission,i=e.deletePermission,n="";t&&(n='<i class="task-edit far fa-pencil-alt"></i>'),i&&(""!==n&&(n+="&nbsp;"),n+='<i class="task-delete far fa-trash-alt"></i>'),e.tasks.forEach(function(e){$(".tasks").append('<tr class="task-line-item hidden" id="task-'+e.id+'"><td><i class="task-status-indicator far fa-check-circle"></i><span class="description"> '+e.task+"</span> "+e.assigned+e.duedate+'<div class="actions">'+n+'</div><br /><span class="text-grey">'+e.notes+"</span></td></tr>"),$("#task-"+e.id).hide().removeClass("hidden").slideDown()}),jQuery("#totalTasks").html(e.summary.total),jQuery("#completedTasks").html(e.summary.completed)},watch:function(e){},unwatch:function(e){},saveTaskList:function(e){jQuery("#formSaveTaskList").find(".modal").modal("hide").end().find('input[name="name"]').val(""),jQuery.growl.notice({title:lang.success,message:lang.taskListCreated+": "+e.taskListName})},gettimerinfo:function(e){var t=(jQuery("#editTimers"),e.timer[0]),i=jQuery("#editTimerTaskId"),n=jQuery("#editTimerAdminId"),a=jQuery("#editTimerStartDate"),r=jQuery("#editTimerEndDate");jQuery("#frmTimeTrackingTimerId").val(t.id),i.val(t.taskId),n.val(t.adminId),r.val(t.endDateTime),r.data("daterangepicker").setStartDate(t.endDateTime),r.data("daterangepicker").setEndDate(t.endDateTime),a.val(t.dateTime),a.data("daterangepicker").setStartDate(t.dateTime),a.data("daterangepicker").setEndDate(t.dateTime),jQuery("#frmTimeTracking").find(".btn-primary").focus()},updateTimer:function(e){var t=e.timer[0],i='<i class="fas fa-times-circle"></i>',n=jQuery("#total-time-task-"+t.taskId);1===t.billed&&(i='<i class="fas fa-check-circle"></i>'),jQuery("#timer-"+t.id).html('<td><input title="Timer '+t.id+'" type="checkbox" name="timerId[]" value="'+t.id+'"/></td><td>'+t.date+"</td><td>"+t.adminName+"</td><td>"+t.taskName+"</td><td>"+t.startTime+'</td><td class="timer-end-time">'+t.endTime+"</td><td>"+i+'</td><td class="timer-duration">'+t.duration+'</td><td><a href="#" class="timer-edit"><i class="fas fa-pencil-alt"></i></a></td><td></td>'),"-"===t.endTime&&jQuery("#timer-"+timerId).find('input[type="checkbox"]').prop("disabled",!0).addClass("disabled"),t.taskId&&n.length&&n.html(t.totalTaskTime),jQuery.growl.notice({title:lang.success,message:lang.timerEdited})},taskTimeAdd:function(e){if("0"===e.status)jQuery.growl.error({title:lang.error,message:e.error});else{var t=e.timer[0],i='<i class="fas fa-times-circle"></i>',n=jQuery("#total-time-task-"+t.taskId);1===t.billed&&(i='<i class="fas fa-check-circle"></i>'),jQuery("#noTimers").hide(),jQuery("#timersTable").append('<tr id="timer-'+t.id+'"><td><input title="Timer '+t.id+'" type="checkbox" name="timerId[]" value="'+t.id+'"/></td><td>'+t.date+"</td><td>"+t.adminName+"</td><td>"+t.taskName+"</td><td>"+t.startTime+'</td><td class="timer-end-time">'+t.endTime+"</td><td>"+i+'</td><td class="timer-duration">'+t.duration+'</td><td><a href="#" class="timer-edit"><i class="fas fa-pencil-alt"></i></a></td></tr>'),t.taskId&&n.length&&n.html(t.totalTaskTime),$("#time-logged").html(e.totalTime),$("#time-billed").html(e.totalBilled),jQuery.growl.notice({title:lang.success,message:lang.timeAdded})}},invoiceItems:function(e){var t=jQuery("#timersTable"),i=e.timers,n=e.invoice;t.find("tbody").html(""),jQuery.each(i,function(e,i){var n="",a="";("-"===i.endTime||i.billed)&&(n=' disabled="disabled"',a=' class="disabled"'),t.find("tbody").append('<tr id="'+i.id+'"><td><input title="Timer '+i.id+'" type="checkbox" name="timerId[]" value="'+i.id+'"'+n+a+"/></td><td>"+i.date+"</td><td>"+i.adminName+"</td><td>"+i.taskName+"</td><td>"+i.startTime+"</td><td"+("-"!==i.endTime?"":' class="timer-end-time"')+">"+i.endTime+"</td><td>"+(i.billed?'<i class="fas fa-check-circle"></i>':'<i class="fas fa-times-circle"></i>')+"</td><td"+("-"!==i.endTime?"":' class="timer-duration"')+">"+i.duration+'</td><td><a href="#" class="timer-edit" onclick="return false;"><i class="fas fa-pencil-alt"></i></a></td></tr>')}),jQuery("#time-logged").html(e.totalTime),jQuery("#time-billed").html(e.totalBilled),jQuery("#associatedInvoiceCount").text(e.invoiceCount),appendInvoice(n),jQuery.growl.notice({title:lang.success,message:lang.invoiceGenerated+": "+e.invoiceId})},saveProject:function(e){var t=jQuery("#detailsDue"),i=jQuery("#detailsAssigned"),n=jQuery("#detailsClient"),a=jQuery("#detailsStatus"),r=jQuery("#detailsUpdated"),s=jQuery("#createInvoice"),o=jQuery("#btnInvoiceSelected"),l=jQuery("#openTicketClient"),d=jQuery("#openTicketNoClient"),c=jQuery("#newTicketClientRO"),u=jQuery("#btnSendEmail"),p=jQuery("#projectTitle"),h=jQuery("#detailsClientLi");p.html(e.title),t.html(e.due),i.html(e.admin),n.html(e.client),a.html(e.status),r.html(e.modified),s.addClass("disabled").prop("disabled",!0),o.addClass("disabled").prop("disabled",!0),l.addClass("hidden"),d.removeClass("hidden"),u.addClass("hidden"),h.attr("data-toggle","modal"),e.clientId&&(h.removeAttr("data-toggle"),s.removeClass("disabled").prop("disabled",!1),o.removeClass("disabled").prop("disabled",!1),l.removeClass("hidden"),d.addClass("hidden"),c.val(e.clientName),u.removeClass("hidden"))},sendEmail:function(e){"0"===e.status?jQuery("#formSendEmail").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():jQuery.growl.notice({title:lang.success,message:lang.emailSent})},duplicateProject:function(e){"0"===e.status?jQuery("#formSendEmail").find(".error-feedback").html(e.error).hide().removeClass("hidden").fadeIn():window.location.href="addonmodules.php?module=project_management&m=view&projectid="+e.newProjectId}};!function(e,t){"function"==typeof define&&define.amd?define(["jquery","sifter","microplugin"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function(e,t,i){"use strict";var n=function(e,t){if("string"!=typeof t||t.length){var i="string"==typeof t?new RegExp(t,"i"):t,n=function(e){var t=0;if(3===e.nodeType){var a=e.data.search(i);if(a>=0&&e.data.length>0){var r=e.data.match(i),s=document.createElement("span");s.className="highlight";var o=e.splitText(a),l=(o.splitText(r[0].length),o.cloneNode(!0));s.appendChild(l),o.parentNode.replaceChild(s,o),t=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var d=0;d<e.childNodes.length;++d)d+=n(e.childNodes[d]);return t};return e.each(function(){n(this)})}};e.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var e=this.parentNode;e.replaceChild(this.firstChild,this),e.normalize()}).end()};var a=function(){};a.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[e]:(this._events=this._events||{},void(e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)))},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},a.mixin=function(e){for(var t=["on","off","trigger"],i=0;i<t.length;i++)e.prototype[t[i]]=a.prototype[t[i]]};var r=/Mac/.test(navigator.userAgent),s=65,o=13,l=27,d=37,c=38,u=80,p=39,h=40,m=78,f=8,g=46,v=16,w=r?91:17,y=r?18:17,b=9,C=1,k=2,_=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,T=function(e){return"undefined"!=typeof e},I=function(e){return"undefined"==typeof e||null===e?null:"boolean"==typeof e?e?"1":"0":e+""},F=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},x={};x.before=function(e,t,i){var n=e[t];e[t]=function(){return i.apply(e,arguments),n.apply(e,arguments)}},x.after=function(e,t,i){var n=e[t];e[t]=function(){var t=n.apply(e,arguments);return i.apply(e,arguments),t}};var E=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},S=function(e,t){var i;return function(){var n=this,a=arguments;window.clearTimeout(i),i=window.setTimeout(function(){e.apply(n,a)},t)}},D=function(e,t,i){var n,a=e.trigger,r={};e.trigger=function(){var i=arguments[0];return t.indexOf(i)===-1?a.apply(e,arguments):void(r[i]=arguments)},i.apply(e,[]),e.trigger=a;for(n in r)r.hasOwnProperty(n)&&a.apply(e,r[n])},j=function(e,t,i,n){e.on(t,i,function(t){for(var i=t.target;i&&i.parentNode!==e[0];)i=i.parentNode;return t.currentTarget=i,n.apply(this,[t])})},$=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var i=document.selection.createRange(),n=document.selection.createRange().text.length;i.moveStart("character",-e.value.length),t.start=i.text.length-n,t.length=n}return t},P=function(e,t,i){var n,a,r={};if(i)for(n=0,a=i.length;n<a;n++)r[i[n]]=e.css(i[n]);else r=e.css();t.css(r)},A=function(t,i){if(!t)return 0;var n=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");P(i,n,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var a=n.width();return n.remove(),a},z=function(e){var t=null,i=function(i,n){var a,r,s,o,l,d,c,u;i=i||window.event||{},n=n||{},i.metaKey||i.altKey||(n.force||e.data("grow")!==!1)&&(a=e.val(),i.type&&"keydown"===i.type.toLowerCase()&&(r=i.keyCode,s=r>=97&&r<=122||r>=65&&r<=90||r>=48&&r<=57||32===r,r===g||r===f?(u=$(e[0]),u.length?a=a.substring(0,u.start)+a.substring(u.start+u.length):r===f&&u.start?a=a.substring(0,u.start-1)+a.substring(u.start+1):r===g&&"undefined"!=typeof u.start&&(a=a.substring(0,u.start)+a.substring(u.start+1))):s&&(d=i.shiftKey,c=String.fromCharCode(i.keyCode),c=d?c.toUpperCase():c.toLowerCase(),a+=c)),o=e.attr("placeholder"),!a&&o&&(a=o),l=A(a,e)+4,l!==t&&(t=l,e.width(l),e.triggerHandler("resize")))};e.on("keydown keyup update blur",i),i()},O=function(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},Q=function(e,t){t||(t={});var i="Selectize";console.error(i+": "+e),t.explanation&&(console.group&&console.group(),console.error(t.explanation),console.group&&console.groupEnd())},M=function(i,n){var a,r,s,o,l=this;o=i[0],o.selectize=l;var d=window.getComputedStyle&&window.getComputedStyle(o,null);if(s=d?d.getPropertyValue("direction"):o.currentStyle&&o.currentStyle.direction,s=s||i.parents("[dir]:first").attr("dir")||"",e.extend(l,{order:0,settings:n,$input:i,tabIndex:i.attr("tabindex")||"",tagType:"select"===o.tagName.toLowerCase()?C:k,rtl:/rtl/i.test(s),eventNS:".selectize"+ ++M.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:i.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===n.loadThrottle?l.onSearchChange:S(l.onSearchChange,n.loadThrottle)}),l.sifter=new t(this.options,{diacritics:n.diacritics}),l.settings.options){for(a=0,r=l.settings.options.length;a<r;a++)l.registerOption(l.settings.options[a]);delete l.settings.options}if(l.settings.optgroups){for(a=0,r=l.settings.optgroups.length;a<r;a++)l.registerOptionGroup(l.settings.optgroups[a]);delete l.settings.optgroups}l.settings.mode=l.settings.mode||(1===l.settings.maxItems?"single":"multi"),"boolean"!=typeof l.settings.hideSelected&&(l.settings.hideSelected="multi"===l.settings.mode),l.initializePlugins(l.settings.plugins),l.setupCallbacks(),l.setupTemplates(),l.setup()};return a.mixin(M),"undefined"!=typeof i?i.mixin(M):Q("Dependency MicroPlugin is missing",{explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'}),e.extend(M.prototype,{setup:function(){var t,i,n,a,s,o,l,d,c,u,p=this,h=p.settings,m=p.eventNS,f=e(window),g=e(document),b=p.$input;if(l=p.settings.mode,d=b.attr("class")||"",t=e("<div>").addClass(h.wrapperClass).addClass(d).addClass(l),i=e("<div>").addClass(h.inputClass).addClass("items").appendTo(t),n=e('<input type="text" autocomplete="off" />').appendTo(i).attr("tabindex",b.is(":disabled")?"-1":p.tabIndex),o=e(h.dropdownParent||t),a=e("<div>").addClass(h.dropdownClass).addClass(l).hide().appendTo(o),s=e("<div>").addClass(h.dropdownContentClass).appendTo(a),(u=b.attr("id"))&&(n.attr("id",u+"-selectized"),e("label[for='"+u+"']").attr("for",u+"-selectized")),p.settings.copyClassesToDropdown&&a.addClass(d),t.css({width:b[0].style.width}),p.plugins.names.length&&(c="plugin-"+p.plugins.names.join(" plugin-"),t.addClass(c),a.addClass(c)),(null===h.maxItems||h.maxItems>1)&&p.tagType===C&&b.attr("multiple","multiple"),p.settings.placeholder&&n.attr("placeholder",h.placeholder),!p.settings.splitOn&&p.settings.delimiter){var k=p.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");p.settings.splitOn=new RegExp("\\s*"+k+"+\\s*")}b.attr("autocorrect")&&n.attr("autocorrect",b.attr("autocorrect")),b.attr("autocapitalize")&&n.attr("autocapitalize",b.attr("autocapitalize")),p.$wrapper=t,p.$control=i,p.$control_input=n,p.$dropdown=a,p.$dropdown_content=s,a.on("mouseenter","[data-selectable]",function(){return p.onOptionHover.apply(p,arguments)}),a.on("mousedown click","[data-selectable]",function(){return p.onOptionSelect.apply(p,arguments)}),j(i,"mousedown","*:not(input)",function(){return p.onItemSelect.apply(p,arguments)}),z(n),i.on({mousedown:function(){return p.onMouseDown.apply(p,arguments)},click:function(){return p.onClick.apply(p,arguments)}}),n.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return p.onKeyDown.apply(p,arguments)},keyup:function(){return p.onKeyUp.apply(p,arguments)},keypress:function(){return p.onKeyPress.apply(p,arguments)},resize:function(){p.positionDropdown.apply(p,[])},blur:function(){return p.onBlur.apply(p,arguments)},focus:function(){return p.ignoreBlur=!1,p.onFocus.apply(p,arguments)},paste:function(){return p.onPaste.apply(p,arguments)}}),g.on("keydown"+m,function(e){p.isCmdDown=e[r?"metaKey":"ctrlKey"],p.isCtrlDown=e[r?"altKey":"ctrlKey"],p.isShiftDown=e.shiftKey}),g.on("keyup"+m,function(e){e.keyCode===y&&(p.isCtrlDown=!1),e.keyCode===v&&(p.isShiftDown=!1),e.keyCode===w&&(p.isCmdDown=!1)}),g.on("mousedown"+m,function(e){if(p.isFocused){if(e.target===p.$dropdown[0]||e.target.parentNode===p.$dropdown[0])return!1;p.$control.has(e.target).length||e.target===p.$control[0]||p.blur(e.target)}}),f.on(["scroll"+m,"resize"+m].join(" "),function(){p.isOpen&&p.positionDropdown.apply(p,arguments)}),f.on("mousemove"+m,function(){p.ignoreHover=!1}),this.revertSettings={$children:b.children().detach(),tabindex:b.attr("tabindex")},b.attr("tabindex",-1).hide().after(p.$wrapper),e.isArray(h.items)&&(p.setValue(h.items),delete h.items),_&&b.on("invalid"+m,function(e){e.preventDefault(),p.isInvalid=!0,p.refreshState()}),p.updateOriginalInput(),p.refreshItems(),p.refreshState(),p.updatePlaceholder(),p.isSetup=!0,b.is(":disabled")&&p.disable(),p.on("change",this.onChange),b.data("selectize",p),b.addClass("selectized"),p.trigger("initialize"),h.preload===!0&&p.onSearchChange("")},setupTemplates:function(){var t=this,i=t.settings.labelField,n=t.settings.optgroupLabelField,a={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[n])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[i])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[i])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};t.settings.render=e.extend({},a,t.settings.render)},setupCallbacks:function(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)i.hasOwnProperty(e)&&(t=this.settings[i[e]],t&&this.on(e,t))},onClick:function(e){var t=this;t.isFocused||(t.focus(),e.preventDefault())},onMouseDown:function(t){var i=this,n=t.isDefaultPrevented();e(t.target);if(i.isFocused){if(t.target!==i.$control_input[0])return"single"===i.settings.mode?i.isOpen?i.close():i.open():n||i.setActiveItem(null),!1}else n||window.setTimeout(function(){i.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var i=this;return i.isFull()||i.isInputHidden||i.isLocked?void t.preventDefault():void(i.settings.splitOn&&setTimeout(function(){var t=i.$control_input.val();if(t.match(i.settings.splitOn))for(var n=e.trim(t).split(i.settings.splitOn),a=0,r=n.length;a<r;a++)i.createItem(n[a])},0))},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);return this.settings.create&&"multi"===this.settings.mode&&t===this.settings.delimiter?(this.createItem(),e.preventDefault(),!1):void 0},onKeyDown:function(e){var t=(e.target===this.$control_input[0],this);if(t.isLocked)return void(e.keyCode!==b&&e.preventDefault());switch(e.keyCode){case s:if(t.isCmdDown)return void t.selectAll();break;case l:return void(t.isOpen&&(e.preventDefault(),e.stopPropagation(),t.close()));case m:if(!e.ctrlKey||e.altKey)break;case h:if(!t.isOpen&&t.hasOptions)t.open();else if(t.$activeOption){t.ignoreHover=!0;var i=t.getAdjacentOption(t.$activeOption,1);i.length&&t.setActiveOption(i,!0,!0)}return void e.preventDefault();case u:if(!e.ctrlKey||e.altKey)break;case c:if(t.$activeOption){t.ignoreHover=!0;var n=t.getAdjacentOption(t.$activeOption,-1);n.length&&t.setActiveOption(n,!0,!0)}return void e.preventDefault();case o:return void(t.isOpen&&t.$activeOption&&(t.onOptionSelect({currentTarget:t.$activeOption}),e.preventDefault()));case d:return void t.advanceSelection(-1,e);case p:return void t.advanceSelection(1,e);case b:return t.settings.selectOnTab&&t.isOpen&&t.$activeOption&&(t.onOptionSelect({currentTarget:t.$activeOption}),t.isFull()||e.preventDefault()),void(t.settings.create&&t.createItem()&&e.preventDefault());case f:case g:return void t.deleteSelection(e)}return!t.isFull()&&!t.isInputHidden||(r?e.metaKey:e.ctrlKey)?void 0:void e.preventDefault()},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var i=t.$control_input.val()||"";t.lastValue!==i&&(t.lastValue=i,t.onSearchChange(i),t.refreshOptions(),t.trigger("type",i))},onSearchChange:function(e){var t=this,i=t.settings.load;i&&(t.loadedSearches.hasOwnProperty(e)||(t.loadedSearches[e]=!0,t.load(function(n){i.apply(t,[e,n])})))},onFocus:function(e){var t=this,i=t.isFocused;return t.isDisabled?(t.blur(),e&&e.preventDefault(),!1):void(t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.onSearchChange(""),i||t.trigger("focus"),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState()))},onBlur:function(e,t){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(e);var n=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),t&&t.focus&&t.focus(),i.ignoreFocus=!1,i.trigger("blur")};i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,n):n()}},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(t){var i,n,a=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),n=e(t.currentTarget),n.hasClass("create")?a.createItem(null,function(){a.settings.closeAfterSelect&&a.close()}):(i=n.attr("data-value"),"undefined"!=typeof i&&(a.lastQuery=null,a.setTextboxValue(""),a.addItem(i),a.settings.closeAfterSelect?a.close():!a.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&a.setActiveOption(a.getOption(i))))},onItemSelect:function(e){var t=this;t.isLocked||"multi"===t.settings.mode&&(e.preventDefault(),t.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,i=t.$wrapper.addClass(t.settings.loadingClass);t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||i.removeClass(t.settings.loadingClass),t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input,i=t.val()!==e;i&&(t.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===C&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e,t){var i=t?[]:["change"];D(this,i,function(){this.clear(t),this.addItems(e,t)})},setActiveItem:function(t,i){var n,a,r,s,o,l,d,c,u=this;if("single"!==u.settings.mode){if(t=e(t),!t.length)return e(u.$activeItems).removeClass("active"),u.$activeItems=[],void(u.isFocused&&u.showInput());if(n=i&&i.type.toLowerCase(),"mousedown"===n&&u.isShiftDown&&u.$activeItems.length){for(c=u.$control.children(".active:last"),s=Array.prototype.indexOf.apply(u.$control[0].childNodes,[c[0]]),o=Array.prototype.indexOf.apply(u.$control[0].childNodes,[t[0]]),s>o&&(d=s,s=o,o=d),a=s;a<=o;a++)l=u.$control[0].childNodes[a],u.$activeItems.indexOf(l)===-1&&(e(l).addClass("active"),u.$activeItems.push(l));i.preventDefault()}else"mousedown"===n&&u.isCtrlDown||"keydown"===n&&this.isShiftDown?t.hasClass("active")?(r=u.$activeItems.indexOf(t[0]),u.$activeItems.splice(r,1),t.removeClass("active")):u.$activeItems.push(t.addClass("active")[0]):(e(u.$activeItems).removeClass("active"),u.$activeItems=[t.addClass("active")[0]]);u.hideInput(),this.isFocused||u.focus()}},setActiveOption:function(t,i,n){var a,r,s,o,l,d=this;d.$activeOption&&d.$activeOption.removeClass("active"),d.$activeOption=null,t=e(t),t.length&&(d.$activeOption=t.addClass("active"),!i&&T(i)||(a=d.$dropdown_content.height(),r=d.$activeOption.outerHeight(!0),i=d.$dropdown_content.scrollTop()||0,s=d.$activeOption.offset().top-d.$dropdown_content.offset().top+i,o=s,l=s-a+r,s+r>a+i?d.$dropdown_content.stop().animate({scrollTop:l},n?d.settings.scrollDuration:0):s<i&&d.$dropdown_content.stop().animate({scrollTop:o},n?d.settings.scrollDuration:0)))},selectAll:function(){var e=this;"single"!==e.settings.mode&&(e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active")),e.$activeItems.length&&(e.hideInput(),e.close()),e.focus())},hideInput:function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4}),e.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0))},blur:function(e){this.$control_input[0].blur(),this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return"string"==typeof t&&(t=[{field:t}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(t){var i,n,a,r=this,s=r.settings,o=this.getSearchOptions();if(s.score&&(a=r.settings.score.apply(this,[t]),"function"!=typeof a))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==r.lastQuery?(r.lastQuery=t,n=r.sifter.search(t,e.extend(o,{score:a})),r.currentResults=n):n=e.extend(!0,{},r.currentResults),s.hideSelected)for(i=n.items.length-1;i>=0;i--)r.items.indexOf(I(n.items[i].id))!==-1&&n.items.splice(i,1);return n},refreshOptions:function(t){var i,a,r,s,o,l,d,c,u,p,h,m,f,g,v,w;"undefined"==typeof t&&(t=!0);var y=this,b=e.trim(y.$control_input.val()),C=y.search(b),k=y.$dropdown_content,_=y.$activeOption&&I(y.$activeOption.attr("data-value"));
for(s=C.items.length,"number"==typeof y.settings.maxOptions&&(s=Math.min(s,y.settings.maxOptions)),o={},l=[],i=0;i<s;i++)for(d=y.options[C.items[i].id],c=y.render("option",d),u=d[y.settings.optgroupField]||"",p=e.isArray(u)?u:[u],a=0,r=p&&p.length;a<r;a++)u=p[a],y.optgroups.hasOwnProperty(u)||(u=""),o.hasOwnProperty(u)||(o[u]=document.createDocumentFragment(),l.push(u)),o[u].appendChild(c);for(this.settings.lockOptgroupOrder&&l.sort(function(e,t){var i=y.optgroups[e].$order||0,n=y.optgroups[t].$order||0;return i-n}),h=document.createDocumentFragment(),i=0,s=l.length;i<s;i++)u=l[i],y.optgroups.hasOwnProperty(u)&&o[u].childNodes.length?(m=document.createDocumentFragment(),m.appendChild(y.render("optgroup_header",y.optgroups[u])),m.appendChild(o[u]),h.appendChild(y.render("optgroup",e.extend({},y.optgroups[u],{html:O(m),dom:m})))):h.appendChild(o[u]);if(k.html(h),y.settings.highlight&&C.query.length&&C.tokens.length)for(k.removeHighlight(),i=0,s=C.tokens.length;i<s;i++)n(k,C.tokens[i].regex);if(!y.settings.hideSelected)for(i=0,s=y.items.length;i<s;i++)y.getOption(y.items[i]).addClass("selected");f=y.canCreate(b),f&&(k.prepend(y.render("option_create",{input:b})),w=e(k[0].childNodes[0])),y.hasOptions=C.items.length>0||f,y.hasOptions?(C.items.length>0?(v=_&&y.getOption(_),v&&v.length?g=v:"single"===y.settings.mode&&y.items.length&&(g=y.getOption(y.items[0])),g&&g.length||(g=w&&!y.settings.addPrecedence?y.getAdjacentOption(w,1):k.find("[data-selectable]:first"))):g=w,y.setActiveOption(g),t&&!y.isOpen&&y.open()):(y.setActiveOption(null),t&&y.isOpen&&y.close())},addOption:function(t){var i,n,a,r=this;if(e.isArray(t))for(i=0,n=t.length;i<n;i++)r.addOption(t[i]);else(a=r.registerOption(t))&&(r.userOptions[a]=!0,r.lastQuery=null,r.trigger("option_add",a,t))},registerOption:function(e){var t=I(e[this.settings.valueField]);return"undefined"!=typeof t&&null!==t&&!this.options.hasOwnProperty(t)&&(e.$order=e.$order||++this.order,this.options[t]=e,t)},registerOptionGroup:function(e){var t=I(e[this.settings.optgroupValueField]);return!!t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)},removeOptionGroup:function(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.renderCache={},this.trigger("optgroup_remove",e))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,i){var n,a,r,s,o,l,d,c=this;if(t=I(t),r=I(i[c.settings.valueField]),null!==t&&c.options.hasOwnProperty(t)){if("string"!=typeof r)throw new Error("Value must be set in option data");d=c.options[t].$order,r!==t&&(delete c.options[t],s=c.items.indexOf(t),s!==-1&&c.items.splice(s,1,r)),i.$order=i.$order||d,c.options[r]=i,o=c.renderCache.item,l=c.renderCache.option,o&&(delete o[t],delete o[r]),l&&(delete l[t],delete l[r]),c.items.indexOf(r)!==-1&&(n=c.getItem(t),a=e(c.render("item",i)),n.hasClass("active")&&a.addClass("active"),n.replaceWith(a)),c.lastQuery=null,c.isOpen&&c.refreshOptions(!1)}},removeOption:function(e,t){var i=this;e=I(e);var n=i.renderCache.item,a=i.renderCache.option;n&&delete n[e],a&&delete a[e],delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)},clearOptions:function(){var e=this;e.loadedSearches={},e.userOptions={},e.renderCache={},e.options=e.sifter.items={},e.lastQuery=null,e.trigger("option_clear"),e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,i){var n=this.$dropdown.find("[data-selectable]"),a=n.index(t)+i;return a>=0&&a<n.length?n.eq(a):e()},getElementWithValue:function(t,i){if(t=I(t),"undefined"!=typeof t&&null!==t)for(var n=0,a=i.length;n<a;n++)if(i[n].getAttribute("data-value")===t)return e(i[n]);return e()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(t,i){for(var n=e.isArray(t)?t:[t],a=0,r=n.length;a<r;a++)this.isPending=a<r-1,this.addItem(n[a],i)},addItem:function(t,i){var n=i?[]:["change"];D(this,n,function(){var n,a,r,s,o,l=this,d=l.settings.mode;return t=I(t),l.items.indexOf(t)!==-1?void("single"===d&&l.close()):void(l.options.hasOwnProperty(t)&&("single"===d&&l.clear(i),"multi"===d&&l.isFull()||(n=e(l.render("item",l.options[t])),o=l.isFull(),l.items.splice(l.caretPos,0,t),l.insertAtCaret(n),(!l.isPending||!o&&l.isFull())&&l.refreshState(),l.isSetup&&(r=l.$dropdown_content.find("[data-selectable]"),l.isPending||(a=l.getOption(t),s=l.getAdjacentOption(a,1).attr("data-value"),l.refreshOptions(l.isFocused&&"single"!==d),s&&l.setActiveOption(l.getOption(s))),!r.length||l.isFull()?l.close():l.positionDropdown(),l.updatePlaceholder(),l.trigger("item_add",t,n),l.updateOriginalInput({silent:i})))))})},removeItem:function(t,i){var n,a,r,s=this;n=t instanceof e?t:s.getItem(t),t=I(n.attr("data-value")),a=s.items.indexOf(t),a!==-1&&(n.remove(),n.hasClass("active")&&(r=s.$activeItems.indexOf(n[0]),s.$activeItems.splice(r,1)),s.items.splice(a,1),s.lastQuery=null,!s.settings.persist&&s.userOptions.hasOwnProperty(t)&&s.removeOption(t,i),a<s.caretPos&&s.setCaret(s.caretPos-1),s.refreshState(),s.updatePlaceholder(),s.updateOriginalInput({silent:i}),s.positionDropdown(),s.trigger("item_remove",t,n))},createItem:function(t,i){var n=this,a=n.caretPos;t=t||e.trim(n.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(t))return r(),!1;n.lock();var s="function"==typeof n.settings.create?this.settings.create:function(e){var t={};return t[n.settings.labelField]=e,t[n.settings.valueField]=e,t},o=E(function(e){if(n.unlock(),!e||"object"!=typeof e)return r();var t=I(e[n.settings.valueField]);return"string"!=typeof t?r():(n.setTextboxValue(""),n.addOption(e),n.setCaret(a),n.addItem(t),n.refreshOptions(i&&"single"!==n.settings.mode),void r(e))}),l=s.apply(this,[t,o]);return"undefined"!=typeof l&&o(l),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var e=!this.items.length;this.isInvalid=e,this.$control_input.prop("required",e),this.$input.prop("required",!e)},refreshClasses:function(){var t=this,i=t.isFull(),n=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",n).toggleClass("full",i).toggleClass("not-full",!i).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!e.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0),t.$control_input.data("grow",!i&&!n)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,i,n,a,r=this;if(e=e||{},r.tagType===C){for(n=[],t=0,i=r.items.length;t<i;t++)a=r.options[r.items[t]][r.settings.labelField]||"",n.push('<option value="'+F(r.items[t])+'" selected="selected">'+F(a)+"</option>");n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),r.$input.html(n.join(""))}else r.$input.val(r.getValue()),r.$input.attr("value",r.$input.val());r.isSetup&&(e.silent||r.trigger("change",r.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update",{force:!0})}},open:function(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown))},close:function(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&(e.hideInput(),e.$control_input.blur()),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(e){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(null),t.updatePlaceholder(),t.updateOriginalInput({silent:e}),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(t){var i=Math.min(this.caretPos,this.items.length);0===i?this.$control.prepend(t):e(this.$control[0].childNodes[i]).before(t),this.setCaret(i+1)},deleteSelection:function(t){var i,n,a,r,s,o,l,d,c,u=this;if(a=t&&t.keyCode===f?-1:1,r=$(u.$control_input[0]),u.$activeOption&&!u.settings.hideSelected&&(l=u.getAdjacentOption(u.$activeOption,-1).attr("data-value")),s=[],u.$activeItems.length){for(c=u.$control.children(".active:"+(a>0?"last":"first")),o=u.$control.children(":not(input)").index(c),a>0&&o++,i=0,n=u.$activeItems.length;i<n;i++)s.push(e(u.$activeItems[i]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(u.isFocused||"single"===u.settings.mode)&&u.items.length&&(a<0&&0===r.start&&0===r.length?s.push(u.items[u.caretPos-1]):a>0&&r.start===u.$control_input.val().length&&s.push(u.items[u.caretPos]));if(!s.length||"function"==typeof u.settings.onDelete&&u.settings.onDelete.apply(u,[s])===!1)return!1;for("undefined"!=typeof o&&u.setCaret(o);s.length;)u.removeItem(s.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!0),l&&(d=u.getOption(l),d.length&&u.setActiveOption(d)),!0},advanceSelection:function(e,t){var i,n,a,r,s,o,l=this;0!==e&&(l.rtl&&(e*=-1),i=e>0?"last":"first",n=$(l.$control_input[0]),l.isFocused&&!l.isInputHidden?(r=l.$control_input.val().length,s=e<0?0===n.start&&0===n.length:n.start===r,s&&!r&&l.advanceCaret(e,t)):(o=l.$control.children(".active:"+i),o.length&&(a=l.$control.children(":not(input)").index(o),l.setActiveItem(null),l.setCaret(e>0?a+1:a))))},advanceCaret:function(e,t){var i,n,a=this;0!==e&&(i=e>0?"next":"prev",a.isShiftDown?(n=a.$control_input[i](),n.length&&(a.hideInput(),a.setActiveItem(n),t&&t.preventDefault())):a.setCaret(a.caretPos+e))},setCaret:function(t){var i=this;if(t="single"===i.settings.mode?i.items.length:Math.max(0,Math.min(i.items.length,t)),!i.isPending){var n,a,r,s;for(r=i.$control.children(":not(input)"),n=0,a=r.length;n<a;n++)s=e(r[n]).detach(),n<t?i.$control_input.before(s):i.$control.append(s)}i.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",!0),e.$control_input.prop("disabled",!0).prop("tabindex",-1),e.isDisabled=!0,e.lock()},enable:function(){var e=this;e.$input.prop("disabled",!1),e.$control_input.prop("disabled",!1).prop("tabindex",e.tabIndex),e.isDisabled=!1,e.unlock()},destroy:function(){var t=this,i=t.eventNS,n=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(n.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:n.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),e(window).off(i),e(document).off(i),e(document.body).off(i),delete t.$input[0].selectize},render:function(t,i){var n,a,r="",s=!1,o=this;return"option"!==t&&"item"!==t||(n=I(i[o.settings.valueField]),s=!!n),s&&(T(o.renderCache[t])||(o.renderCache[t]={}),o.renderCache[t].hasOwnProperty(n))?o.renderCache[t][n]:(r=e(o.settings.render[t].apply(this,[i,F])),"option"===t||"option_create"===t?r.attr("data-selectable",""):"optgroup"===t&&(a=i[o.settings.optgroupValueField]||"",r.attr("data-group",a)),"option"!==t&&"item"!==t||r.attr("data-value",n||""),s&&(o.renderCache[t][n]=r[0]),r[0])},clearCache:function(e){var t=this;"undefined"==typeof e?t.renderCache={}:delete t.renderCache[e]},canCreate:function(e){var t=this;if(!t.settings.create)return!1;var i=t.settings.createFilter;return e.length&&("function"!=typeof i||i.apply(t,[e]))&&("string"!=typeof i||new RegExp(i).test(e))&&(!(i instanceof RegExp)||i.test(e))}}),M.count=0,M.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},e.fn.selectize=function(t){var i=e.fn.selectize.defaults,n=e.extend({},i,t),a=n.dataAttr,r=n.labelField,s=n.valueField,o=n.optgroupField,l=n.optgroupLabelField,d=n.optgroupValueField,c=function(t,i){var o,l,d,c,u=t.attr(a);if(u)for(i.options=JSON.parse(u),o=0,l=i.options.length;o<l;o++)i.items.push(i.options[o][s]);else{var p=e.trim(t.val()||"");if(!n.allowEmptyOption&&!p.length)return;for(d=p.split(n.delimiter),o=0,l=d.length;o<l;o++)c={},c[r]=d[o],c[s]=d[o],i.options.push(c);i.items=d}},u=function(t,i){var c,u,p,h,m=i.options,f={},g=function(e){var t=a&&e.attr(a);return"string"==typeof t&&t.length?JSON.parse(t):null},v=function(t,a){t=e(t);var l=I(t.val());if(l||n.allowEmptyOption)if(f.hasOwnProperty(l)){if(a){var d=f[l][o];d?e.isArray(d)?d.push(a):f[l][o]=[d,a]:f[l][o]=a}}else{var c=g(t)||{};c[r]=c[r]||t.text(),c[s]=c[s]||l,c[o]=c[o]||a,f[l]=c,m.push(c),t.is(":selected")&&i.items.push(l)}},w=function(t){var n,a,r,s,o;for(t=e(t),r=t.attr("label"),r&&(s=g(t)||{},s[l]=r,s[d]=r,i.optgroups.push(s)),o=e("option",t),n=0,a=o.length;n<a;n++)v(o[n],r)};for(i.maxItems=t.attr("multiple")?null:1,h=t.children(),c=0,u=h.length;c<u;c++)p=h[c].tagName.toLowerCase(),"optgroup"===p?w(h[c]):"option"===p&&v(h[c])};return this.each(function(){if(!this.selectize){var a,r=e(this),s=this.tagName.toLowerCase(),o=r.attr("placeholder")||r.attr("data-placeholder");o||n.allowEmptyOption||(o=r.children('option[value=""]').text());var l={placeholder:o,options:[],optgroups:[],items:[]};"select"===s?u(r,l):c(r,l),a=new M(r,e.extend(!0,{},i,l,t))}})},e.fn.selectize.defaults=M.defaults,e.fn.selectize.support={validity:_},M.define("drag_drop",function(t){if(!e.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var i=this;i.lock=function(){var e=i.lock;return function(){var t=i.$control.data("sortable");return t&&t.disable(),e.apply(i,arguments)}}(),i.unlock=function(){var e=i.unlock;return function(){var t=i.$control.data("sortable");return t&&t.enable(),e.apply(i,arguments)}}(),i.setup=function(){var t=i.setup;return function(){t.apply(this,arguments);var n=i.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),n.css({overflow:"visible"})},stop:function(){n.css({overflow:"hidden"});var t=i.$activeItems?i.$activeItems.slice():null,a=[];n.children("[data-value]").each(function(){a.push(e(this).attr("data-value"))}),i.setValue(a),i.setActiveItem(t)}})}}()}}),M.define("dropdown_header",function(t){var i=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},t),i.setup=function(){var n=i.setup;return function(){n.apply(i,arguments),i.$dropdown_header=e(t.html(t)),i.$dropdown.prepend(i.$dropdown_header)}}()}),M.define("optgroup_columns",function(t){var i=this;t=e.extend({equalizeWidth:!0,equalizeHeight:!0},t),this.getAdjacentOption=function(t,i){var n=t.closest("[data-group]").find("[data-selectable]"),a=n.index(t)+i;return a>=0&&a<n.length?n.eq(a):e()},this.onKeyDown=function(){var e=i.onKeyDown;return function(t){var n,a,r,s;return!this.isOpen||t.keyCode!==d&&t.keyCode!==p?e.apply(this,arguments):(i.ignoreHover=!0,s=this.$activeOption.closest("[data-group]"),n=s.find("[data-selectable]").index(this.$activeOption),s=t.keyCode===d?s.prev("[data-group]"):s.next("[data-group]"),r=s.find("[data-selectable]"),a=r.eq(Math.min(r.length-1,n)),void(a.length&&this.setActiveOption(a)))}}();var n=function(){var e,t=n.width,i=document;return"undefined"==typeof t&&(e=i.createElement("div"),e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,i.body.appendChild(e),t=n.width=e.offsetWidth-e.clientWidth,i.body.removeChild(e)),t},a=function(){var a,r,s,o,l,d,c;if(c=e("[data-group]",i.$dropdown_content),r=c.length,r&&i.$dropdown_content.width()){if(t.equalizeHeight){for(s=0,a=0;a<r;a++)s=Math.max(s,c.eq(a).height());c.css({height:s})}t.equalizeWidth&&(d=i.$dropdown_content.innerWidth()-n(),o=Math.round(d/r),c.css({width:o}),r>1&&(l=d-o*(r-1),c.eq(r-1).css({width:l})))}};(t.equalizeHeight||t.equalizeWidth)&&(x.after(this,"positionDropdown",a),x.after(this,"refreshOptions",a))}),M.define("remove_button",function(t){t=e.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var i=function(t,i){i.className="remove-single";var n=t,a='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+F(i.title)+'">'+i.label+"</a>",r=function(e,t){return e+t};t.setup=function(){var s=n.setup;return function(){if(i.append){var o=e(n.$input.context).attr("id"),l=(e("#"+o),n.settings.render.item);n.settings.render.item=function(e){return r(l.apply(t,arguments),a)}}s.apply(t,arguments),t.$control.on("click","."+i.className,function(e){e.preventDefault(),n.isLocked||n.clear()})}}()},n=function(t,i){var n=t,a='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+F(i.title)+'">'+i.label+"</a>",r=function(e,t){var i=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,i)+t+e.substring(i)};t.setup=function(){var s=n.setup;return function(){if(i.append){var o=n.settings.render.item;n.settings.render.item=function(e){return r(o.apply(t,arguments),a)}}s.apply(t,arguments),t.$control.on("click","."+i.className,function(t){if(t.preventDefault(),!n.isLocked){var i=e(t.currentTarget).parent();n.setActiveItem(i),n.deleteSelection()&&n.setCaret(n.items.length)}})}}()};return"single"===this.settings.mode?void i(this,t):void n(this,t)}),M.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]},this.onKeyDown=function(){var i=t.onKeyDown;return function(t){var n,a;return t.keyCode===f&&""===this.$control_input.val()&&!this.$activeItems.length&&(n=this.caretPos-1,n>=0&&n<this.items.length)?(a=this.options[this.items[n]],this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[a])),this.refreshOptions(!0)),void t.preventDefault()):i.apply(this,arguments)}}()}),M}),$(document).ready(function(){if(Selectize.define("whmcs_no_results",function(e){var t=this;this.search=function(){var e=t.search;return function(){var t=e.apply(this,arguments),i=function(e){return isNaN(e.id)||e.id>0},n=t.items.filter(function(e){return i(e)}),a=t.items.filter(function(e){return!i(e)});return n.length>0?t.items=n:a.length>0&&(t.items=[a[0]]),t}}()}),"undefined"!=typeof WHMCS.selectize)jQuery(".selectize-client-search").data("search-url",getClientSearchPostUrl()),WHMCS.selectize.clientSearch();else{var e=jQuery(".selectize-client-search"),t=e.selectize({plugins:["whmcs_no_results"],valueField:e.data("value-field"),labelField:"name",searchField:["name","email","companyname"],create:!1,maxItems:1,preload:"focus",optgroupField:"status",optgroupLabelField:"name",optgroupValueField:"id",optgroups:[{$order:1,id:"active",name:e.data("active-label")},{$order:2,id:"inactive",name:e.data("inactive-label")}],render:{item:function(e,t){return"function"==typeof dropdownSelectClient&&dropdownSelectClient(t(e.id),t(e.name)+(e.companyname?" ("+t(e.companyname)+")":"")+(e.id>0?" - #"+t(e.id):""),t(e.email)),'<div><span class="name">'+t(e.name)+(e.companyname?" ("+t(e.companyname)+")":"")+(e.id>0?" - #"+t(e.id):"")+"</span></div>"},option:function(e,t){return'<div><span class="name">'+t(e.name)+(e.companyname?" ("+t(e.companyname)+")":"")+(e.id>0?" - #"+t(e.id):"")+"</span>"+(e.email?'<span class="email">'+t(e.email)+"</span>":"")+"</div>"}},load:function(e,t){jQuery.ajax({url:getClientSearchPostUrl(),type:"POST",dataType:"json",data:{dropdownsearchq:e,clientId:i},error:function(){t()},success:function(e){t(e)}})},score:function(e){var t=this.getScoreFunction(e);return function(e){var i=t(e);return i&&"inactive"===e.status&&(i=1e-7),i}},onChange:function(e){jQuery("#goButton").length&&e.length&&e!=i&&jQuery("#goButton").click()},onFocus:function(){i=t.getValue(),t.clear()},onBlur:function(){(""==t.getValue()||t.getValue()<1)&&t.setValue(i)}}),i="";t.length&&(t=t[0].selectize)}});