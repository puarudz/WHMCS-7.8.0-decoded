function validateAcceptJs(e){var a=jQuery('input[name="paymentmethod"]:checked'),t=jQuery("#frmCheckout"),r=jQuery('input[name="ccinfo"]');if("acceptjs"!==a.val()||"acceptjs"===a.val()&&"useexisting"===r.val())return!0;e.preventDefault(),t.find("#btnCompleteOrder").attr("disabled","disabled").addClass("disabled");var n={},d={},i={};i.cardNumber=jQuery("#inputCardNumber").val().replace(/\s/g,"");var s=jQuery("#inputCardExpiry").payment("cardExpiryVal");i.month=s.month,i.year=s.year,s=null,i.cardCode=jQuery("#inputCardCVV").val(),i.zip=jQuery("#inputPostcode").val();var c=jQuery("#inputFirstName");return c.length&&c.val()&&(i.fullName=c.val()+" "+jQuery("#inputLastName").val()),n.cardData=i,d.clientKey=clientKey,d.apiLoginID=apiLoginId,n.authData=d,Accept.dispatchData(n,acceptJsResponseHandler),!1}function acceptJsResponseHandler(e){var a=jQuery("#frmCheckout");if("Error"===e.messages.resultCode){for(var t="",r=0;r<e.messages.message.length;r++)t+=e.messages.message[r].text+"\n";a.find(".gateway-errors").text(t).removeClass("hidden"),scrollToError(),a.find("#btnCompleteOrder").removeAttr("disabled").removeClass("disabled")}else a.find(".gateway-errors").text("").addClass("hidden"),a.append(jQuery('<input type="hidden" name="dataDescriptor">').val(e.opaqueData.dataDescriptor)),a.append(jQuery('<input type="hidden" name="dataValue">').val(e.opaqueData.dataValue)),a.off("submit",validateAcceptJs),a.find("#btnCompleteOrder").removeAttr("disabled").removeClass("disabled").click().addClass("disabled").attr("disabled","disabled")}function enable_acceptjs(){var e=jQuery("#frmCheckout"),a=e.find("#cardType");e.find("#cctype").removeAttr("name"),e.find("#inputCardNumber").removeAttr("name"),e.find("#inputCardExpiry").removeAttr("name"),e.find("#inputCardCVV").removeAttr("name"),a.length?e.find("#cardType").parents("div.col-sm-6").slideUp("fast",function(){e.find("#inputCardNumber").parents("div.col-sm-6").toggleClass("col-sm-6 col-sm-12")}):(e.find("#cctype").parents("div.new-card-info").slideUp("fast"),e.find("#cctype").parents("tr.newccinfo").slideUp("fast")),e.on("submit",validateAcceptJs)}function disable_acceptjs(){var e=jQuery("#frmCheckout"),a=e.find("#cardType");e.find("#inputCardNumber").attr("name","ccnumber"),e.find("#inputCardExpiry").attr("name","ccexpirydate"),e.find("#inputCardCVV").attr("name","cccvv"),e.find("#cctype").attr("name","cctype"),a.length?(e.find("#inputCardNumber").parents("div.col-sm-12").toggleClass("col-sm-6 col-sm-12"),e.find("#cardType").parents("div.col-sm-6").slideDown("fast")):(e.find("#cctype").parents("div.new-card-info").slideDown("fast"),e.find("#cctype").parents("tr.newccinfo").slideDown("fast")),e.off("submit",validateAcceptJs)}function validateNewCcAcceptJs(e){e.preventDefault(),jQuery("#btnSubmitNewCard").attr("disabled","disabled").addClass("disabled");var a={},t={},r={};r.cardNumber=jQuery("#inputCardNumber").val().replace(/\s/g,"");var n=jQuery("#inputCardExpiry").payment("cardExpiryVal");return r.month=n.month,r.year=n.year,n=null,r.cardCode=jQuery("#inputCardCvc").val(),a.cardData=r,t.clientKey=clientKey,t.apiLoginID=apiLoginId,a.authData=t,Accept.dispatchData(a,acceptJsNewCcResponseHandler),!1}function acceptJsNewCcResponseHandler(e){var a=jQuery(".frm-credit-card-input");if("Error"===e.messages.resultCode){for(var t="",r=0;r<e.messages.message.length;r++)t+=e.messages.message[r].text+"\n";a.find(".gateway-errors,.assisted-cc-input-feedback").text(t).removeClass("hidden"),scrollToError(),jQuery("#btnSubmitNewCard").removeAttr("disabled").removeClass("disabled")}else a.find(".gateway-errors,.assisted-cc-input-feedback").text("").addClass("hidden"),a.append(jQuery('<input type="hidden" name="dataDescriptor">').val(e.opaqueData.dataDescriptor)),a.append(jQuery('<input type="hidden" name="dataValue">').val(e.opaqueData.dataValue)),a.off("submit",validateNewCcAcceptJs),a.append('<input type="submit" id="hiddenSubmit" name="submit" value="Save Changes" style="display: none">'),jQuery("#hiddenSubmit").click()}function enable_payment_acceptjs(){var e=jQuery("#frmPayment");e.find("#cctype").removeAttr("name").parents("div.form-group").remove(),e.find("#inputCardNumber").removeAttr("name").payment("formatCardNumber"),e.find("#inputCardExpiry").removeAttr("name"),e.find("#inputCardExpiryYear").removeAttr("name"),e.find("#inputCardCvv").removeAttr("name").payment("formatCardCVC").parents("div.form-group").show("fast"),e.on("submit",validatePaymentAcceptJs)}function validatePaymentAcceptJs(e){e.preventDefault(),jQuery("#btnSubmit").attr("disabled","disabled").addClass("disabled");var a={},t={},r={};return r.cardNumber=jQuery("#inputCardNumber").val().replace(/\s/g,""),r.month=jQuery("#inputCardExpiry").val(),r.year=jQuery("#inputCardExpiryYear").val(),r.cardCode=jQuery("#inputCardCvv").val(),a.cardData=r,t.clientKey=clientKey,t.apiLoginID=apiLoginId,a.authData=t,Accept.dispatchData(a,acceptJsPaymentResponseHandler),!1}function acceptJsPaymentResponseHandler(e){var a=jQuery("#frmPayment");if("Error"===e.messages.resultCode){for(var t="",r=0;r<e.messages.message.length;r++)t+=e.messages.message[r].text+"\n";a.find(".gateway-errors").text(t).removeClass("hidden"),scrollToError(),jQuery("#btnSubmit").removeAttr("disabled").removeClass("disabled").find("span").toggleClass("hidden")}else a.find(".gateway-errors").text("").addClass("hidden"),a.append(jQuery('<input type="hidden" name="dataDescriptor">').val(e.opaqueData.dataDescriptor)),a.append(jQuery('<input type="hidden" name="dataValue">').val(e.opaqueData.dataValue)),a.off("submit",validatePaymentAcceptJs),a.find("#btnSubmit").removeAttr("disabled").removeClass("disabled").click().addClass("disabled").attr("disabled","disabled")}function validateAdminAcceptJs(e){var a=jQuery("#frmCreditCardDetails");e.preventDefault(),a.find("#btnSaveChanges").attr("disabled","disabled").addClass("disabled");var t={},r={},n={};n.cardNumber=jQuery("#inputCardNumber").val().replace(/\s/g,"");var d=ccForm.find("#inputCardExpiry").payment("cardExpiryVal");return n.month=d.month,n.year=d.year,d=null,n.cardCode=jQuery("#cardcvv").val(),t.cardData=n,r.clientKey=clientKey,r.apiLoginID=apiLoginId,t.authData=r,Accept.dispatchData(t,acceptJsAdminResponseHandler),!1}function acceptJsAdminResponseHandler(e){var a=jQuery("#frmCreditCardDetails");if("Error"===e.messages.resultCode){for(var t="",r=0;r<e.messages.message.length;r++)t+=e.messages.message[r].text+"\n";a.find(".gateway-errors").text(t).removeClass("hidden"),scrollToError(),a.find("#btnSaveChanges").removeAttr("disabled").removeClass("disabled")}else a.find(".gateway-errors").text("").addClass("hidden"),a.append(jQuery('<input type="hidden" name="dataDescriptor">').val(e.opaqueData.dataDescriptor)),a.append(jQuery('<input type="hidden" name="dataValue">').val(e.opaqueData.dataValue)),a.off("submit",validateAdminAcceptJs),a.append('<input type="submit" id="hiddenSubmit" name="submit" value="Save Changes" style="display: none">'),jQuery("#hiddenSubmit").click()}function scrollToError(){jQuery("html, body").animate({scrollTop:jQuery(".gateway-errors,.assisted-cc-input-feedback").offset().top-50},500)}function enable_acceptjs_card_input(){var e=jQuery(".frm-credit-card-input");e.find("#inputCardNumber").removeAttr("name").payment("formatCardNumber"),e.find("#inputCardExpiry").removeAttr("name").payment("formatCardExpiry"),e.find("#inputCardCvc").removeAttr("name").payment("formatCardCVC"),e.find('button[type="submit"]').removeAttr("name"),e.on("submit",validateNewCcAcceptJs)}function disable_acceptjs_card_input(){var e=jQuery(".frm-credit-card-input");e.find("#inputCardNumber").attr("name","ccnumber").payment("formatCardNumber"),e.find("#inputCardExpiry").removeAttr("name","ccexpiry").payment("formatCardExpiry"),e.find("#inputCardCvc").removeAttr("name","cardcvv").payment("formatCardCVC"),e.find('button[type="submit"]').attr("name","submit"),e.off("submit",validateNewCcAcceptJs)}jQuery(document).ready(function(){var e=jQuery('input[name="paymentmethod"]'),a=jQuery("#frmCheckout"),t=jQuery(".frm-credit-card-input"),r=jQuery("#frmPayment"),n=jQuery("#frmCreditCardDetails");if(e.length&&!t.length){var d=jQuery('input[name="ccinfo"]'),i=jQuery('input[name="paymentmethod"]:checked').val();"acceptjs"===i&&(enable_acceptjs(),"useexisting"===d.val()&&a.off("submit",validateAcceptJs)),e.on("ifChecked change",function(){i=jQuery(this).val(),"acceptjs"===i?(enable_acceptjs(),"useexisting"===d.val()&&a.off("submit",validateAcceptJs)):disable_acceptjs()}),d.on("ifChecked change",function(){a.off("submit",validateAcceptJs),"acceptjs"===i&&"useexisting"!==jQuery(this).val()&&a.on("submit",validateAcceptJs)})}else t.length?("acceptjs"===jQuery('input[name="type"]:checked').data("gateway")&&enable_acceptjs_card_input(),jQuery('input[name="type"]').on("change",function(){"acceptjs"===jQuery(this).data("gateway")?enable_acceptjs_card_input():disable_acceptjs_card_input()})):r.length?(r.off("submit",validateCreditCardInput),"new"===jQuery('input[name="ccinfo"]:checked').val()?enable_payment_acceptjs():r.find("#inputCardCvv").parents("div.form-group").hide("fast"),jQuery('input[name="ccinfo"]').on("change",function(){"new"===jQuery(this).val()?enable_payment_acceptjs():(r.find("#inputCardCvv").parents("div.form-group").hide("fast"),r.off("submit",validatePaymentAcceptJs))})):n.length&&(n.find("#cctype").removeAttr("name").parents("tr#rowCardType").hide("fast"),n.find("#inputCardNumber").removeAttr("name"),n.find("#inputCardExpiry").removeAttr("name"),n.find("#cardcvv").removeAttr("name"),n.find("#btnSaveChanges").removeAttr("name"),n.on("submit",validateAdminAcceptJs))});